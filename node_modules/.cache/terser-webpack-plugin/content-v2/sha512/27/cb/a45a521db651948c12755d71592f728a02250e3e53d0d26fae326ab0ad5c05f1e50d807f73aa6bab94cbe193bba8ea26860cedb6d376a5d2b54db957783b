{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[473],{975:function(t,s,a){\"use strict\";a.r(s);var e=a(42),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"gitlabé…ç½®custom-hook\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#gitlabé…ç½®custom-hook\"}},[t._v(\"#\")]),t._v(\" gitlabé…ç½®custom hook\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"_1-å…·ä½“æ­¥éª¤\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-å…·ä½“æ­¥éª¤\"}},[t._v(\"#\")]),t._v(\" 1. å…·ä½“æ­¥éª¤\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"_1-1-è®¾ç½®custom-hooksè·¯å¾„\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-1-è®¾ç½®custom-hooksè·¯å¾„\"}},[t._v(\"#\")]),t._v(\" 1.1 è®¾ç½®custom_hooksè·¯å¾„\")]),t._v(\" \"),a(\"p\",[t._v(\"ä¿®æ”¹ gitlab ä¸­çš„\"),a(\"code\",[t._v(\"vi /etc/gitlab/gitlab.rb\")])]),t._v(\" \"),a(\"p\",[t._v(\"å¢åŠ  custom_hooks_dir è·¯å¾„ï¼š\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"gitlab_shell['custom_hooks_dir'] = \\\"/opt/gitlab/embedded/service/gitlab-shell/hooks\\\"\\n\")])])]),a(\"p\",[t._v(\"æ³¨ï¼šè¿™é‡Œç›´æ¥å»æ‰æ³¨é‡Šä½¿ç”¨è‡ªå¸¦çš„\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"_1-2-å¯ç”¨é…ç½®\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-2-å¯ç”¨é…ç½®\"}},[t._v(\"#\")]),t._v(\" 1.2 å¯ç”¨é…ç½®\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"sudo gitlab-ctl reconfigure\\n\")])])]),a(\"h3\",{attrs:{id:\"_1-3-åˆ›å»ºhookæ–‡ä»¶\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-3-åˆ›å»ºhookæ–‡ä»¶\"}},[t._v(\"#\")]),t._v(\" 1.3 åˆ›å»ºhookæ–‡ä»¶\")]),t._v(\" \"),a(\"p\",[t._v(\"è‡ªå®šä¹‰è„šæœ¬ç›®å½•è¦ç¬¦åˆ\"),a(\"code\",[t._v(\"<custom_hooks_dir>/<hook_name.d>/*\")]),t._v(\" çš„è§„èŒƒã€‚å…·ä½“å°±æ˜¯\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[t._v(\"åœ¨è‡ªå®šçš„\"),a(\"code\",[t._v(\"custom_hooks_dir\")]),t._v(\" ç›®å½•ä¸‹å¯åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹å¯¹åº”ä¸‰ç±» \"),a(\"code\",[t._v(\"server hook name\")]),t._v(\" ï¼š\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[t._v(\"pre-receive.d\")]),t._v(\" \"),a(\"li\",[t._v(\"update.d\")]),t._v(\" \"),a(\"li\",[t._v(\"post-receive.d\")])])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"åœ¨æ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹å¯ä»¥åˆ›å»ºä»»æ„æ–‡ä»¶ï¼Œåœ¨å¯¹åº”çš„hookæ—¶æœŸï¼Œgitlabå°±ä¼šä¸»åŠ¨è°ƒç”¨\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"æ–‡ä»¶åä»¥\"),a(\"code\",[t._v(\"~\")]),t._v(\"ç»“å°¾çš„æ–‡ä»¶ä¼šè¢«å¿½ç•¥\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"å¦‚æœæƒ³çœ‹è¿™éƒ¨åˆ†çš„å®ç°ç»†èŠ‚å¯ä»¥çœ‹ \"),a(\"code\",[t._v(\"<gitlab-shell>/lib/gitlab_custom_hook.rb\")]),t._v(\" æ–‡ä»¶\")])])]),t._v(\" \"),a(\"p\",[t._v(\"ç›®å½•ç»“æ„ç¤ºæ„\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"[root@localhost custom_hooks]# tree\\n.\\nâ”œâ”€â”€ post-receive.d\\nâ”‚   â”œâ”€â”€ 01.sh\\nâ”‚   â””â”€â”€ 02.sh~\\nâ”œâ”€â”€ pre-receive.d\\nâ”‚   â”œâ”€â”€ 01.sh\\nâ”‚   â”œâ”€â”€ 02.py\\nâ”‚   â””â”€â”€ 03.rb\\nâ””â”€â”€ update.d\\n    â”œâ”€â”€ 01.sh\\n    â””â”€â”€ 02.sh\\n\")])])]),a(\"h3\",{attrs:{id:\"_1-4-ç¼–å†™-hook-è„šæœ¬\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-4-ç¼–å†™-hook-è„šæœ¬\"}},[t._v(\"#\")]),t._v(\" 1.4 ç¼–å†™ hook è„šæœ¬\")]),t._v(\" \"),a(\"p\",[t._v(\"hook è„šæœ¬å°±æ˜¯git è‡ªèº«çš„è§„èŒƒï¼Œå†™shellï¼Œpythonã€ruby éƒ½å¯ä»¥\")]),t._v(\" \"),a(\"p\",[t._v(\"ç•™æ„è„šæœ¬æœ€åçš„é€€å‡ºå€¼ï¼š\"),a(\"strong\",[t._v(\"0 æ­£å¸¸é€€å‡ºï¼Œç”¨æˆ·å¯ä»¥ pushï¼›é 0 å¼‚å¸¸é€€å‡ºï¼Œä¸­æ–­æäº¤ï¼ˆpre-receive å’Œ updateï¼‰\")]),t._v(\" ã€‚\\nç»†èŠ‚å‚è§ï¼š \"),a(\"a\",{attrs:{href:\"https://link.jianshu.com/?t=https://github.com/geeeeeeeeek/git-recipes/wiki/5.4-Git%E9%92%A9%E5%AD%90%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"5.4 Gité’©å­ï¼šè‡ªå®šä¹‰ä½ çš„å·¥ä½œæµ Â· geeeeeeeeek/git-recipes Wiki Â· GitHub\"),a(\"OutboundLink\")],1)]),t._v(\" \"),a(\"p\",[t._v(\"å¦‚æœæƒ³è®©ç”¨æˆ· push æ—¶çœ‹åˆ°ç›¸åº”çš„æ—¥å¿—ç›´æ¥åœ¨è„šæœ¬ä¸­ echo å³å¯ã€‚\")]),t._v(\" \"),a(\"p\",[t._v(\"è¿™é‡Œä¸¾ä¸¤ä¸ªä¾‹å­ï¼š\")]),t._v(\" \"),a(\"p\",[t._v(\"ğŸŒ°ï¼šSay hi.\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token shebang important\"}},[t._v(\"#!/bin/sh\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[t._v(\"echo\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"Say hi from gitlab servertes ok ğŸ˜„\"')]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[t._v(\"exit\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"ğŸŒ°ï¼šæ£€æŸ¥æäº¤ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå‘ç°æœ‰ç‰¹å®šå†…å®¹ç¦æ­¢æäº¤\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"#!/bin/sh\\nFIND_KEY='.test.51offer.com'\\nOLD_VALUE=$2\\nNEW_VALUE=$3\\n\\nFILES=$(git rev-list --objects $OLD_VALUE...$NEW_VALUE | egrep '\\\\.(jsp|vm|java)$' | awk '{print $2}' | sort | uniq )\\n\\nFLAG=0\\nfor FILE in $FILES\\ndo\\n    git show $NEW_VALUE:$FILE | grep -q \\\"$FIND_KEY\\\"\\n    if [ $? -eq 0 ]\\n    then\\n        FLAG=1\\n        echo \\\"ğŸ“ƒ  åŒ…å«éæ³•å­—æ®µ '$FIND_KEY' : $FILE\\\"\\n    fi\\ndone\\n\\nif [ $FLAG -eq 0 ]\\nthen\\n    echo \\\"âœ…  ä»£ç æ£€æŸ¥é€šè¿‡.\\\"\\nelse\\n    echo \\\"âŒ  ä»£ç æ£€æŸ¥ä¸é€šè¿‡!\\\"\\n    exit 1\\nfi\\n\\nexit 0\\n\")])])]),a(\"p\",[t._v(\"ä¾‹å­ç»“æœ\")]),t._v(\" \"),a(\"p\",[t._v(\"ä¸Šé¢ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œå°è¯• \"),a(\"code\",[t._v(\"git push\")]),t._v(\"ï¼Œå°±èƒ½çœ‹åˆ°å¦‚ä¸‹çš„æ—¥å¿—ï¼š\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-ruby extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-ruby\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"Pushing\")]),t._v(\" to git\"),a(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[t._v(\"@gitlab\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".51\")]),t._v(\"offer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"inner\"),a(\"span\",{pre:!0,attrs:{class:\"token symbol\"}},[t._v(\":mall\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"paycenter\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"git\\nremote\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" ğŸ“ƒ  åŒ…å«éæ³•å­—æ®µ \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'.test.51offer.com'\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" service\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"src\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"main\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"java\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"com\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"horizon\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"module\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"paycenter\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"service\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"PayService\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"java        \\nremote\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" âŒ  ä»£ç æ£€æŸ¥ä¸é€šè¿‡\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"!\")]),t._v(\"        \\nremote\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" error\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" hook declined to update refs\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"heads\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"test        \\n\"),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"To\")]),t._v(\" git\"),a(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[t._v(\"@gitlab\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".51\")]),t._v(\"offer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"inner\"),a(\"span\",{pre:!0,attrs:{class:\"token symbol\"}},[t._v(\":mall\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"paycenter\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"git\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),t._v(\"up to date\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"      release\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"old \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\" release\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"old\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),t._v(\"up to date\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"      v1\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".2016\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".9\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".8\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\" v1\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".2016\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".9\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\".8\")]),t._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"!\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),t._v(\"remote rejected\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\" test \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\" test \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"hook declined\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\nerror\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" failed to push some refs to \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'git@gitlab.51offer.inner:mall/paycenter.git'\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"Completed\")]),t._v(\" with errors\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" see above\\n\")])])]),a(\"h3\",{attrs:{id:\"å‚è€ƒæ–‡ç« \"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#å‚è€ƒæ–‡ç« \"}},[t._v(\"#\")]),t._v(\" å‚è€ƒæ–‡ç« \")]),t._v(\" \"),a(\"p\",[a(\"a\",{attrs:{href:\"https://www.jianshu.com/p/5531a21afa68\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Gitlab æœåŠ¡å™¨ç«¯ custom hook é…ç½®\"),a(\"OutboundLink\")],1)]),t._v(\" \"),a(\"p\",[a(\"a\",{attrs:{href:\"https://docs.gitlab.com/ee/administration/custom_hooks.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"å®˜æ–¹æ–‡æ¡£\"),a(\"OutboundLink\")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);","extractedComments":[]}