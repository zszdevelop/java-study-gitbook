{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1314:function(t,a,s){\"use strict\";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"sleuth-zipkin链路追踪\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sleuth-zipkin链路追踪\"}},[t._v(\"#\")]),t._v(\" Sleuth Zipkin链路追踪\")]),t._v(\" \"),n(\"p\",[t._v(\"一个复杂的业务流程通常会被拆分多个微服务系统来完成，微服务间通过Feign来通信。当业务系统足够复杂时，一个完整的HTTP请求调用链一般会经过多个微服务系统，要通过日志来跟踪一整个调用链变得不再那么简单。\")]),t._v(\" \"),n(\"p\",[t._v(\"我们通过Spring Cloud Feign来远程访问受保护的资源，通过Spring Cloud Sleuth来跟踪这个过程，并借助Zipkin以图形化界面的方式展示\")]),t._v(\" \"),n(\"h2\",{attrs:{id:\"_2-整合spring-cloud-sleuth\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-整合spring-cloud-sleuth\"}},[t._v(\"#\")]),t._v(\" 2. 整合Spring Cloud Sleuth\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_2-1-引入sleuth依赖\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-引入sleuth依赖\"}},[t._v(\"#\")]),t._v(\" 2.1 引入sleuth依赖\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-xml extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"dependency\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"groupId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"org.springframework.cloud\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"groupId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"artifactId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"spring-cloud-starter-sleuth\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"artifactId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"dependency\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"_2-2-打印日志\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-打印日志\"}},[t._v(\"#\")]),t._v(\" 2.2 打印日志\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_2-2-1-客户端modulea打印日志\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-1-客户端modulea打印日志\"}},[t._v(\"#\")]),t._v(\" 2.2.1 客户端ModuleA打印日志\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-java extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Slf4j\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@RestController\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"class\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TestController\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Autowired\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"IHelloService\")]),t._v(\" helloService\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@GetMapping\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"hello\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"hello\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" name\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n        log\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"info\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"Feign调用febs-server-system的/hello服务\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n        \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"this\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"helloService\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"hello\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"name\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"_2-2-2-服务端moduleb打印日志\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-2-服务端moduleb打印日志\"}},[t._v(\"#\")]),t._v(\" 2.2.2 服务端ModuleB打印日志\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-java extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Slf4j\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@RestController\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"class\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TestController\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@GetMapping\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"hello\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"hello\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" name\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n        log\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"info\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"/hello服务被调用\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n        \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"hello\"')]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\" name\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"_2-3-观察打印的日志\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-3-观察打印的日志\"}},[t._v(\"#\")]),t._v(\" 2.3 观察打印的日志\")]),t._v(\" \"),n(\"p\",[t._v(\"观察客户端ModuleA 打印的日志\")]),t._v(\" \"),n(\"div\",{staticClass:\"language- extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[t._v(\"2019-08-23 14:22:51.774  INFO [ModuleA,72bb0469bee07104,72bb0469bee07104,false] 22728 --- [nio-8202-exec-1] c.m.f.s.test.controller.TestController   : Feign调用febs-server-system的/hello服务\\n\")])])]),n(\"p\",[t._v(\"观察服务端ModuleB打印的日志\")]),t._v(\" \"),n(\"div\",{staticClass:\"language- extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[t._v(\"2019-08-23 14:22:52.469  INFO [ModuleB-System,72bb0469bee07104,43597a6edded6f2e,false] 812 --- [nio-8201-exec-2] c.m.f.s.s.controller.TestController      : /hello服务被调用\\n\\n\")])])]),n(\"p\",[t._v(\"可以看到，日志里出现了\"),n(\"code\",[t._v(\"[ModuleB,72bb0469bee07104,72bb0469bee07104,false]\")]),t._v(\"信息，这些信息由Spring Cloud Sleuth生成，用于跟踪微服务请求链路。这些信息包含了4个部分的值，它们的含义如下：\")]),t._v(\" \"),n(\"ol\",[n(\"li\",[t._v(\"ModuleB微服务的名称，与\"),n(\"code\",[t._v(\"spring.application.name\")]),t._v(\"对应；\")]),t._v(\" \"),n(\"li\",[n(\"code\",[t._v(\"72bb0469bee07104\")]),t._v(\"称为Trace ID，在一条完整的请求链路中，这个值是固定的。观察上面的日志即可证实这一点；\")]),t._v(\" \"),n(\"li\",[n(\"code\",[t._v(\"43597a6edded6f2e\")]),t._v(\"称为Span ID，它表示一个基本的工作单元；\")]),t._v(\" \"),n(\"li\",[n(\"code\",[t._v(\"false\")]),t._v(\"表示是否要将该信息输出到Zipkin等服务中来收集和展示，这里我们还没有集成Zipkin，所以为false。\")])]),t._v(\" \"),n(\"p\",[t._v(\"现在我们要跟踪整条请求链路，就可以通过traceId来完成，但是，从海量日志里捞取traceID并追踪也不是一件轻松的事。下面我们介绍借助zipkin实现使用图形化界面的方式追踪请求链路\")]),t._v(\" \"),n(\"h2\",{attrs:{id:\"_3-整合zipkin\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-整合zipkin\"}},[t._v(\"#\")]),t._v(\" 3. 整合Zipkin\")]),t._v(\" \"),n(\"p\",[t._v(\"在整合Zipkin之前，我们需要先搭建RabbitMQ。RabbitMQ用于收集Sleuth提供的追踪信息，然后zipkin Server 从RabbitMQ里获取，这样可以提升性能\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-1-安装rabbitmq\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-安装rabbitmq\"}},[t._v(\"#\")]),t._v(\" 3.1 安装RabbitMQ\")]),t._v(\" \"),n(\"p\",[n(\"RouterLink\",{attrs:{to:\"/microservice/track/zipkin/mq/RabbitMQ/action/RabbitMQ安装.html\"}},[t._v(\"RabbitMQ安装\")])],1),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-2-安装zipkin\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-2-安装zipkin\"}},[t._v(\"#\")]),t._v(\" 3.2 安装Zipkin\")]),t._v(\" \"),n(\"div\",{staticClass:\"language- extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[t._v(\"curl -sSL https://zipkin.io/quickstart.sh | bash -s\\n\")])])]),n(\"p\",[t._v(\"网络原因可能比较慢\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-3-新建zipkin数据库表\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-3-新建zipkin数据库表\"}},[t._v(\"#\")]),t._v(\" 3.3 新建zipkin数据库表\")]),t._v(\" \"),n(\"p\",[n(\"a\",{attrs:{href:\"https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"官方数据库表地址\"),n(\"OutboundLink\")],1)]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:s(853),alt:\"image-20191203222325915\"}})]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-4-启动zipkin-jar\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-4-启动zipkin-jar\"}},[t._v(\"#\")]),t._v(\" 3.4 启动zipkin.jar\")]),t._v(\" \"),n(\"div\",{staticClass:\"language- extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[t._v(\"java -jar zipkin.jar --server.port=8402 --zipkin.storage.type=mysql --zipkin.storage.mysql.db=febs_cloud_base --zipkin.storage.mysql.username=root --zipkin.storage.mysql.password=123456 --zipkin.storage.mysql.host=localhost --zipkin.storage.mysql.port=3306 --zipkin.collector.rabbitmq.addresses=localhost:5672 --zipkin.collector.rabbitmq.username=febs --zipkin.collector.rabbitmq.password=123456\\n\")])])]),n(\"p\",[t._v(\"上面命令指定了数据库链接和RabbitMQ链接信息。更多可选配置可以解压zipkin.jar，查看\"),n(\"code\",[t._v(\"zipkin\\\\BOOT-INF\\\\classes\")]),t._v(\"路径下的\"),n(\"code\",[t._v(\"zipkin-server-shared.yml\")]),t._v(\"配置类源码。\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-5-引入相关依赖\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-5-引入相关依赖\"}},[t._v(\"#\")]),t._v(\" 3.5 引入相关依赖\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-xml extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"dependency\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"groupId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"org.springframework.cloud\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"groupId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"artifactId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"spring-cloud-starter-zipkin\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"artifactId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"dependency\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"dependency\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"groupId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"org.springframework.amqp\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"groupId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"artifactId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"spring-rabbit\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"artifactId\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"dependency\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"_3-6-application-yml里添加如下配置\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-6-application-yml里添加如下配置\"}},[t._v(\"#\")]),t._v(\" 3.6 application.yml里添加如下配置:\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-yml extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-yml\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spring\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"zipkin\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"sender\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"type\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" rabbit\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"sleuth\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"sampler\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"probability\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"rabbitmq\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"host\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" localhost\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"port\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"5672\")]),t._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"username\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" febs\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"password\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"123456\")]),t._v(\"\\n\")])])]),n(\"ul\",[n(\"li\",[n(\"code\",[t._v(\"spring.zipkin.sender.type\")]),t._v(\"指定了使用RabbitMQ收集追踪信息；\")]),t._v(\" \"),n(\"li\",[n(\"code\",[t._v(\"spring.sleuth.sampler.probability\")]),t._v(\"默认值为0.1，即采样率才1/10，发送10笔请求只有一笔会被采集。为了测试方便，我们可以将它设置为1，即100%采样；\")]),t._v(\" \"),n(\"li\",[n(\"code\",[t._v(\"spring.rabbitmq\")]),t._v(\"用于配置RabbitMQ连接信息，你可能会问，为什么刚刚RabbitMQ端口是15672，这里却配置为5672，是不是写错了呢？其实不是，15672是RabbitMQ的管理页面端口，5672是AMPQ端口。\")])]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-7-浏览器访问\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-7-浏览器访问\"}},[t._v(\"#\")]),t._v(\" 3.7 浏览器访问\")]),t._v(\" \"),n(\"p\",[t._v(\"http://localhost:8402/zipkin/链接\")]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:s(854),alt:\"image-20191203223120174\"}})]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:s(855),alt:\"image-20191203223135119\"}})]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:s(856),alt:\"image-20191203223152330\"}})]),t._v(\" \"),n(\"p\",[t._v(\"查看依赖关系\")]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:s(857),alt:\"image-20191203223206233\"}})]),t._v(\" \"),n(\"h3\",{attrs:{id:\"_3-8-查看数据表-看是否存储了信息\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-8-查看数据表-看是否存储了信息\"}},[t._v(\"#\")]),t._v(\" 3.8 查看数据表，看是否存储了信息：\")]),t._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:s(858),alt:\"image-20191203223244996\"}})])])}),[],!1,null,null,null);a.default=e.exports},853:function(t,a,s){t.exports=s.p+\"assets/img/image-20191203222325915.37afe80d.png\"},854:function(t,a,s){t.exports=s.p+\"assets/img/image-20191203223120174.2e4a6871.png\"},855:function(t,a,s){t.exports=s.p+\"assets/img/image-20191203223135119.eb1ec628.png\"},856:function(t,a,s){t.exports=s.p+\"assets/img/image-20191203223152330.6fd3e544.png\"},857:function(t,a,s){t.exports=s.p+\"assets/img/image-20191203223206233.9652ae71.png\"},858:function(t,a,s){t.exports=s.p+\"assets/img/image-20191203223244996.a645c800.png\"}}]);","extractedComments":[]}