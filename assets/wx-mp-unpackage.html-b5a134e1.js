import{_ as o,W as p,X as i,Y as n,Z as s,$ as a,a0 as e,D as l}from"./framework-0cf5f349.js";const r={},c=e('<h1 id="微信小程序-uniapp-分包" tabindex="-1"><a class="header-anchor" href="#微信小程序-uniapp-分包" aria-hidden="true">#</a> 微信小程序(uniapp)-分包</h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介" aria-hidden="true">#</a> 1. 简介</h2><p>因小程序有体积和资源加载限制，各家小程序平台提供了分包方式，<strong>优化小程序的下载和启动速度</strong>。</p><ul><li><p><strong>主包</strong></p><p>即放置默认启动页面/TabBar 页面，以及一些所有分包都需用到公共资源/JS 脚本；</p></li><li><p><strong>分包</strong></p><p>根据pages.json的配置进行划分。</p></li></ul><h3 id="_1-1-主包与分包加载时机" tabindex="-1"><a class="header-anchor" href="#_1-1-主包与分包加载时机" aria-hidden="true">#</a> 1.1 主包与分包加载时机</h3><ul><li><p>主包加载时机：</p><p>在小程序启动时，默认会下载主包并启动主包内页面</p></li><li><p>分包加载时机</p><p>当用户进入分包内某个页面时，会把对应分包自动下载下来，下载完成后再进行展示。此时终端界面会有等待提示。</p></li></ul><h2 id="_2-前置概念" tabindex="-1"><a class="header-anchor" href="#_2-前置概念" aria-hidden="true">#</a> 2. 前置概念</h2><p>App默认为整包，App下开启分包流程</p>',8),u=n("li",null,[n("p",null,"在pages.json中配置分包规则"),n("ol",null,[n("li",null,"subPackages 节点，分包规则")])],-1),d={href:"https://uniapp.dcloud.io/collocation/manifest?id=app-vue-optimization",target:"_blank",rel:"noopener noreferrer"},v=n("ol",null,[n("li",null,"optimization：减轻启动时加载的js数量，提升启动速度。")],-1),k=n("blockquote",null,[n("p",null,"一旦在pages.json里配置分包，小程序一定生效，而app是否生效，取决于manifest里是否开启")],-1),h=n("h3",{id:"_2-1-subpackages-节点",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-1-subpackages-节点","aria-hidden":"true"},"#"),s(" 2.1 subPackages 节点")],-1),g=n("p",null,"subPackages 节点接收一个数组，数组每一项都是应用的子包，其属性值如下：",-1),m=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"属性"),n("th",{style:{"text-align":"left"}},"类型"),n("th",{style:{"text-align":"left"}},"是否必填"),n("th",{style:{"text-align":"left"}},"描述")])],-1),b=n("tr",null,[n("td",{style:{"text-align":"left"}},"root"),n("td",{style:{"text-align":"left"}},"String"),n("td",{style:{"text-align":"left"}},"是"),n("td",{style:{"text-align":"left"}},"子包的根目录")],-1),_=n("td",{style:{"text-align":"left"}},"pages",-1),q=n("td",{style:{"text-align":"left"}},"Array",-1),y=n("td",{style:{"text-align":"left"}},"是",-1),f={style:{"text-align":"left"}},x={href:"https://uniapp.dcloud.io/collocation/pages.html#pages",target:"_blank",rel:"noopener noreferrer"},j=n("p",null,[n("strong",null,"注意：")],-1),A=e("<li><code>subPackages</code> 里的pages的路径是 <code>root</code> 下的相对路径，不是全路径。</li><li><strong>微信小程序每个分包的大小是2M，总体积一共不能超过20M</strong>。</li><li>百度小程序每个分包的大小是2M，总体积一共不能超过8M。</li><li>支付宝小程序每个分包的大小是2M，总体积一共不能超过8M。</li><li>QQ小程序每个分包的大小是2M，总体积一共不能超过24M。</li><li>字节小程序每个分包的大小是2M，总体积一共不能超过16M（字节小程序基础库 1.88.0 及以上版本开始支持，字节小程序开发者工具请使用大于等于 2.0.6 且小于 3.0.0 的版本）。</li><li>分包下支持独立的 <code>static</code> 目录，用来对静态资源进行分包。</li>",7),E=n("code",null,"uni-app",-1),B=n("code",null,"微信小程序",-1),P=n("code",null,"QQ小程序",-1),M=n("code",null,"百度小程序",-1),w=n("code",null,"支付宝小程序",-1),z=n("code",null,"字节小程序(HBuilderX 3.0.3+)",-1),N={href:"https://uniapp.dcloud.io/collocation/manifest#%E5%85%B3%E4%BA%8E%E5%88%86%E5%8C%85%E4%BC%98%E5%8C%96%E7%9A%84%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"},R=e("<li>针对<code>vendor.js</code>过大的情况可以使用运行时压缩代码</li><li><code>HBuilderX</code>创建的项目勾选<code>运行--&gt;运行到小程序模拟器--&gt;运行时是否压缩代码</code></li><li><code>cli</code>创建的项目可以在<code>package.json</code>中添加参数<code>--minimize</code>，示例：<code>&quot;dev:mp-weixin&quot;: &quot;cross-env NODE_ENV=development UNI_PLATFORM=mp-weixin vue-cli-service uni-build --watch --minimize&quot;</code></li>",3),S=e(`<h3 id="_2-2-optimization-分包优化" tabindex="-1"><a class="header-anchor" href="#_2-2-optimization-分包优化" aria-hidden="true">#</a> 2.2 optimization 分包优化</h3><p>可以减轻启动时加载的js数量，提升启动速度。</p><p>从uni-app 2.7.12+ 开始，App-vue平台也兼容了小程序的分包配置，但默认并不开启。</p><p>在manifest配置以下节点，可以在App端启动分包。</p><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">subPackages</td><td style="text-align:left;">Boolean</td><td style="text-align:left;">是否开启分包优化</td></tr></tbody></table><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;app-plus&quot;: {
  &quot;optimization&quot;: {
    &quot;subPackages&quot;: true
  },
  &quot;runmode&quot; : &quot;liberate&quot; // 开启分包优化后，必须配置资源释放模式
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),V={href:"https://uniapp.dcloud.io/collocation/pages?id=subpackages",target:"_blank",rel:"noopener noreferrer"},C=e(`<p><strong>也就是一旦在pages.json里配置分包，小程序一定生效，而app是否生效，取决于manifest里是否开启。</strong></p><p>注意:</p><ul><li>App开启分包后，每个分包单独编译成一个js文件(都包含在app内，不会联网下载)，当App首页是vue时，可减小启动加载文件大小，提升启动速度。</li><li>首页是nvue时，分包不会提升启动速度，nvue本身启动速度就快于vue，也快于开启分包后的首页为vue的应用。如果追求极致启动速度，还是应该使用nvue做首页并在manifest开启fast模式。</li><li>App页面较少时，分包对启动速度的优化不明显。</li></ul><h3 id="_2-3-preloadrule" tabindex="-1"><a class="header-anchor" href="#_2-3-preloadrule" aria-hidden="true">#</a> 2.3. preloadRule</h3><p>分包预载配置。</p><p>配置preloadRule后，在进入小程序某个页面时，由框架自动预下载可能需要的分包，提升进入后续分包页面时的启动速度</p><p><code>preloadRule</code> 中，<code>key</code> 是页面路径，<code>value</code> 是进入此页面的预下载配置，每个配置有以下几项：</p><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>packages</td><td>StringArray</td><td>是</td><td>无</td><td>进入页面后预下载分包的 <code>root</code> 或 <code>name</code>。<code>__APP__</code> 表示主包。</td></tr><tr><td>network</td><td>String</td><td>否</td><td>wifi</td><td>在指定网络下预下载，可选值为：all（不限网络）、wifi（仅wifi下预下载）</td></tr></tbody></table><p>app的分包，同样支持preloadRule，但网络规则无效。</p><h2 id="_3-分包流程" tabindex="-1"><a class="header-anchor" href="#_3-分包流程" aria-hidden="true">#</a> 3. 分包流程</h2><h3 id="_3-1-划分目录结构" tabindex="-1"><a class="header-anchor" href="#_3-1-划分目录结构" aria-hidden="true">#</a> 3.1 划分目录结构</h3><p>假设支持分包的 <code>uni-app</code> 目录结构如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>┌─pages

│  ├─index
│  │  └─index.vue

│  └─login
│     └─login.vue

├─pagesA

│  ├─static
│  └─list
│     └─list.vue
├─pagesB

│  ├─static
│  └─detail
│     └─detail.vue

├─static

├─main.js

├─App.vue

├─manifest.json

└─pages.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-pages-json-配置" tabindex="-1"><a class="header-anchor" href="#_3-2-pages-json-配置" aria-hidden="true">#</a> 3.2 pages.json 配置</h3><p>在 pages.json 中填写</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	<span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		<span class="token string-property property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
		<span class="token string-property property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token string-property property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/login/login&quot;</span><span class="token punctuation">,</span>
		<span class="token string-property property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token string-property property">&quot;subPackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		<span class="token string-property property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pagesA&quot;</span><span class="token punctuation">,</span>
		<span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
			<span class="token string-property property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;list/list&quot;</span><span class="token punctuation">,</span>
			<span class="token string-property property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token string-property property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pagesB&quot;</span><span class="token punctuation">,</span>
		<span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
			<span class="token string-property property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;detail/detail&quot;</span><span class="token punctuation">,</span>
			<span class="token string-property property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token string-property property">&quot;preloadRule&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string-property property">&quot;pagesA/list/list&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token string-property property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
			<span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;__APP__&quot;</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string-property property">&quot;pagesB/detail/detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token string-property property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
			<span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pagesA&quot;</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-manifest-json-配置" tabindex="-1"><a class="header-anchor" href="#_3-3-manifest-json-配置" aria-hidden="true">#</a> 3.3 manifest.json 配置</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string-property property">&quot;app-plus&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;optimization&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;subPackages&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;runmode&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;liberate&quot;</span> <span class="token comment">// 开启分包优化后，必须配置资源释放模式</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,19),Q={href:"https://uniapp.dcloud.io/collocation/pages.html#subpackages",target:"_blank",rel:"noopener noreferrer"};function I(L,T){const t=l("ExternalLinkIcon");return p(),i("div",null,[c,n("ol",null,[u,n("li",null,[n("p",null,[s("在manifest中设置app端开启分包，"),n("a",d,[s("详见"),a(t)])]),v,k])]),h,g,n("table",null,[m,n("tbody",null,[b,n("tr",null,[_,q,y,n("td",f,[s("子包由哪些页面组成，参数同 "),n("a",x,[s("pages"),a(t)])])])])]),n("blockquote",null,[j,n("ul",null,[A,n("li",null,[E,s("内支持对"),B,s("、"),P,s("、"),M,s("、"),w,s("、"),z,s("分包优化，即将静态资源或者js文件放入分包内不占用主包大小。详情请参考："),n("a",N,[s("关于分包优化的说明"),a(t)])]),R])]),S,n("p",null,[s("在manifest中启动分包后，需要在pages.json中配置具体的分包规则，与小程序的配置相同，"),n("a",V,[s("详见此"),a(t)])]),C,n("p",null,[n("a",Q,[s("uniapp官网分包"),a(t)])])])}const D=o(r,[["render",I],["__file","wx-mp-unpackage.html.vue"]]);export{D as default};
