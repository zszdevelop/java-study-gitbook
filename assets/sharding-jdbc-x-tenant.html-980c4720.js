import{_ as p,W as o,X as c,Y as n,Z as s,$ as e,a0 as t,D as l}from"./framework-0cf5f349.js";const i={},u=t('<h1 id="springboot集成shardingjdbc-基于jpa的db隔离多租户方案" tabindex="-1"><a class="header-anchor" href="#springboot集成shardingjdbc-基于jpa的db隔离多租户方案" aria-hidden="true">#</a> SpringBoot集成ShardingJDBC-基于JPA的DB隔离多租户方案</h1><blockquote><p>本文主要介绍ShardingJDBC的分片算法和分片策略，并在此基础上通过SpringBoot集成ShardingJDBC的几种策略（标准分片策略，行表达式分片策略和hint分片策略）向你展示DB隔离的多租户方案。</p></blockquote><h2 id="_1-知识准备" tabindex="-1"><a class="header-anchor" href="#_1-知识准备" aria-hidden="true">#</a> 1. 知识准备</h2><blockquote><p>主要理解ShardingJDBC表的基本术语，以及分片算法和分片策略等。</p></blockquote><h3 id="_1-1-逻辑表-绑定表" tabindex="-1"><a class="header-anchor" href="#_1-1-逻辑表-绑定表" aria-hidden="true">#</a> 1.1 逻辑表？绑定表？</h3>',5),r={href:"https://shardingsphere.apache.org/",target:"_blank",rel:"noopener noreferrer"},k=t(`<ul><li><strong>逻辑表</strong></li></ul><p>水平拆分的数据库（表）的相同逻辑和数据结构表的总称。例：订单数据根据主键尾数拆分为10张表，分别是t_order_0到t_order_9，他们的逻辑表名为t_order。</p><ul><li><strong>真实表</strong></li></ul><p>在分片的数据库中真实存在的物理表。即上个示例中的t_order_0到t_order_9。</p><ul><li><strong>数据节点</strong></li></ul><p>数据分片的最小单元。由数据源名称和数据表组成，例：ds_0.t_order_0。</p><ul><li><strong>绑定表</strong></li></ul><p>指分片规则一致的主表和子表。例如：t_order表和t_order_item表，均按照order_id分片，则此两张表互为绑定表关系。绑定表之间的多表关联查询不会出现笛卡尔积关联，关联查询效率将大大提升。举例说明，如果SQL为：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order o <span class="token keyword">JOIN</span> t_order_item i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在不配置绑定表关系时，假设分片键order_id将数值10路由至第0片，将数值11路由至第1片，那么路由后的SQL应该为4条，它们呈现为笛卡尔积：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_0 o <span class="token keyword">JOIN</span> t_order_item_0 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_0 o <span class="token keyword">JOIN</span> t_order_item_1 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_1 o <span class="token keyword">JOIN</span> t_order_item_0 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_1 o <span class="token keyword">JOIN</span> t_order_item_1 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在配置绑定表关系后，路由的SQL应该为2条：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_0 o <span class="token keyword">JOIN</span> t_order_item_0 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_1 o <span class="token keyword">JOIN</span> t_order_item_1 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中t_order在FROM的最左侧，ShardingSphere将会以它作为整个绑定表的主表。 所有路由计算将会只使用主表的策略，那么t_order_item表的分片计算将会使用t_order的条件。故绑定表之间的分区键要完全相同。</p><ul><li><strong>广播表</strong></li></ul><p>指所有的分片数据源中都存在的表，表结构和表中的数据在每个数据库中均完全一致。适用于数据量不大且需要与海量数据的表进行关联查询的场景，例如：字典表。</p><h3 id="_1-2-分片算法-分片策略" tabindex="-1"><a class="header-anchor" href="#_1-2-分片算法-分片策略" aria-hidden="true">#</a> 1.2 分片算法？分片策略？</h3>`,17),d={href:"https://shardingsphere.apache.org/",target:"_blank",rel:"noopener noreferrer"},m=t(`<h4 id="_1-2-1-分片键" tabindex="-1"><a class="header-anchor" href="#_1-2-1-分片键" aria-hidden="true">#</a> 1.2.1 分片键</h4><p>用于分片的数据库字段，是将数据库(表)水平拆分的关键字段。例：将订单表中的订单主键的尾数取模分片，则订单主键为分片字段。 SQL中如果无分片字段，将执行全路由，性能较差。 除了对单分片字段的支持，ShardingSphere也支持根据多个字段进行分片。</p><h4 id="_1-2-2-分片算法" tabindex="-1"><a class="header-anchor" href="#_1-2-2-分片算法" aria-hidden="true">#</a> 1.2.2 分片算法</h4><blockquote><p>通过分片算法将数据分片，支持通过=、&gt;=、&lt;=、&gt;、&lt;、BETWEEN和IN分片。分片算法需要应用方开发者自行实现，可实现的灵活度非常高。</p></blockquote><p>目前提供4种分片算法。由于分片算法和业务实现紧密相关，因此并未提供内置分片算法，而是通过分片策略将各种场景提炼出来，提供更高层级的抽象，并提供接口让应用开发者自行实现分片算法。</p><ul><li><strong>精确分片算法</strong></li></ul><p>对应PreciseShardingAlgorithm，用于处理使用单一键作为分片键的=与IN进行分片的场景。需要配合StandardShardingStrategy使用。</p><ul><li><strong>范围分片算法</strong></li></ul><p>对应RangeShardingAlgorithm，用于处理使用单一键作为分片键的<code>BETWEEN AND、&gt;、&lt;、&gt;=、&lt;=</code>进行分片的场景。需要配合StandardShardingStrategy使用。</p><ul><li><strong>复合分片算法</strong></li></ul><p>对应ComplexKeysShardingAlgorithm，用于处理使用多键作为分片键进行分片的场景，包含多个分片键的逻辑较复杂，需要应用开发者自行处理其中的复杂度。需要配合ComplexShardingStrategy使用。</p><ul><li><strong>Hint分片算法</strong></li></ul><p>对应HintShardingAlgorithm，用于处理使用Hint行分片的场景。需要配合HintShardingStrategy使用。</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717205845609.png" alt="image-20220717205845609" tabindex="0" loading="lazy"><figcaption>image-20220717205845609</figcaption></figure><h4 id="_1-2-3-分片策略" tabindex="-1"><a class="header-anchor" href="#_1-2-3-分片策略" aria-hidden="true">#</a> 1.2.3 分片策略</h4><blockquote><p>包含分片键和分片算法，由于分片算法的独立性，将其独立抽离。真正可用于分片操作的是分片键 + 分片算法，也就是分片策略。目前提供5种分片策略。</p></blockquote><ul><li><strong>标准分片策略</strong></li></ul><p>对应StandardShardingStrategy。提供对SQL语句中的<code>=, &gt;, &lt;, &gt;=, &lt;=, IN</code>和BETWEEN AND的分片操作支持。StandardShardingStrategy只支持单分片键，提供PreciseShardingAlgorithm和RangeShardingAlgorithm两个分片算法。PreciseShardingAlgorithm是必选的，用于处理=和IN的分片。RangeShardingAlgorithm是可选的，用于处理<code>BETWEEN AND, &gt;, &lt;, &gt;=, &lt;=</code>分片，如果不配置RangeShardingAlgorithm，SQL中的BETWEEN AND将按照全库路由处理。</p><ul><li><strong>复合分片策略</strong></li></ul><p>对应ComplexShardingStrategy。复合分片策略。提供对SQL语句中的<code>=, &gt;, &lt;, &gt;=, &lt;=, IN</code>和BETWEEN AND的分片操作支持。ComplexShardingStrategy支持多分片键，由于多分片键之间的关系复杂，因此并未进行过多的封装，而是直接将分片键值组合以及分片操作符透传至分片算法，完全由应用开发者实现，提供最大的灵活度。</p><ul><li><strong>行表达式分片策略</strong></li></ul><p>对应InlineShardingStrategy。使用Groovy的表达式，提供对SQL语句中的=和IN的分片操作支持，只支持单分片键。对于简单的分片算法，可以通过简单的配置使用，从而避免繁琐的Java代码开发，如: <code>t_user_$-&gt;{u_id % 8}</code> 表示t_user表根据u_id模8，而分成8张表，表名称为t_user_0到t_user_7。</p><ul><li><strong>Hint分片策略</strong></li></ul><p>对应HintShardingStrategy。通过Hint指定分片值而非从SQL中提取分片值的方式进行分片的策略。</p><ul><li><strong>不分片策略</strong></li></ul><p>对应NoneShardingStrategy。不分片的策略。</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717210154703.png" alt="image-20220717210154703" tabindex="0" loading="lazy"><figcaption>image-20220717210154703</figcaption></figure><h4 id="_1-2-4-sql-hint" tabindex="-1"><a class="header-anchor" href="#_1-2-4-sql-hint" aria-hidden="true">#</a> 1.2.4 SQL Hint</h4><p>对于分片字段非SQL决定，而由其他外置条件决定的场景，可使用SQL Hint灵活的注入分片字段。例：内部系统，按照员工登录主键分库，而数据库中并无此字段。SQL Hint支持通过Java API和SQL注释(待实现)两种方式使用。</p><h3 id="_1-3-shardingjdbc-内部结构" tabindex="-1"><a class="header-anchor" href="#_1-3-shardingjdbc-内部结构" aria-hidden="true">#</a> 1.3 ShardingJDBC 内部结构</h3><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717210304411.png" alt="image-20220717210304411" tabindex="0" loading="lazy"><figcaption>image-20220717210304411</figcaption></figure><ul><li><strong>黄色部分</strong></li></ul><p>图中黄色部分表示的是Sharding-JDBC的入口API，采用工厂方法的形式提供。 目前有ShardingDataSourceFactory和MasterSlaveDataSourceFactory两个工厂类。ShardingDataSourceFactory用于创建分库分表或分库分表+读写分离的JDBC驱动，MasterSlaveDataSourceFactory用于创建独立使用读写分离的JDBC驱动。</p><ul><li><strong>蓝色部分</strong></li></ul><p>图中蓝色部分表示的是Sharding-JDBC的配置对象，提供灵活多变的配置方式。 ShardingRuleConfiguration是分库分表配置的核心和入口，它可以包含多个TableRuleConfiguration和MasterSlaveRuleConfiguration。每一组相同规则分片的表配置一个TableRuleConfiguration。如果需要分库分表和读写分离共同使用，每一个读写分离的逻辑库配置一个MasterSlaveRuleConfiguration。 每个TableRuleConfiguration对应一个ShardingStrategyConfiguration，它有5中实现类可供选择。</p><p>仅读写分离使用MasterSlaveRuleConfiguration即可。</p><ul><li><strong>红色部分</strong></li></ul><p>图中红色部分表示的是内部对象，由Sharding-JDBC内部使用，应用开发者无需关注。Sharding-JDBC通过ShardingRuleConfiguration和MasterSlaveRuleConfiguration生成真正供ShardingDataSource和MasterSlaveDataSource使用的规则对象。ShardingDataSource和MasterSlaveDataSource实现了DataSource接口，是JDBC的完整实现方案。</p><h4 id="_1-3-1-初始化流程" tabindex="-1"><a class="header-anchor" href="#_1-3-1-初始化流程" aria-hidden="true">#</a> 1.3.1 初始化流程</h4><ol><li>配置Configuration对象。</li><li>通过Factory对象将Configuration对象转化为Rule对象。</li><li>通过Factory对象将Rule对象与DataSource对象装配。</li><li>Sharding-JDBC使用DataSource对象进行分库。</li></ol><h4 id="_1-3-2-使用约定" tabindex="-1"><a class="header-anchor" href="#_1-3-2-使用约定" aria-hidden="true">#</a> 1.3.2 使用约定</h4><p>在org.apache.shardingsphere.api和org.apache.shardingsphere.shardingjdbc.api 包中的类是面向用户的API，每次修改都会在release notes中明确声明。 其他包中的类属于内部实现，可能随时进行调整，请勿直接使用。</p><h2 id="_2-简单示例" tabindex="-1"><a class="header-anchor" href="#_2-简单示例" aria-hidden="true">#</a> 2. 简单示例</h2><blockquote><p>这里主要介绍SpringBoot集成基于ShardingJDBC的按字段分库，两种策略（标准分片策略 和 行表达式分片策略），主要承接之前的相关文章在JPA方式的基础上实现的。</p></blockquote><h3 id="_2-1-准备db和依赖配置" tabindex="-1"><a class="header-anchor" href="#_2-1-准备db和依赖配置" aria-hidden="true">#</a> 2.1 准备DB和依赖配置</h3><p>创建MySQL的schema test_db_tenant_a 和 test_db_tenant_b, 导入SQL 文件如下</p><p>test_db_tenant_a</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- MySQL dump 10.13  Distrib 8.0.28, for Win64 (x86_64)</span>
<span class="token comment">--</span>
<span class="token comment">-- Host: localhost    Database: test_db_tenant_a</span>
<span class="token comment">-- ------------------------------------------------------</span>
<span class="token comment">-- Server version	8.0.28</span>

<span class="token comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET NAMES utf8 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Table structure for table \`tb_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET character_set_client = utf8mb4 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_key<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>description<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>update_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>tenant<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3<span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Dumping data for table \`tb_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_role<span class="token punctuation">\`</span></span> <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_role\` DISABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_role\` ENABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Table structure for table \`tb_user\`</span>
<span class="token comment">--</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET character_set_client = utf8mb4 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>user_name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>email<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>phone_number<span class="token punctuation">\`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>description<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>update_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>tenant<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3<span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Dumping data for table \`tb_user\`</span>
<span class="token comment">--</span>

<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user<span class="token punctuation">\`</span></span> <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user\` DISABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user\` ENABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Table structure for table \`tb_user_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET character_set_client = utf8mb4 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>tenant<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3<span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Dumping data for table \`tb_user_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user_role<span class="token punctuation">\`</span></span> <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user_role\` DISABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user_role\` ENABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
<span class="token comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span><span class="token punctuation">;</span>

<span class="token comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class="token punctuation">;</span>

<span class="token comment">-- Dump completed on 2022-04-07 20:28:34</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>test_db_tenant_b</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- MySQL dump 10.13  Distrib 8.0.28, for Win64 (x86_64)</span>
<span class="token comment">--</span>
<span class="token comment">-- Host: localhost    Database: test_db_tenant_b</span>
<span class="token comment">-- ------------------------------------------------------</span>
<span class="token comment">-- Server version	8.0.28</span>

<span class="token comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET NAMES utf8 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Table structure for table \`tb_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET character_set_client = utf8mb4 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_key<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>description<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>update_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>tenant<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3<span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Dumping data for table \`tb_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_role<span class="token punctuation">\`</span></span> <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_role\` DISABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_role\` ENABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Table structure for table \`tb_user\`</span>
<span class="token comment">--</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET character_set_client = utf8mb4 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>user_name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>email<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>phone_number<span class="token punctuation">\`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>description<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>update_time<span class="token punctuation">\`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>tenant<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3<span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Dumping data for table \`tb_user\`</span>
<span class="token comment">--</span>

<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user<span class="token punctuation">\`</span></span> <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user\` DISABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user\` ENABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Table structure for table \`tb_user_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="token punctuation">;</span>
<span class="token comment">/*!50503 SET character_set_client = utf8mb4 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>tenant<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3<span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Dumping data for table \`tb_user_role\`</span>
<span class="token comment">--</span>

<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> <span class="token identifier"><span class="token punctuation">\`</span>tb_user_role<span class="token punctuation">\`</span></span> <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user_role\` DISABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40000 ALTER TABLE \`tb_user_role\` ENABLE KEYS */</span><span class="token punctuation">;</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
<span class="token comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span><span class="token punctuation">;</span>

<span class="token comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class="token punctuation">;</span>

<span class="token comment">-- Dump completed on 2022-04-07 20:28:29</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>引入maven依赖, 包含mysql驱动，JPA包, 以及sharding-jdbc的依赖。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.wenhao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jpa-spec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>增加yml配置</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>a<span class="token punctuation">,</span>tenant<span class="token punctuation">-</span>b
      <span class="token key atrule">tenant-a</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_a<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> bfXa4Pt2lUUScy8jakXf
      <span class="token key atrule">tenant-b</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_b<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> bfXa4Pt2lUUScy8jakXf
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-database-strategy</span><span class="token punctuation">:</span>
        <span class="token comment"># way 1: standard strategy</span>
        <span class="token comment"># standard:</span>
        <span class="token comment">#  precise-algorithm-class-name: tech.pdai.springboot.shardingjdbc.jpa.tenant.db.config.MyPreciseShardingDBAlgorithm</span>
        <span class="token comment">#  sharding-column: tenant</span>
        <span class="token comment"># way 2: inline strategy</span>
        <span class="token key atrule">inline</span><span class="token punctuation">:</span>
          <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> tenant
          <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>tenant<span class="token punctuation">}</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
        <span class="token key atrule">tb_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
        <span class="token key atrule">tb_user_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user<span class="token punctuation">,</span>tb_role<span class="token punctuation">,</span>tb_user_role
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-entity" tabindex="-1"><a class="header-anchor" href="#_2-2-entity" aria-hidden="true">#</a> 2.2 Entity</h3><p>user entity</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">CascadeType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Column</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Entity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">FetchType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GeneratedValue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GenerationType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">JoinColumn</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">JoinTable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">ManyToMany</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Table</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">BaseEntity</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * user id.
     */</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * username.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * user pwd.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * email.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * phoneNumber.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> phoneNumber<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * description.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * create date time.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * update date time.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updateTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * tenant.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tenant<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * join to role table.
     */</span>
    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">REFRESH</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">EAGER</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user_role&quot;</span><span class="token punctuation">,</span> joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>role entity</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_role&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token keyword">implements</span> <span class="token class-name">BaseEntity</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * role id.
     */</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * role name.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * role key.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> roleKey<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * description.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * create date time.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * update date time.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updateTime<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * tenant.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tenant<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-dao" tabindex="-1"><a class="header-anchor" href="#_2-3-dao" aria-hidden="true">#</a> 2.3 DAO</h3><p>user dao</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDao</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>role dao</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Role</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRoleDao</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-service" tabindex="-1"><a class="header-anchor" href="#_2-4-service" aria-hidden="true">#</a> 2.4 Service</h3><p>user service 接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">UserQueryBean</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserService</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * find by page.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">userQueryBean</span> query
     * <span class="token keyword">@param</span> <span class="token parameter">pageRequest</span>   pageRequest
     * <span class="token keyword">@return</span> page
     */</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPage</span><span class="token punctuation">(</span><span class="token class-name">UserQueryBean</span> userQueryBean<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>user service 实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>wenhao<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span></span><span class="token class-name">Specifications</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Specification</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IBaseDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IUserDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">UserQueryBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IUserService</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDoServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDoServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IUserService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * userDao.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">IUserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * init.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">userDao2</span> user dao
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDoServiceImpl</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">IUserDao</span> userDao2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userDao <span class="token operator">=</span> userDao2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@return</span> base dao
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IBaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBaseDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userDao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * find by page.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">queryBean</span>   query
     * <span class="token keyword">@param</span> <span class="token parameter">pageRequest</span> pageRequest
     * <span class="token keyword">@return</span> page
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPage</span><span class="token punctuation">(</span><span class="token class-name">UserQueryBean</span> queryBean<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span> pageRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> specification <span class="token operator">=</span> <span class="token class-name">Specifications</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getTenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;tenant&quot;</span><span class="token punctuation">,</span> queryBean<span class="token punctuation">.</span><span class="token function">getTenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;user_name&quot;</span><span class="token punctuation">,</span> queryBean<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span>
                        queryBean<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBaseDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>specification<span class="token punctuation">,</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>role service 接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Role</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">RoleQueryBean</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRoleService</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * find page by query.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">roleQueryBean</span> query
     * <span class="token keyword">@param</span> <span class="token parameter">pageRequest</span>   pageRequest
     * <span class="token keyword">@return</span> page
     */</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPage</span><span class="token punctuation">(</span><span class="token class-name">RoleQueryBean</span> roleQueryBean<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>role service 实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>wenhao<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span></span><span class="token class-name">Specifications</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Specification</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IBaseDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IRoleDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Role</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">RoleQueryBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IRoleService</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleDoServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDoServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IRoleService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * roleDao.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">IRoleDao</span> roleDao<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * init.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">roleDao2</span> role dao
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">RoleDoServiceImpl</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">IRoleDao</span> roleDao2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>roleDao <span class="token operator">=</span> roleDao2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@return</span> base dao
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IBaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBaseDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roleDao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * find page by query.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">roleQueryBean</span> query
     * <span class="token keyword">@param</span> <span class="token parameter">pageRequest</span>   pageRequest
     * <span class="token keyword">@return</span> page
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPage</span><span class="token punctuation">(</span><span class="token class-name">RoleQueryBean</span> roleQueryBean<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span> pageRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> specification <span class="token operator">=</span> <span class="token class-name">Specifications</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>roleQueryBean<span class="token punctuation">.</span><span class="token function">getTenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;tenant&quot;</span><span class="token punctuation">,</span> roleQueryBean<span class="token punctuation">.</span><span class="token function">getTenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>roleQueryBean<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
                        roleQueryBean<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>roleQueryBean<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span>
                        roleQueryBean<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roleDao<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>specification<span class="token punctuation">,</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-controller" tabindex="-1"><a class="header-anchor" href="#_2-5-controller" aria-hidden="true">#</a> 2.5 Controller</h3><p>user controller</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">UserQueryBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>response<span class="token punctuation">.</span></span><span class="token class-name">ResponseResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IUserService</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserService</span> userService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">user</span> user param
     * <span class="token keyword">@return</span> user
     */</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;Add/Edit User&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>userService<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * <span class="token keyword">@return</span> user list
     */</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;Query User One&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;edit/{userId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@return</span> user list
     */</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;Query User Page&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Page</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">int</span> pageNumber<span class="token punctuation">,</span> <span class="token class-name">String</span> tenant<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">findPage</span><span class="token punctuation">(</span><span class="token class-name">UserQueryBean</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tenant</span><span class="token punctuation">(</span>tenant<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-简单测试" tabindex="-1"><a class="header-anchor" href="#_2-6-简单测试" aria-hidden="true">#</a> 2.6 简单测试</h3><p>访问页面：</p>`,78),v={href:"http://localhost:8080/doc.html",target:"_blank",rel:"noopener noreferrer"},b=t(`<p>插入数据</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717211255832.png" alt="image-20220717211255832" tabindex="0" loading="lazy"><figcaption>image-20220717211255832</figcaption></figure><p>DB 中对应schema中的数据</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717211329998.png" alt="image-20220717211329998" tabindex="0" loading="lazy"><figcaption>image-20220717211329998</figcaption></figure><p>查询数据</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717211351781.png" alt="image-20220717211351781" tabindex="0" loading="lazy"><figcaption>image-20220717211351781</figcaption></figure><p>相关查询console打印出的日志：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.755  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: insert into tb_user <span class="token punctuation">(</span>create_time, description, email, password, phone_number, tenant, update_time, user_name<span class="token punctuation">)</span> values <span class="token punctuation">(</span>?, ?, ?, ?, ?, ?, ?, ?<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.755  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: InsertStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.InsertStatement@67776a98, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@1d5f5394<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@1d5f5394, <span class="token assign-left variable">columnNames</span><span class="token operator">=</span><span class="token punctuation">[</span>create_time, description, email, password, phone_number, tenant, update_time, user_name<span class="token punctuation">]</span>, <span class="token assign-left variable">insertValueContexts</span><span class="token operator">=</span><span class="token punctuation">[</span>InsertValueContext<span class="token punctuation">(</span>parametersCount<span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">valueExpressions</span><span class="token operator">=</span><span class="token punctuation">[</span>ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">118</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">118</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">121</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">121</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">124</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">124</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">127</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">127</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">130</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">130</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">133</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">133</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">136</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">136</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">139</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">139</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>, DerivedParameterMarkerExpressionSegment<span class="token punctuation">(</span>super<span class="token operator">=</span>ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">))</span><span class="token punctuation">]</span>, <span class="token assign-left variable">parameters</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.323, pdai-b, pdai2@pdai.tech, dad23b, <span class="token number">1212121212</span>, b, <span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.323, pdai23b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>, <span class="token assign-left variable">generatedKeyContext</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>GeneratedKeyContext<span class="token punctuation">(</span>columnName<span class="token operator">=</span>id, <span class="token assign-left variable">generated</span><span class="token operator">=</span>true, <span class="token assign-left variable">generatedValues</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.755  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-b ::: insert into tb_user <span class="token punctuation">(</span>create_time, description, email, password, phone_number, tenant, update_time, user_name, <span class="token function">id</span><span class="token punctuation">)</span> values <span class="token punctuation">(</span>?, ?, ?, ?, ?, ?, ?, ?, ?<span class="token punctuation">)</span> ::: <span class="token punctuation">[</span><span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.323, pdai-b, pdai2@pdai.tech, dad23b, <span class="token number">1212121212</span>, b, <span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.323, pdai23b, <span class="token number">719173465277968384</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.849  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> user0_.id as id1_1_0_, user0_.create_time as create_t2_1_0_, user0_.description as descript3_1_0_, user0_.email as email4_1_0_, user0_.password as password5_1_0_, user0_.phone_number as phone_nu6_1_0_, user0_.tenant as tenant7_1_0_, user0_.update_time as update_t8_1_0_, user0_.user_name as user_nam9_1_0_, roles1_.user_id as user_id1_2_1_, role2_.id as role_id2_2_1_, role2_.id as id1_0_2_, role2_.create_time as create_t2_0_2_, role2_.description as descript3_0_2_, role2_.name as name4_0_2_, role2_.role_key as role_key5_0_2_, role2_.tenant as tenant6_0_2_, role2_.update_time as update_t7_0_2_ from tb_user user0_ left outer <span class="token function">join</span> tb_user_role roles1_ on <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>roles1_.user_id left outer <span class="token function">join</span> tb_role role2_ on <span class="token assign-left variable">roles1_.role_id</span><span class="token operator">=</span>role2_.id where <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>?
<span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.849  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@8ca5ff1, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@120db4fa<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@120db4fa, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">603</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>email, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>email4_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>password, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>password5_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>phone_number, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>phone_nu6_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>tenant, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>tenant7_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t8_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_nam9_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_id1_2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_id2_2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>name4_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_key, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_key5_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>tenant, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>tenant6_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t7_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@419cdd89, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@5c35abd5, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@6da5275, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.849  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-b ::: <span class="token keyword">select</span> user0_.id as id1_1_0_, user0_.create_time as create_t2_1_0_, user0_.description as descript3_1_0_, user0_.email as email4_1_0_, user0_.password as password5_1_0_, user0_.phone_number as phone_nu6_1_0_, user0_.tenant as tenant7_1_0_, user0_.update_time as update_t8_1_0_, user0_.user_name as user_nam9_1_0_, roles1_.user_id as user_id1_2_1_, role2_.id as role_id2_2_1_, role2_.id as id1_0_2_, role2_.create_time as create_t2_0_2_, role2_.description as descript3_0_2_, role2_.name as name4_0_2_, role2_.role_key as role_key5_0_2_, role2_.tenant as tenant6_0_2_, role2_.update_time as update_t7_0_2_ from tb_user user0_ left outer <span class="token function">join</span> tb_user_role roles1_ on <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>roles1_.user_id left outer <span class="token function">join</span> tb_role role2_ on <span class="token assign-left variable">roles1_.role_id</span><span class="token operator">=</span>role2_.id where <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">20</span>:58:35.849  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> user0_.id as id1_1_0_, user0_.create_time as create_t2_1_0_, user0_.description as descript3_1_0_, user0_.email as email4_1_0_, user0_.password as password5_1_0_, user0_.phone_number as phone_nu6_1_0_, user0_.tenant as tenant7_1_0_, user0_.update_time as update_t8_1_0_, user0_.user_name as user_nam9_1_0_, roles1_.user_id as user_id1_2_1_, role2_.id as role_id2_2_1_, role2_.id as id1_0_2_, role2_.create_time as create_t2_0_2_, role2_.description as descript3_0_2_, role2_.name as name4_0_2_, role2_.role_key as role_key5_0_2_, role2_.tenant as tenant6_0_2_, role2_.update_time as update_t7_0_2_ from tb_user user0_ left outer <span class="token function">join</span> tb_user_role roles1_ on <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>roles1_.user_id left outer <span class="token function">join</span> tb_role role2_ on <span class="token assign-left variable">roles1_.role_id</span><span class="token operator">=</span>role2_.id where <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.876  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> user0_.id as id1_1_, user0_.create_time as create_t2_1_, user0_.description as descript3_1_, user0_.email as email4_1_, user0_.password as password5_1_, user0_.phone_number as phone_nu6_1_, user0_.tenant as tenant7_1_, user0_.update_time as update_t8_1_, user0_.user_name as user_nam9_1_ from tb_user user0_ where <span class="token assign-left variable">user0_.tenant</span><span class="token operator">=</span>? limit ?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.877  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@15243518, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@23f84ca7<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@23f84ca7, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">293</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>email, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>email4_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>password, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>password5_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>phone_number, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>phone_nu6_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>tenant, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>tenant7_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t8_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_nam9_1_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@18e2796e, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@6a16cbdf, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@5eaeaf70, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.877  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-b ::: <span class="token keyword">select</span> user0_.id as id1_1_, user0_.create_time as create_t2_1_, user0_.description as descript3_1_, user0_.email as email4_1_, user0_.password as password5_1_, user0_.phone_number as phone_nu6_1_, user0_.tenant as tenant7_1_, user0_.update_time as update_t8_1_, user0_.user_name as user_nam9_1_ from tb_user user0_ where <span class="token assign-left variable">user0_.tenant</span><span class="token operator">=</span>? limit ? ::: <span class="token punctuation">[</span>b, <span class="token number">10</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.890  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.tenant as tenant6_0_1_, role1_.update_time as update_t7_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.890  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@5e7c4e50, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@6f2681ce<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@6f2681ce, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">302</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_id1_2_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_id2_2_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>name4_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_key, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_key5_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>tenant, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>tenant6_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t7_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@3212b90b, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@516424e5, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@6d56fe57, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.890  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-b ::: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.tenant as tenant6_0_1_, role1_.update_time as update_t7_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.890  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.tenant as tenant6_0_1_, role1_.update_time as update_t7_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-进一步理解" tabindex="-1"><a class="header-anchor" href="#_3-进一步理解" aria-hidden="true">#</a> 3. 进一步理解</h2><h3 id="_3-1-如果使用standard策略如何" tabindex="-1"><a class="header-anchor" href="#_3-1-如果使用standard策略如何" aria-hidden="true">#</a> 3.1 如果使用standard策略如何？</h3><blockquote><p>上述inline策略也可以改成standard策略，效果一样。</p></blockquote><p>首先自定义PreciseShardingAlgorithm算法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>db<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">PreciseShardingAlgorithm</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">PreciseShardingValue</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * This class is for MyPreciseShardingDBAlgorithm.
 *
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPreciseShardingDBAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">PreciseShardingAlgorithm</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DATABASE_TENANT_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;tenant-&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">availableTargetNames</span> tenant-a, tenant-b
     * <span class="token keyword">@param</span> <span class="token parameter">shardingValue</span>        sharding value
     * <span class="token keyword">@return</span> targetDb
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doSharding</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> availableTargetNames<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">PreciseShardingValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> shardingValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> targetDb <span class="token operator">=</span> <span class="token constant">DATABASE_TENANT_PREFIX</span> <span class="token operator">+</span> shardingValue<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>availableTargetNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>targetDb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> targetDb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;UnsupportedOperationException: &quot;</span> <span class="token operator">+</span> shardingValue<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后配置sharding.default-database-strategy为standard，具体如下</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>a<span class="token punctuation">,</span>tenant<span class="token punctuation">-</span>b
      <span class="token key atrule">tenant-a</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_a<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> bfXa4Pt2lUUScy8jakXf
      <span class="token key atrule">tenant-b</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_b<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> bfXa4Pt2lUUScy8jakXf
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-database-strategy</span><span class="token punctuation">:</span>
        <span class="token comment"># way 1: standard strategy</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">precise-algorithm-class-name</span><span class="token punctuation">:</span> tech.pdai.springboot.shardingjdbc.jpa.tenant.db.config.MyPreciseShardingDBAlgorithm
          <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> tenant
        <span class="token comment"># way 2: inline strategy</span>
<span class="token comment">#        inline:</span>
<span class="token comment">#          sharding-column: tenant</span>
<span class="token comment">#          algorithm-expression: tenant-$-&gt;{tenant}</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
        <span class="token key atrule">tb_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
        <span class="token key atrule">tb_user_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user<span class="token punctuation">,</span>tb_role<span class="token punctuation">,</span>tb_user_role
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-上述两种策略存在什么问题" tabindex="-1"><a class="header-anchor" href="#_3-2-上述两种策略存在什么问题" aria-hidden="true">#</a> 3.2 上述两种策略存在什么问题？</h3><blockquote><p>上面两种策略存在什么问题呢？</p></blockquote><ul><li><strong>侵入性</strong>： DB层和代码层</li></ul><p>上述两种模式需要增加一个新的字段tenant, 并且根据这个字段来对不同租户进行sharding（db级别或者table级别）； 这时候你会发现所有的查询必须要有tenant这个字段，这意味着所有的方法都支持tenant查询。一旦没有全部支持，你会看到Actual SQL会执行多次（每个DB一次）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.890  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-b ::: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.tenant as tenant6_0_1_, role1_.update_time as update_t7_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:03:33.890  INFO <span class="token number">8256</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.tenant as tenant6_0_1_, role1_.update_time as update_t7_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719173465277968384</span><span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>租户之外的数据</strong></li></ul><p>比如系统级别的管理人员数据，元数据等，需要独立一个DB； 虽然可以通过一些配置来解决一些场景，但是上述两种方式的动态性不够（场景变动意味着推翻这两种模式）。</p><h3 id="_3-3-如何使用hint强制路由方式" tabindex="-1"><a class="header-anchor" href="#_3-3-如何使用hint强制路由方式" aria-hidden="true">#</a> 3.3 如何使用Hint强制路由方式？</h3><blockquote><p>针对侵入性的问题，就多租户的场景下而言，可以通过Hint强制路由策略解决。</p></blockquote><p>首先我们需要定义个拦截的APO切面, 对数据操作层进行拦截。通过hintManager设置ShardingValue, 实际环境将client信息放在xxxContext中（由ThreadLocal承接），并通过client-id来获取tenant。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>dbhint<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>hint<span class="token punctuation">.</span></span><span class="token class-name">HintManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Before</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Pointcut</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TenantDatasourceAspect</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * point cut.
     */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* tech.pdai.springboot.shardingjdbc.jpa.tenant.dbhint.dao.*.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">useTenantDSPointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// no impl</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;useTenantDSPointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doDs0Before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// pdai: 实际环境将client信息放在xxxContext中（由ThreadLocal承接），并通过client-id来获取tenant.</span>
        <span class="token comment">// 这里为了方便演示，只是使用了tenant-a</span>
        hintManager<span class="token punctuation">.</span><span class="token function">setDatabaseShardingValue</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;useTenantDSPointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doDs0after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后自定义HintShardingAlgorithm实现类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>tenant<span class="token punctuation">.</span>dbhint<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span>hint<span class="token punctuation">.</span></span><span class="token class-name">HintShardingAlgorithm</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span>hint<span class="token punctuation">.</span></span><span class="token class-name">HintShardingValue</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHintShardingDBAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">HintShardingAlgorithm</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Sharding.
     *
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>sharding value injected by hint, not in SQL.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword">@param</span> <span class="token parameter">availableTargetNames</span> available data sources or tables&#39;s names
     * <span class="token keyword">@param</span> <span class="token parameter">shardingValue</span>        sharding value
     * <span class="token keyword">@return</span> sharding result for data sources or tables&#39;s names
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">doSharding</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> availableTargetNames<span class="token punctuation">,</span> <span class="token class-name">HintShardingValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> shardingValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> shardingValue<span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>availableTargetNames<span class="token operator">::</span><span class="token function">contains</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在配置中配置sharding.default-database-strategy为inline</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>a<span class="token punctuation">,</span>tenant<span class="token punctuation">-</span>b
      <span class="token key atrule">tenant-a</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_a<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> bfXa4Pt2lUUScy8jakXf
      <span class="token key atrule">tenant-b</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_b<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> bfXa4Pt2lUUScy8jakXf
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-database-strategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">hint</span><span class="token punctuation">:</span>
          <span class="token key atrule">algorithm-class-name</span><span class="token punctuation">:</span> tech.pdai.springboot.shardingjdbc.jpa.tenant.dbhint.config.MyHintShardingDBAlgorithm
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
        <span class="token key atrule">tb_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
        <span class="token key atrule">tb_user_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user<span class="token punctuation">,</span>tb_role<span class="token punctuation">,</span>tb_user_role
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问页面：</p>`,31),_={href:"http://localhost:8080/doc.html",target:"_blank",rel:"noopener noreferrer"},g=t(`<p>插入数据，会进入hint策略对应的算法</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717212104640.png" alt="image-20220717212104640" tabindex="0" loading="lazy"><figcaption>image-20220717212104640</figcaption></figure><p>成功插入数据（因为我们上面hintManager中是tenant-a)</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717212128817.png" alt="image-20220717212128817" tabindex="0" loading="lazy"><figcaption>image-20220717212128817</figcaption></figure><p>DB 中对应schema中的数据</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717212149832.png" alt="image-20220717212149832" tabindex="0" loading="lazy"><figcaption>image-20220717212149832</figcaption></figure><p>查询数据</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220717212211601.png" alt="image-20220717212211601" tabindex="0" loading="lazy"><figcaption>image-20220717212211601</figcaption></figure><p>执行console log</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2022</span>-04-08 <span class="token number">21</span>:38:49.473  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: insert into tb_user <span class="token punctuation">(</span>create_time, description, email, password, phone_number, update_time, user_name<span class="token punctuation">)</span> values <span class="token punctuation">(</span>?, ?, ?, ?, ?, ?, ?<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:38:49.473  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: InsertStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.InsertStatement@3f8ce2d6, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@7845fc58<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@7845fc58, <span class="token assign-left variable">columnNames</span><span class="token operator">=</span><span class="token punctuation">[</span>create_time, description, email, password, phone_number, update_time, user_name<span class="token punctuation">]</span>, <span class="token assign-left variable">insertValueContexts</span><span class="token operator">=</span><span class="token punctuation">[</span>InsertValueContext<span class="token punctuation">(</span>parametersCount<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">valueExpressions</span><span class="token operator">=</span><span class="token punctuation">[</span>ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">110</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">110</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">113</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">113</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">116</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">116</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">119</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">119</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">122</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">122</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">125</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">125</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>, ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">128</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">128</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>, DerivedParameterMarkerExpressionSegment<span class="token punctuation">(</span>super<span class="token operator">=</span>ParameterMarkerExpressionSegment<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">parameterMarkerIndex</span><span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span><span class="token punctuation">]</span>, <span class="token assign-left variable">parameters</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2022</span>-04-08 <span class="token number">21</span>:37:45.061, pdai-hint-a, pdai2@pdai.tech, dad23i-hint-a, <span class="token number">0</span>, <span class="token number">2022</span>-04-08 <span class="token number">21</span>:37:45.061, pdai23i-hint-a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>, <span class="token assign-left variable">generatedKeyContext</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>GeneratedKeyContext<span class="token punctuation">(</span>columnName<span class="token operator">=</span>id, <span class="token assign-left variable">generated</span><span class="token operator">=</span>true, <span class="token assign-left variable">generatedValues</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">719183321087062016</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:38:49.473  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: insert into tb_user <span class="token punctuation">(</span>create_time, description, email, password, phone_number, update_time, user_name, <span class="token function">id</span><span class="token punctuation">)</span> values <span class="token punctuation">(</span>?, ?, ?, ?, ?, ?, ?, ?<span class="token punctuation">)</span> ::: <span class="token punctuation">[</span><span class="token number">2022</span>-04-08 <span class="token number">21</span>:37:45.061, pdai-hint-a, pdai2@pdai.tech, dad23i-hint-a, <span class="token number">0</span>, <span class="token number">2022</span>-04-08 <span class="token number">21</span>:37:45.061, pdai23i-hint-a, <span class="token number">719183321087062016</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:38:53.287  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> user0_.id as id1_1_0_, user0_.create_time as create_t2_1_0_, user0_.description as descript3_1_0_, user0_.email as email4_1_0_, user0_.password as password5_1_0_, user0_.phone_number as phone_nu6_1_0_, user0_.update_time as update_t7_1_0_, user0_.user_name as user_nam8_1_0_, roles1_.user_id as user_id1_2_1_, role2_.id as role_id2_2_1_, role2_.id as id1_0_2_, role2_.create_time as create_t2_0_2_, role2_.description as descript3_0_2_, role2_.name as name4_0_2_, role2_.role_key as role_key5_0_2_, role2_.update_time as update_t6_0_2_ from tb_user user0_ left outer <span class="token function">join</span> tb_user_role roles1_ on <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>roles1_.user_id left outer <span class="token function">join</span> tb_role role2_ on <span class="token assign-left variable">roles1_.role_id</span><span class="token operator">=</span>role2_.id where <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:38:53.287  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@602d359e, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@3bf8fb09<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@3bf8fb09, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">541</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>email, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>email4_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>password, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>password5_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>phone_number, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>phone_nu6_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t7_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_nam8_1_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_id1_2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_id2_2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>name4_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_key, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_key5_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role2_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t6_0_2_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@17cddd9a, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@43769c72, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@4afed047, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:38:53.287  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> user0_.id as id1_1_0_, user0_.create_time as create_t2_1_0_, user0_.description as descript3_1_0_, user0_.email as email4_1_0_, user0_.password as password5_1_0_, user0_.phone_number as phone_nu6_1_0_, user0_.update_time as update_t7_1_0_, user0_.user_name as user_nam8_1_0_, roles1_.user_id as user_id1_2_1_, role2_.id as role_id2_2_1_, role2_.id as id1_0_2_, role2_.create_time as create_t2_0_2_, role2_.description as descript3_0_2_, role2_.name as name4_0_2_, role2_.role_key as role_key5_0_2_, role2_.update_time as update_t6_0_2_ from tb_user user0_ left outer <span class="token function">join</span> tb_user_role roles1_ on <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>roles1_.user_id left outer <span class="token function">join</span> tb_role role2_ on <span class="token assign-left variable">roles1_.role_id</span><span class="token operator">=</span>role2_.id where <span class="token assign-left variable">user0_.id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719183321087062016</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:39:26.996  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> user0_.id as id1_1_, user0_.create_time as create_t2_1_, user0_.description as descript3_1_, user0_.email as email4_1_, user0_.password as password5_1_, user0_.phone_number as phone_nu6_1_, user0_.update_time as update_t7_1_, user0_.user_name as user_nam8_1_ from tb_user user0_ where <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">1</span> limit ?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:39:26.997  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@2dbe7c04, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@7ce6951d<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@7ce6951d, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">264</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>email, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>email4_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>password, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>password5_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>phone_number, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>phone_nu6_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t7_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_nam8_1_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@77b55ac4, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@765e7ff9, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@28de736a, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:39:26.997  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> user0_.id as id1_1_, user0_.create_time as create_t2_1_, user0_.description as descript3_1_, user0_.email as email4_1_, user0_.password as password5_1_, user0_.phone_number as phone_nu6_1_, user0_.update_time as update_t7_1_, user0_.user_name as user_nam8_1_ from tb_user user0_ where <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">1</span> limit ? ::: <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:39:27.004  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.update_time as update_t6_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:39:27.005  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@17b5967d, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@7ac1dcb9<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@7ac1dcb9, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">271</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_id1_2_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_id2_2_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>name4_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_key, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_key5_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t6_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@68d9e73a, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@6331421f, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@580c367a, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:39:27.005  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-2<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.update_time as update_t6_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719183321087062016</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:40:28.220  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-4<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> user0_.id as id1_1_, user0_.create_time as create_t2_1_, user0_.description as descript3_1_, user0_.email as email4_1_, user0_.password as password5_1_, user0_.phone_number as phone_nu6_1_, user0_.update_time as update_t7_1_, user0_.user_name as user_nam8_1_ from tb_user user0_ where <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">1</span> limit ?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:40:28.220  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-4<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@2dbe7c04, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@5c74176f<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@5c74176f, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">264</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>email, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>email4_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>password, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>password5_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>phone_number, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>phone_nu6_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t7_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>user0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_nam8_1_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@19769285, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@2caf7930, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@28258a73, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:40:28.220  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-4<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> user0_.id as id1_1_, user0_.create_time as create_t2_1_, user0_.description as descript3_1_, user0_.email as email4_1_, user0_.password as password5_1_, user0_.phone_number as phone_nu6_1_, user0_.update_time as update_t7_1_, user0_.user_name as user_nam8_1_ from tb_user user0_ where <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">1</span> limit ? ::: <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:40:28.221  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-4<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Logic SQL: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.update_time as update_t6_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>?
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:40:28.221  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-4<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> SQLStatement: SelectStatementContext<span class="token punctuation">(</span>super<span class="token operator">=</span>CommonSQLStatementContext<span class="token punctuation">(</span>sqlStatement<span class="token operator">=</span>org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement@17b5967d, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@14ffd315<span class="token punctuation">)</span>, <span class="token assign-left variable">tablesContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.table.TablesContext@14ffd315, <span class="token assign-left variable">projectionsContext</span><span class="token operator">=</span>ProjectionsContext<span class="token punctuation">(</span>startIndex<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stopIndex</span><span class="token operator">=</span><span class="token number">271</span>, <span class="token assign-left variable">distinctRow</span><span class="token operator">=</span>false, <span class="token assign-left variable">projections</span><span class="token operator">=</span><span class="token punctuation">[</span>ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>user_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>user_id1_2_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>roles0_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_id2_2_0_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>id, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>id1_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>create_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>create_t2_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>description, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>descript3_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>name, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>name4_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>role_key, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>role_key5_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span>, ColumnProjection<span class="token punctuation">(</span>owner<span class="token operator">=</span>role1_, <span class="token assign-left variable">name</span><span class="token operator">=</span>update_time, <span class="token assign-left variable">alias</span><span class="token operator">=</span>Optional<span class="token punctuation">[</span>update_t6_0_1_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>, <span class="token assign-left variable">groupByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.groupby.GroupByContext@6aff8332, <span class="token assign-left variable">orderByContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.orderby.OrderByContext@32acce81, <span class="token assign-left variable">paginationContext</span><span class="token operator">=</span>org.apache.shardingsphere.sql.parser.binder.segment.select.pagination.PaginationContext@70f82e86, <span class="token assign-left variable">containsSubquery</span><span class="token operator">=</span>false<span class="token punctuation">)</span>
<span class="token number">2022</span>-04-08 <span class="token number">21</span>:40:28.221  INFO <span class="token number">13136</span> --- <span class="token punctuation">[</span>nio-8080-exec-4<span class="token punctuation">]</span> ShardingSphere-SQL                       <span class="token builtin class-name">:</span> Actual SQL: tenant-a ::: <span class="token keyword">select</span> roles0_.user_id as user_id1_2_0_, roles0_.role_id as role_id2_2_0_, role1_.id as id1_0_1_, role1_.create_time as create_t2_0_1_, role1_.description as descript3_0_1_, role1_.name as name4_0_1_, role1_.role_key as role_key5_0_1_, role1_.update_time as update_t6_0_1_ from tb_user_role roles0_ inner <span class="token function">join</span> tb_role role1_ on <span class="token assign-left variable">roles0_.role_id</span><span class="token operator">=</span>role1_.id where <span class="token assign-left variable">roles0_.user_id</span><span class="token operator">=</span>? ::: <span class="token punctuation">[</span><span class="token number">719183321087062016</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,11),y={href:"https://pdai.tech/md/spring/springboot/springboot-x-mysql-shardingjdbc-jpa-tenant-db.html",target:"_blank",rel:"noopener noreferrer"},h=n("strong",null,"SpringBoot集成ShardingJDBC - 基于JPA的DB隔离多租户方案",-1);function f(w,S){const a=l("ExternalLinkIcon");return o(),c("div",null,[u,n("blockquote",null,[n("p",null,[s("如下内容来自"),n("a",r,[s("官网"),e(a)])])]),k,n("blockquote",null,[n("p",null,[s("如下内容来自"),n("a",d,[s("官网"),e(a)])])]),m,n("p",null,[n("a",v,[s("http://localhost:8080/doc.html"),e(a)])]),b,n("p",null,[n("a",_,[s("http://localhost:8080/doc.html"),e(a)])]),g,n("p",null,[n("a",y,[h,e(a)])])])}const L=p(i,[["render",f],["__file","sharding-jdbc-x-tenant.html.vue"]]);export{L as default};
