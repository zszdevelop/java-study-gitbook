import{_ as n,W as s,X as a,a0 as t}from"./framework-0cf5f349.js";const e={},p=t(`<h1 id="solr命中关键字高亮不准确" tabindex="-1"><a class="header-anchor" href="#solr命中关键字高亮不准确" aria-hidden="true">#</a> Solr命中关键字高亮不准确</h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介" aria-hidden="true">#</a> 1. 简介</h2><p>solr 在搜索时，明明搜索的是 A词组，但是B 词组也亮了，而且在 分词解析器中，怎么设置都不可能出现这种情况</p><p>因涉及一些内部数据，就不放截图了</p><h2 id="_2-原因分析" tabindex="-1"><a class="header-anchor" href="#_2-原因分析" aria-hidden="true">#</a> 2. 原因分析</h2><p>经过不断的排查，确定问题的原因是出现多词语搜索的情况</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>a_ik:张 OR  b_s:*张*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们需要过滤多个词，在ik 的时候是直接搜索词，在string下是搜索like 匹配。</p><p>solr 默认情况，我们虽然搜索的是不同字段，但<strong>高亮</strong>时他还是会用b的条件带入a用做高亮</p><p>我们需要指定</p><ul><li><strong>hl.requireFieldMatch， 必须字段匹配</strong></li></ul><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220418155546278.png" alt="image-20220418155546278" tabindex="0" loading="lazy"><figcaption>image-20220418155546278</figcaption></figure><h2 id="_3-代码设置" tabindex="-1"><a class="header-anchor" href="#_3-代码设置" aria-hidden="true">#</a> 3. 代码设置</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addHighlight</span><span class="token punctuation">(</span><span class="token class-name">AjSearchRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">SolrQuery</span> sq<span class="token punctuation">,</span> <span class="token class-name">String</span> highlightField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//如果存在高亮字段则高亮显示</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getSearchContentList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sq<span class="token punctuation">.</span><span class="token function">setHighlight</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sq<span class="token punctuation">.</span><span class="token function">setHighlightSimplePre</span><span class="token punctuation">(</span><span class="token constant">HIGHHIGHT_PRE_PRIX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sq<span class="token punctuation">.</span><span class="token function">setHighlightSimplePost</span><span class="token punctuation">(</span><span class="token constant">HIGHLIGHT_POST_PRIX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sq<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hl.fl&quot;</span><span class="token punctuation">,</span> highlightField<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sq<span class="token punctuation">.</span><span class="token function">setHighlightRequireFieldMatch</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sq<span class="token punctuation">.</span><span class="token function">setHighlightFragsize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14),i=[p];function c(o,l){return s(),a("div",null,i)}const r=n(e,[["render",c],["__file","solr-i-highlight.html.vue"]]);export{r as default};
