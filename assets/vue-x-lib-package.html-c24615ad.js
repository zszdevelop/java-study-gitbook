import{_ as p,W as i,X as o,Y as n,Z as a,$ as e,a0 as t,D as l}from"./framework-0cf5f349.js";const c={},r=t(`<h1 id="vue实战-vue组件打包成库" tabindex="-1"><a class="header-anchor" href="#vue实战-vue组件打包成库" aria-hidden="true">#</a> Vue实战 - Vue组件打包成库</h1><h2 id="_1-开发组件" tabindex="-1"><a class="header-anchor" href="#_1-开发组件" aria-hidden="true">#</a> 1. 开发组件</h2><p>开发组件的过程并无特殊之处，跟平时在Vue项目里定义component是一样的。有一点需要注意的是，平时在Vue项目里，组件的name可以不写，但如果要打包成库，组件的name必须写。为了描述方便，我们把将要打包的组件定义为MyCom1、MyCom2。其示例代码如下：</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;MyCom1&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-定义install方法" tabindex="-1"><a class="header-anchor" href="#_2-定义install方法" aria-hidden="true">#</a> 2. 定义install方法</h2><blockquote><p>Vue引用组件使用Vue.use方法，此方法会调用组件的install方法，所以需要定义组件的install方法。可以在项目中新建一个文件夹，例如命名为lib，然后在此文件夹中添加各个组件的install方法定义。</p></blockquote><p>例如，新建lib/MyCom1Install.js，内容如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> MyCom1 <span class="token keyword">from</span> <span class="token string">&quot;../src/MyCom1.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>MyCom1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> MyCom1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> install<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-定义打包入口文件" tabindex="-1"><a class="header-anchor" href="#_3-定义打包入口文件" aria-hidden="true">#</a> 3. 定义打包入口文件</h2><p>当有多个组件时，需要有一个入口文件引用这些组件。例如，同样在lib文件夹下，添加一个lib.js，内容如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> MyCom1 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./MyCom1Install&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> MyCom2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./MyCom2Install&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-package配置" tabindex="-1"><a class="header-anchor" href="#_4-package配置" aria-hidden="true">#</a> 4. package配置</h2><blockquote><p>这一步直接命令行执行一直不成功，但是package 中的没有问题</p></blockquote><p>package配置需要做两件事件，但首先，我们要确定这个包的名称，例如为mycom。生成lib的脚本如下所示：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>vue-cli-service build <span class="token parameter variable">--target</span> lib <span class="token parameter variable">--name</span> mycom lib/lib.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>完成之后，在工程的dist文件夹下，将生成以下文件：</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20221014132327142.png" alt="image-20221014132327142" tabindex="0" loading="lazy"><figcaption>image-20221014132327142</figcaption></figure><p>这些文件有不同的应用场合，我们需要用到的，其实就只有.umd.min.js和.css两个文件。由于有多个文件，需要在package中指明我们要用的是哪个，所以需要在package中加入：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/mycom.umd.min.js&quot;</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>package完整修改内容如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mycom&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//如果要上传npm，就为false</span>
  <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/mycom.umd.min.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build:lib&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build --target lib --name mycom lib/lib.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>其他无关内容
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-打包" tabindex="-1"><a class="header-anchor" href="#_5-打包" aria-hidden="true">#</a> 5. 打包</h2><p>打包的话就没什么好说的了，</p><p>yarn build:lib 或者</p><p>npm run build:lib</p><p>结束之后，可以上传到npm，也可以复制相关内容到需要引用组件项目的node_modules文件夹中。如果要复制，需要复制以下内容：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>mycom
  <span class="token keyword">package</span><span class="token punctuation">.</span>json
  dist
    mycom<span class="token punctuation">.</span>umd<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js
    mycom<span class="token punctuation">.</span>css
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-使用组件库" tabindex="-1"><a class="header-anchor" href="#_6-使用组件库" aria-hidden="true">#</a> 6. 使用组件库</h2><p>在main.js中，加入对组件的引用：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MyCom1<span class="token punctuation">,</span>MyCom2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;mycom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;mycom/dist/mycom.css&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MyCom1<span class="token punctuation">)</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MyCom2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在Vue页面中，像其他组件一样引用即可：</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyCom1</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyCom2</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-发布npm-补充" tabindex="-1"><a class="header-anchor" href="#_7-发布npm-补充" aria-hidden="true">#</a> 7.发布npm（补充）</h2><p>1、先到NPM官网注册账号，如果已有账号则跳过此步骤</p><p>2、在组件库项目的根目录下执行</p><div class="language-coffeescript line-numbers-mode" data-ext="coffeescript"><pre class="language-coffeescript"><code>npm login
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>登陆账号，输入你的账号和密码，并验证邮箱地址，登陆成功后则可以发布到NPM网站了</p><p>3、更新版本号</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>npm version patch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这是把版本迭代一级，每次更新时都需要输入这个命令，或者直接在package.json中修改版本号，只要与npm上的版本不同就行</p><p>4、发布到npm官网</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>npm publish --access public
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-如何同步淘宝镜像中-npm-包-补充" tabindex="-1"><a class="header-anchor" href="#_8-如何同步淘宝镜像中-npm-包-补充" aria-hidden="true">#</a> 8. 如何同步淘宝镜像中 npm 包（补充）</h2><h3 id="_8-1-背景" tabindex="-1"><a class="header-anchor" href="#_8-1-背景" aria-hidden="true">#</a> 8.1 背景</h3><p>我们使用npm安装模块的时候一般都使用淘宝镜像。<strong>淘宝镜像同步频率目前为 10分钟 一次</strong>，以保证尽量与官方服务同步。</p><p>我们发布模块至npm后，有时候短时间内无法从淘宝镜像安装最新发布的版本，这时候我们可以主动同步模块至淘宝镜像。</p><h3 id="_8-2-主动同步" tabindex="-1"><a class="header-anchor" href="#_8-2-主动同步" aria-hidden="true">#</a> 8.2 主动同步</h3><blockquote><p>找到需要同步包的名字 这边假设 包名字为 vite</p></blockquote><h4 id="_8-2-1-方式一-sync-命令" tabindex="-1"><a class="header-anchor" href="#_8-2-1-方式一-sync-命令" aria-hidden="true">#</a> 8.2.1 方式一：<code>sync</code> 命令</h4><p>直接通过 <code>sync</code> 命令马上同步一个模块, 只有 <code>cnpm</code> 命令行才有此功能:</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code>cnpm <span class="token keyword">sync</span> vite
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_8-2-1-方式二-web-方式" tabindex="-1"><a class="header-anchor" href="#_8-2-1-方式二-web-方式" aria-hidden="true">#</a> 8.2.1 方式二：web 方式</h4><p>还可以直接通过 web 方式来同步:</p>`,53),u={href:"https://npmmirror.com/sync/%7B%E5%8C%85%E7%9A%84%E5%90%8D%E5%AD%97%7D",target:"_blank",rel:"noopener noreferrer"},d=t(`<div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">open</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span>sync<span class="token operator">/</span>vite
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),k={href:"https://npmmirror.com/sync/vite",target:"_blank",rel:"noopener noreferrer"},m=n("figure",null,[n("img",{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20221108172214025.png",alt:"image-20221108172214025",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20221108172214025")],-1),v=n("h2",{id:"_9-包上传公司仓库",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_9-包上传公司仓库","aria-hidden":"true"},"#"),a(" 9. 包上传公司仓库")],-1),g={href:"https://juejin.cn/post/6986917713482350600",target:"_blank",rel:"noopener noreferrer"},b=t(`<ol><li><p>配置公司仓库地址</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token builtin class-name">set</span> registry http://192.168.x.x:8082/repository/npm_all/   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>配置认证地址</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> login <span class="token parameter variable">-registry</span> http://192.168.x.x:8082/repository/npm_fd 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>在package 下配置publishConfig</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token string-property property">&quot;publishConfig&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://192.168.x.x:8082/repository/npm_fd&quot;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>发布</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> publish
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,2),h={href:"https://blog.csdn.net/lweiyue/article/details/120064122",target:"_blank",rel:"noopener noreferrer"},y={href:"https://juejin.cn/post/6986917713482350600",target:"_blank",rel:"noopener noreferrer"};function _(f,q){const s=l("ExternalLinkIcon");return i(),o("div",null,[r,n("blockquote",null,[n("p",null,[n("a",u,[a("https://npmmirror.com/sync/{包的名字}"),e(s)]),a(" 如上假设包名字为 vite")])]),d,n("p",null,[a("则访问 "),n("a",k,[a("https://npmmirror.com/sync/vite"),e(s)]),a(" 就可以同步了")]),m,v,n("p",null,[n("a",g,[a("相关文章"),e(s)])]),b,n("p",null,[n("a",h,[a("Vue组件打包成库和使用库的方法"),e(s)])]),n("p",null,[n("a",y,[a("npm私服配置介绍"),e(s)])])])}const j=p(c,[["render",_],["__file","vue-x-lib-package.html.vue"]]);export{j as default};
