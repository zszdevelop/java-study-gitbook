import{_ as t,W as r,X as d,Y as e,Z as a,$ as s,a0 as i,D as l}from"./framework-0cf5f349.js";const c={},o=i('<h1 id="网站支持https" tabindex="-1"><a class="header-anchor" href="#网站支持https" aria-hidden="true">#</a> 网站支持https</h1><h2 id="_1-使用免费的-let-s-encrypt-证书" tabindex="-1"><a class="header-anchor" href="#_1-使用免费的-let-s-encrypt-证书" aria-hidden="true">#</a> 1. 使用免费的 Let&#39;s Encrypt 证书</h2><p>Let&#39;s Encrypt 能够免费签名一个证书，所以假如要求不高，可以使用它签名的证书，使用也非常的简单，只要验证邮箱地址就能使用了，不过有 90 天的有效期（到期前可以续）。</p><p>为了生成证书，Let&#39;s Encrypt 提供了一个软件 Certbot 来进行管理，这个软件有很多插件，可以生成证书并自动化配置 Nginx/Apache ，不过我还是选择使用它生成密钥对和证书，然后自己在 WEB 服务器上进行配置，使用很简单。</p><h2 id="_2-安装certbot" tabindex="-1"><a class="header-anchor" href="#_2-安装certbot" aria-hidden="true">#</a> 2. 安装certbot</h2><h3 id="_2-1-官网选择对应系统与环境" tabindex="-1"><a class="header-anchor" href="#_2-1-官网选择对应系统与环境" aria-hidden="true">#</a> 2.1 官网选择对应系统与环境</h3>',6),g={href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"},u=i(`<figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210220092815155.png" alt="image-20210220092815155" tabindex="0" loading="lazy"><figcaption>image-20210220092815155</figcaption></figure><h3 id="_2-2-安装snapd" tabindex="-1"><a class="header-anchor" href="#_2-2-安装snapd" aria-hidden="true">#</a> 2.2 安装snapd</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo yum install snapd
sudo systemctl enable --now snapd.socket
sudo ln -s /var/lib/snapd/snap /snap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-检查快照" tabindex="-1"><a class="header-anchor" href="#_2-3-检查快照" aria-hidden="true">#</a> 2.3 检查快照</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo snap install core; sudo snap refresh core
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-4-安装certbot" tabindex="-1"><a class="header-anchor" href="#_2-4-安装certbot" aria-hidden="true">#</a> 2.4 安装certbot</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> snap <span class="token function">install</span> <span class="token parameter variable">--classic</span> certbot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-5-添加certbot-命令的软链接" tabindex="-1"><a class="header-anchor" href="#_2-5-添加certbot-命令的软链接" aria-hidden="true">#</a> 2.5 添加certbot 命令的软链接</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo ln -s /snap/bin/certbot /usr/bin/certbot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-申请证书" tabindex="-1"><a class="header-anchor" href="#_2-申请证书" aria-hidden="true">#</a> 2. 申请证书</h2><h3 id="_2-1-certbot-命令初次申请证书" tabindex="-1"><a class="header-anchor" href="#_2-1-certbot-命令初次申请证书" aria-hidden="true">#</a> 2.1 <strong>certbot</strong> 命令初次申请证书</h3><p>接下来我们要使用 <strong>certbot</strong> 命令初次申请证书，命令格式如下：</p><blockquote><p>certbot certonly --webroot -w [Web站点目录] -d [站点域名] -m [联系人email地址] --agree-tos</p></blockquote><p>实际示例</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>certbot certonly --webroot -w /usr/local/nginx/html -d www.isture.com -m 312905679@qq.com --agree-tos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210220115219947.png" alt="image-20210220115219947" tabindex="0" loading="lazy"><figcaption>image-20210220115219947</figcaption></figure><h3 id="_2-2-证书保存位置" tabindex="-1"><a class="header-anchor" href="#_2-2-证书保存位置" aria-hidden="true">#</a> 2.2 证书保存位置</h3><p>/etc/letsencrypt/live/</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210220115330635.png" alt="image-20210220115330635" tabindex="0" loading="lazy"><figcaption>image-20210220115330635</figcaption></figure><h3 id="_2-3-证书有效期" tabindex="-1"><a class="header-anchor" href="#_2-3-证书有效期" aria-hidden="true">#</a> 2.3 证书有效期</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>openssl x509 -noout -dates -in /etc/letsencrypt/live/www.isture.com/cert.pem
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210220115440070.png" alt="image-20210220115440070" tabindex="0" loading="lazy"><figcaption>image-20210220115440070</figcaption></figure><h2 id="_3-更新证书" tabindex="-1"><a class="header-anchor" href="#_3-更新证书" aria-hidden="true">#</a> 3. 更新证书</h2><h3 id="_3-1-手动更新证书" tabindex="-1"><a class="header-anchor" href="#_3-1-手动更新证书" aria-hidden="true">#</a> 3.1 手动更新证书</h3><p><strong>Let&#39;s Encrypt</strong> 证书的有效期是 <strong>90</strong> 天，需要长期使用的话，需要在失效前进行延长申请。我们可以执行如下命令去更新：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//更新证书
certbot renew --dry-run
 
//如果不需要返回的信息，可以用静默方式
certbot renew --quiet

// 更新指定域名证书
 certbot certonly -d www.isture.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-定时更新" tabindex="-1"><a class="header-anchor" href="#_3-2-定时更新" aria-hidden="true">#</a> 3.2 定时更新</h3><ol><li>我们也可以将更新证书的脚本写到定时任务来自动完成，免得我们手动操作。首先执行如下命令开始编辑定时任务：</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>crontab -e
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>此时会进入 <strong>vi</strong> 的编辑界面让你编辑工作（每项工作都是一行）。我们在末尾添加如下一行内容，表示每月 <strong>1</strong> 号 <strong>5</strong> 时会执行执行一次更新，并重启 <strong>nginx</strong> 服务器：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>00 05 01 * * /usr/bin/certbot renew <span class="token parameter variable">--quiet</span> <span class="token operator">&amp;&amp;</span> /bin/systemctl restart nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li><p>保存后退出，执行 <strong>crontab -l</strong> 命令可以查看 <strong>crontab</strong> 服务是否创建成功：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>crontab -l
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210220115814879.png" alt="image-20210220115814879" tabindex="0" loading="lazy"><figcaption>image-20210220115814879</figcaption></figure></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>certbot certonly <span class="token parameter variable">--email</span> <span class="token number">312905679</span>@qq.com <span class="token parameter variable">-d</span> test.isture.com 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20201110230101897.png" alt="image-20201110230101897" tabindex="0" loading="lazy"><figcaption>image-20201110230101897</figcaption></figure><p>这里选择第二项</p><p><strong>输入网址根目录</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Requesting a certificate for test.isture.com
Performing the following challenges:
http-01 challenge for test.isture.com
Input the webroot for test.isture.com: (Enter &#39;c&#39; to cancel): /home/test-portal

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-nginx的配置" tabindex="-1"><a class="header-anchor" href="#_2-2-nginx的配置" aria-hidden="true">#</a> 2.2 nginx的配置</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> server <span class="token punctuation">{</span>
    listen          <span class="token number">80</span><span class="token punctuation">;</span>
    listen  <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name     test.isture.com<span class="token punctuation">;</span>
    ssl_certificate /etc/letsencrypt/live/test.isture.com/fullchain.pem<span class="token punctuation">;</span>
    ssl_certificate_key /etc/letsencrypt/live/test.isture.com/privkey.pem<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
            proxy_pass http://localhost:8085<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-certbot-常用指令" tabindex="-1"><a class="header-anchor" href="#_3-certbot-常用指令" aria-hidden="true">#</a> 3. certbot 常用指令</h2><h3 id="_3-1-列出证书和到期时间" tabindex="-1"><a class="header-anchor" href="#_3-1-列出证书和到期时间" aria-hidden="true">#</a> 3.1 列出证书和到期时间</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>certbot certificates
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20201110225053075.png" alt="image-20201110225053075" tabindex="0" loading="lazy"><figcaption>image-20201110225053075</figcaption></figure><p>以上可以看出此https 证书已经过期了</p><h3 id="_3-2-测试是否能更新" tabindex="-1"><a class="header-anchor" href="#_3-2-测试是否能更新" aria-hidden="true">#</a> 3.2 测试是否能更新</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>certbot renew --dry-run
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-手动立即更新ssl证书" tabindex="-1"><a class="header-anchor" href="#_3-3-手动立即更新ssl证书" aria-hidden="true">#</a> 3.3 手动立即更新SSL证书</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>certbot renew 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_4-集成问题" tabindex="-1"><a class="header-anchor" href="#_4-集成问题" aria-hidden="true">#</a> 4. 集成问题</h2>`,49),h={id:"_4-1-let-s-encrypt-配置-ssl-证书的时候-提示dns-problem-nxdomain-looking-up-a-for-xxx-com",tabindex:"-1"},p=e("a",{class:"header-anchor",href:"#_4-1-let-s-encrypt-配置-ssl-证书的时候-提示dns-problem-nxdomain-looking-up-a-for-xxx-com","aria-hidden":"true"},"#",-1),b={href:"http://xxx.com",target:"_blank",rel:"noopener noreferrer"},m=i('<p>问题标的比较明确： DNS Problem .</p><p>ping 不通该域名，可能是域名解析没有配置</p><h3 id="_4-2-最近授权太多次" tabindex="-1"><a class="header-anchor" href="#_4-2-最近授权太多次" aria-hidden="true">#</a> 4.2 最近授权太多次</h3><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20201110233310535.png" alt="image-20201110233310535" tabindex="0" loading="lazy"><figcaption>image-20201110233310535</figcaption></figure><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>',5),v={href:"https://learnku.com/laravel/t/2525/using-certbot-lets-encrypt-small-step-run-towards-https",target:"_blank",rel:"noopener noreferrer"},x={href:"https://www.hangge.com/blog/cache/detail_3054.html",target:"_blank",rel:"noopener noreferrer"};function f(_,y){const n=l("ExternalLinkIcon");return r(),d("div",null,[o,e("p",null,[e("a",g,[a("官网地址https://certbot.eff.org/"),s(n)])]),u,e("h3",h,[p,a(" 4.1 Let's Encrypt 配置 SSL 证书的时候，提示DNS problem: NXDOMAIN looking up A for "),e("a",b,[a("xxx.com"),s(n)])]),m,e("p",null,[e("a",v,[a("使用Certot"),s(n)])]),e("p",null,[e("a",x,[a("CentOS下自动申请、部署Let's Encrypt免费SSL证书教程（Nginx服务器）"),s(n)])])])}const k=t(c,[["render",f],["__file","https-x-support.html.vue"]]);export{k as default};
