import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c,a as n,b as t,e as p,d as s,r as l}from"./app.b4cde55b.js";const i={},u=p('<h1 id="scrapy\u5165\u95E8-\u4E8C-\u722C\u53D6\u8C46\u74E3\u7535\u5F71top250" tabindex="-1"><a class="header-anchor" href="#scrapy\u5165\u95E8-\u4E8C-\u722C\u53D6\u8C46\u74E3\u7535\u5F71top250" aria-hidden="true">#</a> Scrapy\u5165\u95E8\uFF08\u4E8C\uFF09-\u722C\u53D6\u8C46\u74E3\u7535\u5F71TOP250</h1><h2 id="_1-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1-\u7B80\u4ECB" aria-hidden="true">#</a> 1. \u7B80\u4ECB</h2><p>\u4E0A\u4E00\u7BC7\u6211\u4EEC\u5DF2\u7ECF\u5927\u81F4\u4E86\u89E3\u4E86Scrapy\u7684\u57FA\u672C\u60C5\u51B5\uFF0C\u5E76\u5199\u4E86\u4E00\u4E2A\u7B80\u5355\u7684\u5C0Fdemo\u3002\u8FD9\u6B21\u6211\u4F1A\u4EE5\u722C\u53D6\u8C46\u74E3\u7535\u5F71TOP250\u4E3A\u4F8B\u8FDB\u4E00\u6B65\u4E3A\u5927\u5BB6\u8BB2\u89E3\u4E00\u4E2A\u5B8C\u6574\u722C\u866B\u7684\u6D41\u7A0B\u3002</p><h2 id="_2-\u89C2\u5BDF\u9875\u9762\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#_2-\u89C2\u5BDF\u9875\u9762\u7ED3\u6784" aria-hidden="true">#</a> 2. \u89C2\u5BDF\u9875\u9762\u7ED3\u6784</h2>',4),r={href:"https://movie.douban.com/top250",target:"_blank",rel:"noopener noreferrer"},k=s("\u8C46\u74E3\u7535\u5F71 Top250"),d=n("p",null,[n("img",{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210311085829131.png",alt:"image-20210311085829131",loading:"lazy"})],-1),m=n("p",null,"\u89C2\u5BDF\u9875\u9762\u6211\u4EEC\u51B3\u5B9A\u8BA9\u722C\u866B\u83B7\u53D6\u6BCF\u4E00\u90E8\u7535\u5F71\u7684\u6392\u540D",-1),v=n("p",null,"\u3001\u7535\u5F71\u540D\u79F0\u3001\u8BC4\u5206\u548C\u8BC4\u5206\u7684\u4EBA\u6570\u3002",-1),g=n("h2",{id:"_3-\u58F0\u660Eitem",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3-\u58F0\u660Eitem","aria-hidden":"true"},"#"),s(" 3. \u58F0\u660EItem")],-1),b=s("\u4EC0\u4E48\u662FItems\uFF1F"),h={href:"https://link.zhihu.com/?target=http%3A//scrapy-chs.readthedocs.io/zh_CN/1.0/topics/items.html",target:"_blank",rel:"noopener noreferrer"},y=s("\u5B98\u65B9\u6587\u6863Items\u5B9A\u4E49"),q=s("\u5982\u4E0B\uFF1A"),_=p(`<blockquote><p>Items \u722C\u53D6\u7684\u4E3B\u8981\u76EE\u6807\u5C31\u662F\u4ECE\u975E\u7ED3\u6784\u6027\u7684\u6570\u636E\u6E90\u63D0\u53D6\u7ED3\u6784\u6027\u6570\u636E\uFF0C\u4F8B\u5982\u7F51\u9875\u3002 Scrapy spider\u53EF\u4EE5\u4EE5python\u7684dict\u6765\u8FD4\u56DE\u63D0\u53D6\u7684\u6570\u636E.\u867D\u7136dict\u5F88\u65B9\u4FBF\uFF0C\u5E76\u4E14\u7528\u8D77\u6765\u4E5F\u719F\u6089\uFF0C\u4F46\u662F\u5176\u7F3A\u5C11\u7ED3\u6784\u6027\uFF0C\u5BB9\u6613\u6253\u9519\u5B57\u6BB5\u7684\u540D\u5B57\u6216\u8005\u8FD4\u56DE\u4E0D\u4E00\u81F4\u7684\u6570\u636E\uFF0C\u5C24\u5176\u5728\u5177\u6709\u591A\u4E2Aspider\u7684\u5927\u9879\u76EE\u4E2D\u3002 \u4E3A\u4E86\u5B9A\u4E49\u5E38\u7528\u7684\u8F93\u51FA\u6570\u636E\uFF0CScrapy\u63D0\u4F9B\u4E86 Item \u7C7B\u3002 Item \u5BF9\u8C61\u662F\u79CD\u7B80\u5355\u7684\u5BB9\u5668\uFF0C\u4FDD\u5B58\u4E86\u722C\u53D6\u5230\u5F97\u6570\u636E\u3002 \u5176\u63D0\u4F9B\u4E86 \u7C7B\u4F3C\u4E8E\u8BCD\u5178(dictionary-like) \u7684API\u4EE5\u53CA\u7528\u4E8E\u58F0\u660E\u53EF\u7528\u5B57\u6BB5\u7684\u7B80\u5355\u8BED\u6CD5\u3002 \u8BB8\u591AScrapy\u7EC4\u4EF6\u4F7F\u7528\u4E86Item\u63D0\u4F9B\u7684\u989D\u5916\u4FE1\u606F: exporter\u6839\u636EItem\u58F0\u660E\u7684\u5B57\u6BB5\u6765\u5BFC\u51FA\u6570\u636E\u3001 \u5E8F\u5217\u5316\u53EF\u4EE5\u901A\u8FC7Item\u5B57\u6BB5\u7684\u5143\u6570\u636E(metadata)\u6765\u5B9A\u4E49\u3001 trackref \u8FFD\u8E2AItem\u5B9E\u4F8B\u6765\u5E2E\u52A9\u5BFB\u627E\u5185\u5B58\u6CC4\u9732 (see \u4F7F\u7528 trackref \u8C03\u8BD5\u5185\u5B58\u6CC4\u9732) \u7B49\u7B49\u3002</p></blockquote><p>Item\u4F7F\u7528\u7B80\u5355\u7684class\u5B9A\u4E49\u8BED\u6CD5\u4EE5\u53CAField\u5BF9\u8C61\u6765\u58F0\u660E\u3002\u6211\u4EEC\u6253\u5F00scrapyspider\u76EE\u5F55\u4E0B\u7684items.py\u6587\u4EF6\u5199\u5165\u4E0B\u5217\u4EE3\u7801\u58F0\u660EItem\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">DoubanMovieItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># \u6392\u540D</span>
    ranking <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># \u7535\u5F71\u540D\u79F0</span>
    movie_name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># \u8BC4\u5206</span>
    score <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># \u8BC4\u8BBA\u4EBA\u6570</span>
    score_num <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-\u722C\u866B\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#_4-\u722C\u866B\u7A0B\u5E8F" aria-hidden="true">#</a> 4. \u722C\u866B\u7A0B\u5E8F</h2><p>\u5728scrapyspider/spiders\u76EE\u5F55\u4E0B\u521B\u5EFAdouban_spider.py\u6587\u4EF6\uFF0C\u5E76\u5199\u5165\u521D\u6B65\u7684\u4EE3\u7801\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Spider
<span class="token keyword">from</span> scrapyspider<span class="token punctuation">.</span>items <span class="token keyword">import</span> DoubanMovieItem


<span class="token keyword">class</span> <span class="token class-name">DoubanMovieTop250Spider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&#39;douban_movie_top250&#39;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;https://movie.douban.com/top250&#39;</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> DoubanMovieItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),f=s("\u8FD9\u4E2A\u4E00\u4E2A\u57FA\u672C\u7684scrapy\u7684spider\u7684model\uFF0C\u9996\u5148\u6211\u4EEC\u8981\u5BFC\u5165Scrapy.spiders\u4E2D\u7684Spider\u7C7B\uFF0C\u4EE5\u53CAscrapyspider.items\u4E2D\u6211\u4EEC\u521A\u521A\u5B9A\u4E49\u597D\u7684DoubanMovieItem\u3002 \u63A5\u7740\u521B\u5EFA\u6211\u4EEC\u81EA\u5DF1\u7684\u722C\u866B\u7C7BDoubanMovieTop250Spider\u5E76\u7EE7\u627FSpider\u7C7B\uFF0Cscrapy.spiders\u4E2D\u6709\u5F88\u591A\u4E0D\u540C\u7684\u722C\u866B\u7C7B\u53EF\u4F9B\u6211\u4EEC\u7EE7\u627F\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\u4F7F\u7528Spider\u7C7B\u5C31\u53EF\u4EE5\u6EE1\u8DB3\u8981\u6C42\u3002\uFF08\u5176\u4ED6\u722C\u866B\u7C7B\u7684\u4F7F\u7528\u53EF\u4EE5\u53BB\u53C2\u8003"),x={href:"https://link.zhihu.com/?target=http%3A//scrapy-chs.readthedocs.io/zh_CN/1.0/topics/spiders.html",target:"_blank",rel:"noopener noreferrer"},w=s("\u5B98\u65B9\u6587\u6863"),S=s("\uFF09\u3002"),z=s("Spider class scrapy.spider.Spider Spider\u662F\u6700\u7B80\u5355\u7684spider\u3002\u6BCF\u4E2A\u5176\u4ED6\u7684spider\u5FC5\u987B\u7EE7\u627F\u81EA\u8BE5\u7C7B(\u5305\u62ECScrapy\u81EA\u5E26\u7684\u5176\u4ED6spider\u4EE5\u53CA\u60A8\u81EA\u5DF1\u7F16\u5199\u7684spider)\u3002 Spider\u5E76\u6CA1\u6709\u63D0\u4F9B\u4EC0\u4E48\u7279\u6B8A\u7684\u529F\u80FD\u3002 \u5176\u4EC5\u4EC5\u8BF7\u6C42\u7ED9\u5B9A\u7684 start_urls/start_requests \uFF0C\u5E76\u6839\u636E\u8FD4\u56DE\u7684\u7ED3\u679C(resulting responses)\u8C03\u7528spider\u7684 parse \u65B9\u6CD5\u3002 name \u5B9A\u4E49spider\u540D\u5B57\u7684\u5B57\u7B26\u4E32(string)\u3002spider\u7684\u540D\u5B57\u5B9A\u4E49\u4E86Scrapy\u5982\u4F55\u5B9A\u4F4D(\u5E76\u521D\u59CB\u5316)spider\uFF0C\u6240\u4EE5\u5176\u5FC5\u987B\u662F\u552F\u4E00\u7684\u3002 \u4E0D\u8FC7\u60A8\u53EF\u4EE5\u751F\u6210\u591A\u4E2A\u76F8\u540C\u7684spider\u5B9E\u4F8B(instance)\uFF0C\u8FD9\u6CA1\u6709\u4EFB\u4F55\u9650\u5236\u3002 name\u662Fspider\u6700\u91CD\u8981\u7684\u5C5E\u6027\uFF0C\u800C\u4E14\u662F\u5FC5\u987B\u7684\u3002 \u5982\u679C\u8BE5spider\u722C\u53D6\u5355\u4E2A\u7F51\u7AD9(single domain)\uFF0C\u4E00\u4E2A\u5E38\u89C1\u7684\u505A\u6CD5\u662F\u4EE5\u8BE5\u7F51\u7AD9(domain)(\u52A0\u6216\u4E0D\u52A0 \u540E\u7F00 )\u6765\u547D\u540Dspider\u3002 \u4F8B\u5982\uFF0C\u5982\u679Cspider\u722C\u53D6 "),R={href:"https://link.zhihu.com/?target=http%3A//mywebsite.com/",target:"_blank",rel:"noopener noreferrer"},I=s("mywebsite.com"),M=s(" \uFF0C\u8BE5spider\u901A\u5E38\u4F1A\u88AB\u547D\u540D\u4E3A mywebsite \u3002 allowed_domains \u53EF\u9009\u3002\u5305\u542B\u4E86spider\u5141\u8BB8\u722C\u53D6\u7684\u57DF\u540D(domain)\u5217\u8868(list)\u3002 \u5F53 OffsiteMiddleware \u542F\u7528\u65F6\uFF0C \u57DF\u540D\u4E0D\u5728\u5217\u8868\u4E2D\u7684URL\u4E0D\u4F1A\u88AB\u8DDF\u8FDB\u3002 start_urls URL\u5217\u8868\u3002\u5F53\u6CA1\u6709\u5236\u5B9A\u7279\u5B9A\u7684URL\u65F6\uFF0Cspider\u5C06\u4ECE\u8BE5\u5217\u8868\u4E2D\u5F00\u59CB\u8FDB\u884C\u722C\u53D6\u3002 \u56E0\u6B64\uFF0C\u7B2C\u4E00\u4E2A\u88AB\u83B7\u53D6\u5230\u7684\u9875\u9762\u7684URL\u5C06\u662F\u8BE5\u5217\u8868\u4E4B\u4E00\u3002 \u540E\u7EED\u7684URL\u5C06\u4F1A\u4ECE\u83B7\u53D6\u5230\u7684\u6570\u636E\u4E2D\u63D0\u53D6\u3002 start_requests() \u8BE5\u65B9\u6CD5\u5FC5\u987B\u8FD4\u56DE\u4E00\u4E2A\u53EF\u8FED\u4EE3\u5BF9\u8C61(iterable)\u3002\u8BE5\u5BF9\u8C61\u5305\u542B\u4E86spider\u7528\u4E8E\u722C\u53D6\u7684\u7B2C\u4E00\u4E2ARequest\u3002 \u5F53spider\u542F\u52A8\u722C\u53D6\u5E76\u4E14\u672A\u5236\u5B9AURL\u65F6\uFF0C\u8BE5\u65B9\u6CD5\u88AB\u8C03\u7528\u3002 \u5F53\u6307\u5B9A\u4E86URL\u65F6\uFF0Cmake_requests_from_url() \u5C06\u88AB\u8C03\u7528\u6765\u521B\u5EFARequest\u5BF9\u8C61\u3002 \u8BE5\u65B9\u6CD5\u4EC5\u4EC5\u4F1A\u88ABScrapy\u8C03\u7528\u4E00\u6B21\uFF0C\u56E0\u6B64\u60A8\u53EF\u4EE5\u5C06\u5176\u5B9E\u73B0\u4E3A\u751F\u6210\u5668\u3002 \u8BE5\u65B9\u6CD5\u7684\u9ED8\u8BA4\u5B9E\u73B0\u662F\u4F7F\u7528 start_urls \u7684url\u751F\u6210Request\u3002 \u5982\u679C\u60A8\u60F3\u8981\u4FEE\u6539\u6700\u521D\u722C\u53D6\u67D0\u4E2A\u7F51\u7AD9\u7684Request\u5BF9\u8C61\uFF0C\u60A8\u53EF\u4EE5\u91CD\u5199(override)\u8BE5\u65B9\u6CD5\u3002 \u4F8B\u5982\uFF0C\u5982\u679C\u60A8\u9700\u8981\u5728\u542F\u52A8\u65F6\u4EE5POST\u767B\u5F55\u67D0\u4E2A\u7F51\u7AD9\uFF0C\u4F60\u53EF\u4EE5\u8FD9\u4E48\u5199:"),T=p(`<div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span><span class="token string">&quot;http://www.example.com/login&quot;</span><span class="token punctuation">,</span>
                               formdata<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;john&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pass&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;secret&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                               callback<span class="token operator">=</span>self<span class="token punctuation">.</span>logged_in<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">logged_in</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># here you would extract links to follow and return Requests for</span>
    <span class="token comment"># each of them, with another callback</span>
    <span class="token keyword">pass</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>make_requests_from_url(url) \u8BE5\u65B9\u6CD5\u63A5\u53D7\u4E00\u4E2AURL\u5E76\u8FD4\u56DE\u7528\u4E8E\u722C\u53D6\u7684 Request \u5BF9\u8C61\u3002 \u8BE5\u65B9\u6CD5\u5728\u521D\u59CB\u5316request\u65F6\u88AB start_requests() \u8C03\u7528\uFF0C\u4E5F\u88AB\u7528\u4E8E\u8F6C\u5316url\u4E3Arequest\u3002 \u9ED8\u8BA4\u672A\u88AB\u590D\u5199(overridden)\u7684\u60C5\u51B5\u4E0B\uFF0C\u8BE5\u65B9\u6CD5\u8FD4\u56DE\u7684Request\u5BF9\u8C61\u4E2D\uFF0C parse() \u4F5C\u4E3A\u56DE\u8C03\u51FD\u6570\uFF0Cdont_filter\u53C2\u6570\u4E5F\u88AB\u8BBE\u7F6E\u4E3A\u5F00\u542F\u3002 (\u8BE6\u60C5\u53C2\u89C1 Request). parse(response) \u5F53response\u6CA1\u6709\u6307\u5B9A\u56DE\u8C03\u51FD\u6570\u65F6\uFF0C\u8BE5\u65B9\u6CD5\u662FScrapy\u5904\u7406\u4E0B\u8F7D\u7684response\u7684\u9ED8\u8BA4\u65B9\u6CD5\u3002 parse \u8D1F\u8D23\u5904\u7406response\u5E76\u8FD4\u56DE\u5904\u7406\u7684\u6570\u636E\u4EE5\u53CA(/\u6216)\u8DDF\u8FDB\u7684URL\u3002 Spider \u5BF9\u5176\u4ED6\u7684Request\u7684\u56DE\u8C03\u51FD\u6570\u4E5F\u6709\u76F8\u540C\u7684\u8981\u6C42\u3002 \u8BE5\u65B9\u6CD5\u53CA\u5176\u4ED6\u7684Request\u56DE\u8C03\u51FD\u6570\u5FC5\u987B\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B Request \u53CA(\u6216) Item \u7684\u53EF\u8FED\u4EE3\u7684\u5BF9\u8C61\u3002 \u53C2\u6570: response (Response) \u2013 \u7528\u4E8E\u5206\u6790\u7684response log(message[, level, component]) \u4F7F\u7528 scrapy.log.msg() \u65B9\u6CD5\u8BB0\u5F55(log)message\u3002 log\u4E2D\u81EA\u52A8\u5E26\u4E0A\u8BE5spider\u7684 name \u5C5E\u6027\u3002 \u66F4\u591A\u6570\u636E\u8BF7\u53C2\u89C1 Logging \u3002 closed(reason) \u5F53spider\u5173\u95ED\u65F6\uFF0C\u8BE5\u51FD\u6570\u88AB\u8C03\u7528\u3002 \u8BE5\u65B9\u6CD5\u63D0\u4F9B\u4E86\u4E00\u4E2A\u66FF\u4EE3\u8C03\u7528signals.connect()\u6765\u76D1\u542C spider_closed \u4FE1\u53F7\u7684\u5FEB\u6377\u65B9\u5F0F\u3002</p></blockquote><p>\u63D0\u53D6\u7F51\u9875\u4FE1\u606F</p><p>\u6211\u4EEC\u4F7F\u7528xpath\u8BED\u6CD5\u6765\u63D0\u53D6\u6211\u4EEC\u6240\u9700\u7684\u4FE1\u606F\u3002</p><ol><li><p>\u9996\u5148\u6211\u4EEC\u5728chrome\u6D4F\u89C8\u5668\u91CC\u8FDB\u5165\u8C46\u74E3\u7535\u5F71TOP250\u9875\u9762\u5E76\u6309F12\u6253\u5F00\u5F00\u53D1\u8005\u5DE5\u5177\u3002</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210311101541138.png" alt="image-20210311101541138" loading="lazy"></p></li></ol><p>\u70B9\u51FB\u5DE5\u5177\u680F\u5DE6\u4E0A\u89D2\u7684\u7C7B\u9F20\u6807\u7B26\u53F7\u56FE\u6807\u6216\u8005Ctrl + Shift + c\u5728\u9875\u9762\u4E2D\u70B9\u51FB\u6211\u4EEC\u60F3\u8981\u7684\u5143\u7D20\u5373\u53EF\u5728\u5DE5\u5177\u680F\u4E2D\u770B\u5230\u5B83\u5728\u7F51\u9875HTML\u6E90\u7801\u4E2D\u6240\u5904\u7684\u4F4D\u7F6E\u3002 \u4E00\u822C\u6293\u53D6\u65F6\u4F1A\u4EE5\u5148\u6293\u5927\u518D\u6293\u5C0F\u7684\u539F\u5219\u6765\u6293\u53D6\u3002\u901A\u8FC7\u89C2\u5BDF\u6211\u4EEC\u770B\u5230\u8BE5\u9875\u9762\u6240\u6709\u5F71\u7247\u7684\u4FE1\u606F\u90FD\u4F4D\u4E8E\u4E00\u4E2Aclass\u5C5E\u6027\u4E3Agrid_view\u7684ol\u6807\u7B7E\u5185\u7684li\u6807\u7B7E\u5185\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>grid_view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://movie.douban.com/subject/1292052/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u8096\u7533\u514B\u7684\u6551\u8D4E<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://img3.doubanio.com/view/movie_poster_cover/ipst/public/p480747492.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://movie.douban.com/subject/1292052/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u8096\u7533\u514B\u7684\u6551\u8D4E<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>/<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>The Shawshank Redemption<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>other<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>/<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>\u6708\u9ED1\u9AD8\u98DE(\u6E2F)  /  \u523A\u6FC01995(\u53F0)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>


                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>playable<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>[\u53EF\u64AD\u653E]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            \u5BFC\u6F14: \u5F17\u5170\u514B\xB7\u5FB7\u62C9\u90A6\u7279 Frank Darabont<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span><span class="token entity named-entity" title="\xA0">&amp;nbsp;</span><span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>\u4E3B\u6F14: \u8482\u59C6\xB7\u7F57\u5BBE\u65AF Tim Robbins /...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
                            1994<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>/<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>\u7F8E\u56FD<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>/<span class="token entity named-entity" title="\xA0">&amp;nbsp;</span>\u72AF\u7F6A \u5267\u60C5
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

                        
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>star<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rating5-t<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rating_num<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>v:average<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>9.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>v:best<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>766719\u4EBA\u8BC4\u4EF7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>quote<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inq<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u5E0C\u671B\u8BA9\u4EBA\u81EA\u7531\u3002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        ...
        ...
        ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56E0\u6B64\u6211\u4EEC\u6839\u636E\u4EE5\u4E0A\u539F\u5219\u5BF9\u6240\u9700\u4FE1\u606F\u8FDB\u884C\u6293\u53D6</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Spider
<span class="token keyword">from</span> scrapyspider<span class="token punctuation">.</span>items <span class="token keyword">import</span> DoubanMovieItem


<span class="token keyword">class</span> <span class="token class-name">DoubanMovieTop250Spider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&#39;douban_movie_top250&#39;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;https://movie.douban.com/top250&#39;</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> DoubanMovieItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        movies <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//ol[@class=&quot;grid_view&quot;]/li&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;ranking&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;pic&quot;]/em/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;movie_name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;hd&quot;]/a/span[1]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;star&quot;]/span[@class=&quot;rating_num&quot;]/text()&#39;</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;score_num&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;star&quot;]/span/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>re<span class="token punctuation">(</span>u<span class="token string">r&#39;(\\d+)\u4EBA\u8BC4\u4EF7&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">yield</span> item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-\u8FD0\u884C\u722C\u866B" tabindex="-1"><a class="header-anchor" href="#_5-\u8FD0\u884C\u722C\u866B" aria-hidden="true">#</a> 5. \u8FD0\u884C\u722C\u866B</h2><p>\u5728\u9879\u76EE\u6587\u4EF6\u5939\u5185\u6253\u5F00cmd\u8FD0\u884C\u4E0B\u5217\u547D\u4EE4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scrapy crawl douban_movie_top250 -o douban.csv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6CE8\u610F\u6B64\u5904\u7684douban_movie_top250\u5373\u4E3A\u6211\u4EEC\u521A\u521A\u5199\u7684\u722C\u866B\u7684name, \u800C-o douban.csv\u662Fscrapy\u63D0\u4F9B\u7684\u5C06item\u8F93\u51FA\u4E3Acsv\u683C\u5F0F\u7684\u5FEB\u6377\u65B9\u5F0F</p><p>\u8BD5\u7740\u8FD0\u884C\u4E00\u4E0B\u722C\u866B\u600E\u4E48\u4EC0\u4E48\u4E5F\u6CA1\u8F93\u51FA\u5462\uFF1F\uFF01\uFF01\uFF01</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210311102306053.png" alt="image-20210311102306053" loading="lazy"></p><p>\u8F9B\u8F9B\u82E6\u82E6\u5230\u4E86\u8FD9\u91CC\u96BE\u9053\u8981\u5931\u8D25\u4E86\u5417\uFF1F\uFF01\uFF01\uFF01 \u4E0D\u8981\u6025\u6211\u4EEC\u770B\u4E0B\u4E00\u63A7\u5236\u53F0\u8F93\u51FA\u7684\u4FE1\u606F\uFF0C\u539F\u6765\u662F403\u9519\u8BEF\u4E86\u3002\u8FD9\u662F\u56E0\u4E3A\u8C46\u74E3\u5BF9\u722C\u866B\u8BBE\u4E86\u4E00\u4E2A\u5C0F\u5C0F\u7684\u95E8\u69DB\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u66F4\u6539\u4E00\u4E0B\u53D1\u9001\u8BF7\u6C42\u65F6\u7684\u8BF7\u6C42\u5934user-agent\u5373\u53EF\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> Request
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Spider
<span class="token keyword">from</span> scrapyspider<span class="token punctuation">.</span>items <span class="token keyword">import</span> DoubanMovieItem


<span class="token keyword">class</span> <span class="token class-name">DoubanMovieTop250Spider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&#39;douban_movie_top250&#39;</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">&#39;https://movie.douban.com/top250&#39;</span>
        <span class="token keyword">yield</span> Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> DoubanMovieItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        movies <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//ol[@class=&quot;grid_view&quot;]/li&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;ranking&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;pic&quot;]/em/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;movie_name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;hd&quot;]/a/span[1]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;star&quot;]/span[@class=&quot;rating_num&quot;]/text()&#39;</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;score_num&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;star&quot;]/span/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>re<span class="token punctuation">(</span>u<span class="token string">r&#39;(\\d+)\u4EBA\u8BC4\u4EF7&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">yield</span> item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u66F4\u6539\u540E\u7684\u4EE3\u7801\u662F\u4E0D\u662F\u89C9\u5F97\u6709\u4E9B\u5730\u65B9\u4E0D\u592A\u4E00\u6837\u4E86\uFF1Fstart_urls\u600E\u4E48\u4E0D\u89C1\u4E86\uFF1Fstart_requests\u51FD\u6570\u53C8\u662F\u5E72\u4EC0\u4E48\u7684\uFF1F\u8FD8\u8BB0\u5F97\u521A\u624D\u5BF9Spider\u7C7B\u7684\u4ECB\u7ECD\u5417\uFF1F\u5148\u56DE\u8FC7\u5934\u590D\u4E60\u4E00\u4E0B\u4E0A\u9762\u5173\u4E8Estart_urls\u548Cstart_requests\u51FD\u6570\u7684\u4ECB\u7ECD\u3002\u7B80\u5355\u7684\u8BF4\u5C31\u662F\u4F7F\u7528start_requests\u51FD\u6570\u6211\u4EEC\u5BF9\u521D\u59CBURL\u7684\u5904\u7406\u5C31\u6709\u4E86\u66F4\u591A\u7684\u6743\u5229\uFF0C\u6BD4\u5982\u8FD9\u6B21\u7ED9\u521D\u59CBURL\u589E\u52A0\u8BF7\u6C42\u5934user_agent\u3002</p><p>\u518D\u6B21\u8FD0\u884C\u722C\u866B\uFF0C\u6211\u4EEC\u60F3\u8981\u7684\u4FE1\u606F\u90FD\u88AB\u4E0B\u8F7D\u5230douban.scv\u6587\u4EF6\u5939\u91CC\u4E86\u3002\u76F4\u63A5\u7528WPS\u6253\u5F00\u5373\u53EF\u67E5\u770B\u4FE1\u606F\u3002</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210311102347247.png" alt="image-20210311102347247" loading="lazy"></p><h2 id="_6-\u81EA\u52A8\u7FFB\u9875" tabindex="-1"><a class="header-anchor" href="#_6-\u81EA\u52A8\u7FFB\u9875" aria-hidden="true">#</a> 6. \u81EA\u52A8\u7FFB\u9875</h2><p>\u5148\u522B\u6025\u7740\u9AD8\u5174\uFF0C\u4F60\u96BE\u9053\u6CA1\u6709\u53D1\u73B0\u4E00\u4E2A\u95EE\u9898\u5417?\u8FD9\u6837\u7684\u8BDD\u6211\u4EEC\u8FD8\u662F\u53EA\u80FD\u722C\u5230\u5F53\u524D\u9875\u768425\u4E2A\u7535\u5F71\u7684\u5185\u5BB9\u3002\u600E\u4E48\u6837\u624D\u80FD\u628A\u5269\u4E0B\u7684\u4E5F\u4E00\u8D77\u722C\u4E0B\u6765\u5462\uFF1F \u5B9E\u73B0\u81EA\u52A8\u7FFB\u9875\u4E00\u822C\u6709\u4E24\u79CD\u65B9\u6CD5\uFF1A</p><ol><li>\u5728\u9875\u9762\u4E2D\u627E\u5230\u4E0B\u4E00\u9875\u7684\u5730\u5740\uFF1B</li><li>\u81EA\u5DF1\u6839\u636EURL\u7684\u53D8\u5316\u89C4\u5F8B\u6784\u9020\u6240\u6709\u9875\u9762\u5730\u5740\u3002</li></ol><p>\u4E00\u822C\u60C5\u51B5\u4E0B\u6211\u4EEC\u4F7F\u7528\u7B2C\u4E00\u79CD\u65B9\u6CD5\uFF0C\u7B2C\u4E8C\u79CD\u65B9\u6CD5\u9002\u7528\u4E8E\u9875\u9762\u7684\u4E0B\u4E00\u9875\u5730\u5740\u4E3AJS\u52A0\u8F7D\u7684\u60C5\u51B5\u3002\u4ECA\u5929\u6211\u4EEC\u53EA\u8BF4\u7B2C\u4E00\u79CD\u65B9\u6CD5\u3002 \u9996\u5148\u5229\u7528Chrome\u6D4F\u89C8\u5668\u7684\u5F00\u53D1\u8005\u5DE5\u5177\u627E\u5230\u4E0B\u4E00\u9875\u7684\u5730\u5740</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210311102449642.png" alt="image-20210311102449642" loading="lazy"></p><p>\u7136\u540E\u5728\u89E3\u6790\u8BE5\u9875\u9762\u65F6\u83B7\u53D6\u4E0B\u4E00\u9875\u7684\u5730\u5740\u5E76\u5C06\u5730\u5740\u4EA4\u7ED9\u8C03\u5EA6\u5668(Scheduler)</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> Request
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Spider
<span class="token keyword">from</span> scrapyspider<span class="token punctuation">.</span>items <span class="token keyword">import</span> DoubanMovieItem


<span class="token keyword">class</span> <span class="token class-name">DoubanMovieTop250Spider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&#39;douban_movie_top250&#39;</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">&#39;https://movie.douban.com/top250&#39;</span>
        <span class="token keyword">yield</span> Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> DoubanMovieItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        movies <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//ol[@class=&quot;grid_view&quot;]/li&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;ranking&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;pic&quot;]/em/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;movie_name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;hd&quot;]/a/span[1]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;star&quot;]/span[@class=&quot;rating_num&quot;]/text()&#39;</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&#39;score_num&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> movie<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>
                <span class="token string">&#39;.//div[@class=&quot;star&quot;]/span/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>re<span class="token punctuation">(</span>u<span class="token string">r&#39;(\\d+)\u4EBA\u8BC4\u4EF7&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">yield</span> item

        next_url <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//span[@class=&quot;next&quot;]/a/@href&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> next_url<span class="token punctuation">:</span>
            next_url <span class="token operator">=</span> <span class="token string">&#39;https://movie.douban.com/top250&#39;</span> <span class="token operator">+</span> next_url<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">yield</span> Request<span class="token punctuation">(</span>next_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6700\u540E\u518D\u8FD0\u884C\u4E00\u4E0B\u722C\u866B\uFF0C\u6253\u5F00douban.csv\u3002\u662F\u4E0D\u662F\u53D1\u73B0\u6240\u6709\u7684\u5F71\u7247\u4FE1\u606F\u90FD\u83B7\u53D6\u5230\u4E86\uFF0C250\u4E2A\u4E00\u4E2A\u4E0D\u591A\u4E00\u4E2A\u4E0D\u5C11\u3002</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210311102831664.png" alt="image-20210311102831664" loading="lazy"></p><p>\u6700\u540E\uFF0C\u5229\u7528WPS\u7684\u7B5B\u9009\u529F\u80FD\u4F60\u53EF\u4EE5\u7B5B\u9009\u4EFB\u610F\u7B26\u5408\u4F60\u8981\u6C42\u7684\u5F71\u7247\u3002</p><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,31),L={href:"https://zhuanlan.zhihu.com/p/24769534",target:"_blank",rel:"noopener noreferrer"},D=s("Scrapy\u722C\u866B\u6846\u67B6\u6559\u7A0B\uFF08\u4E8C\uFF09-- \u722C\u53D6\u8C46\u74E3\u7535\u5F71TOP250");function U(j,A){const a=l("ExternalLinkIcon");return o(),c("div",null,[u,n("p",null,[n("a",r,[k,t(a)])]),d,m,v,g,n("p",null,[b,n("a",h,[y,t(a)]),q]),_,n("p",null,[f,n("a",x,[w,t(a)]),S]),n("blockquote",null,[n("p",null,[z,n("a",R,[I,t(a)]),M])]),T,n("p",null,[n("a",L,[D,t(a)])])])}const P=e(i,[["render",U],["__file","python-scrapy-douban-top250.html.vue"]]);export{P as default};
