import{_ as i}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as l,c as p,a as s,b as t,d as e,e as n,r as o}from"./app.3a7e6dfd.js";const c={},u=e(`<h1 id="es\u8BE6\u89E3-\u805A\u5408-\u805A\u5408\u67E5\u8BE2\u4E4Bbucket\u805A\u5408\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#es\u8BE6\u89E3-\u805A\u5408-\u805A\u5408\u67E5\u8BE2\u4E4Bbucket\u805A\u5408\u8BE6\u89E3" aria-hidden="true">#</a> ES\u8BE6\u89E3 - \u805A\u5408\uFF1A\u805A\u5408\u67E5\u8BE2\u4E4BBucket\u805A\u5408\u8BE6\u89E3</h1><blockquote><p>\u9664\u4E86\u67E5\u8BE2\u4E4B\u5916\uFF0C\u6700\u5E38\u7528\u7684\u805A\u5408\u4E86\uFF0CElasticSearch\u63D0\u4F9B\u4E86\u4E09\u79CD\u805A\u5408\u65B9\u5F0F\uFF1A <strong>\u6876\u805A\u5408\uFF08Bucket Aggregation)</strong>\uFF0C<strong>\u6307\u6807\u805A\u5408\uFF08Metric Aggregation)</strong> \u548C <strong>\u7BA1\u9053\u805A\u5408\uFF08Pipline Aggregation)</strong>\u3002\u672C\u6587\u4E3B\u8981\u8BB2\u8BB2<strong>\u6876\u805A\u5408\uFF08Bucket Aggregation)</strong>\u3002</p></blockquote><h2 id="_1-\u805A\u5408\u7684\u5F15\u5165" tabindex="-1"><a class="header-anchor" href="#_1-\u805A\u5408\u7684\u5F15\u5165" aria-hidden="true">#</a> 1. \u805A\u5408\u7684\u5F15\u5165</h2><p>\u6211\u4EEC\u5728SQL\u7ED3\u679C\u4E2D\u5E38\u6709\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> <span class="token keyword">table</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> color 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ElasticSearch\u4E2D<strong>\u6876</strong>\u5728\u6982\u5FF5\u4E0A\u7C7B\u4F3C\u4E8E SQL \u7684\u5206\u7EC4\uFF08<code>GROUP BY</code>\uFF09\uFF0C\u800C<strong>\u6307\u6807</strong>\u5219\u7C7B\u4F3C\u4E8E <code>COUNT()</code> \u3001 <code>SUM()</code> \u3001 <code>MAX()</code> \u7B49\u7EDF\u8BA1\u65B9\u6CD5\u3002</p><p>\u8FDB\u800C\u5F15\u5165\u4E86\u4E24\u4E2A\u6982\u5FF5\uFF1A</p><ul><li><strong>\u6876\uFF08Buckets\uFF09</strong> \u6EE1\u8DB3\u7279\u5B9A\u6761\u4EF6\u7684\u6587\u6863\u7684\u96C6\u5408</li><li><strong>\u6307\u6807\uFF08Metrics\uFF09</strong> \u5BF9\u6876\u5185\u7684\u6587\u6863\u8FDB\u884C\u7EDF\u8BA1\u8BA1\u7B97</li></ul><p>\u6240\u4EE5ElasticSearch\u5305\u542B3\u79CD\u805A\u5408\uFF08Aggregation)\u65B9\u5F0F</p><ul><li><strong>\u6876\u805A\u5408\uFF08Bucket Aggregation)</strong> - \u672C\u6587\u4E2D\u8BE6\u89E3</li><li><strong>\u6307\u6807\u805A\u5408\uFF08Metric Aggregation)</strong> - \u4E0B\u6587\u4E2D\u8BB2\u89E3</li><li><strong>\u7BA1\u9053\u805A\u5408\uFF08Pipline Aggregation)</strong> - \u518D\u4E0B\u4E00\u7BC7\u8BB2\u89E3 <ul><li>\u805A\u5408\u7BA1\u9053\u5316\uFF0C\u7B80\u5355\u800C\u8A00\u5C31\u662F\u4E0A\u4E00\u4E2A\u805A\u5408\u7684\u7ED3\u679C\u6210\u4E3A\u4E0B\u4E2A\u805A\u5408\u7684\u8F93\u5165\uFF1B</li></ul></li></ul><p>\uFF08PS:\u6307\u6807\u805A\u5408\u548C\u6876\u805A\u5408\u5F88\u591A\u60C5\u51B5\u4E0B\u662F\u7EC4\u5408\u5728\u4E00\u8D77\u4F7F\u7528\u7684\uFF0C\u5176\u5B9E\u4F60\u4E5F\u53EF\u4EE5\u770B\u5230\uFF0C\u6876\u805A\u5408\u672C\u8D28\u4E0A\u662F\u4E00\u79CD\u7279\u6B8A\u7684\u6307\u6807\u805A\u5408\uFF0C\u5B83\u7684\u805A\u5408\u6307\u6807\u5C31\u662F\u6570\u636E\u7684\u6761\u6570count)</p><h2 id="_2-\u5982\u4F55\u7406\u89E3bucket\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_2-\u5982\u4F55\u7406\u89E3bucket\u805A\u5408" aria-hidden="true">#</a> 2. \u5982\u4F55\u7406\u89E3Bucket\u805A\u5408</h2><blockquote><p>\u5982\u679C\u4F60\u76F4\u63A5\u53BB\u770B\u6587\u6863\uFF0C\u5927\u6982\u6709\u51E0\u5341\u79CD\uFF1A</p></blockquote><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806210958989.png" alt="image-20220806210958989" loading="lazy"></p><p>\u8981\u4E48\u4F60\u9700\u8981\u82B1\u5927\u91CF\u65F6\u95F4\u5B66\u4E60\uFF0C\u8981\u4E48\u4F60\u5DF2\u7ECF\u8FF7\u5931\u6216\u8005\u5373\u5C06\u8FF7\u5931\u5728\u77E5\u8BC6\u70B9\u4E2D...</p><p>\u6240\u4EE5\u4F60\u9700\u8981\u7A0D\u5FAE<strong>\u7AD9\u5728\u8BBE\u8BA1\u8005\u7684\u89D2\u5EA6\u601D\u8003</strong>\u4E0B\uFF0C\u4E0D\u96BE\u53D1\u73B0\u8BBE\u8BA1\u4E0A\u5927\u6982\u5206\u4E3A\u4E09\u7C7B\uFF08\u5F53\u7136\u6709\u4E9B\u662F\u7B2C\u4E8C\u548C\u7B2C\u4E09\u7C7B\u7684\u878D\u5408\uFF09</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806211042963.png" alt="image-20220806211042963" loading="lazy"></p><p>\uFF08\u56FE\u4E2D\u5E76\u6CA1\u6709\u5168\u90E8\u5217\u51FA\u5185\u5BB9\uFF0C\u56E0\u4E3A\u56FE\u8981\u8868\u8FBE\u7684\u610F\u56FE\u6211\u89C9\u5F97\u8FD8\u662F\u6BD4\u8F83\u6E05\u695A\u7684\uFF0C\u8FD9\u5C31\u591F\u4E86\uFF1B\u6709\u4E86\u8FD9\u79CD\u601D\u8651\u548C\u8BA4\u77E5\uFF0C\u4F1A\u5927\u5927\u63D0\u5347\u4F60\u7684\u8BA4\u77E5\u6548\u7387\u3002\uFF09</p><h2 id="_3-\u6309\u77E5\u8BC6\u70B9\u5B66\u4E60\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_3-\u6309\u77E5\u8BC6\u70B9\u5B66\u4E60\u805A\u5408" aria-hidden="true">#</a> 3. \u6309\u77E5\u8BC6\u70B9\u5B66\u4E60\u805A\u5408</h2><blockquote><p>\u6211\u4EEC\u5148\u6309\u7167\u5B98\u65B9\u6743\u5A01\u6307\u5357\u4E2D\u7684\u4E00\u4E2A\u4F8B\u5B50\uFF0C\u5B66\u4E60Aggregation\u4E2D\u7684\u77E5\u8BC6\u70B9\u3002</p></blockquote><h3 id="_3-1-\u51C6\u5907\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-1-\u51C6\u5907\u6570\u636E" aria-hidden="true">#</a> 3.1 \u51C6\u5907\u6570\u636E</h3><p>\u8BA9\u6211\u4EEC\u5148\u770B\u4E00\u4E2A\u4F8B\u5B50\u3002\u6211\u4EEC\u5C06\u4F1A\u521B\u5EFA\u4E00\u4E9B\u5BF9\u6C7D\u8F66\u7ECF\u9500\u5546\u6709\u7528\u7684\u805A\u5408\uFF0C\u6570\u636E\u662F\u5173\u4E8E\u6C7D\u8F66\u4EA4\u6613\u7684\u4FE1\u606F\uFF1A\u8F66\u578B\u3001\u5236\u9020\u5546\u3001\u552E\u4EF7\u3001\u4F55\u65F6\u88AB\u51FA\u552E\u7B49\u3002</p><p>\u9996\u5148\u6211\u4EEC\u6279\u91CF\u7D22\u5F15\u4E00\u4E9B\u6570\u636E\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>POST /test-agg-cars/_bulk
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">10000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;red&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;honda&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-10-28&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">20000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;red&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;honda&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-11-05&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">30000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;green&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;ford&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-05-18&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">15000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;blue&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;toyota&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-07-02&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">12000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;green&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;toyota&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-08-19&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">20000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;red&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;honda&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-11-05&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">80000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;red&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;bmw&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-01&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25000</span>, <span class="token string">&quot;color&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;blue&quot;</span>, <span class="token string">&quot;make&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;ford&quot;</span>, <span class="token string">&quot;sold&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-02-12&quot;</span> <span class="token punctuation">}</span>
  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-1-\u6807\u51C6\u7684\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_3-1-\u6807\u51C6\u7684\u805A\u5408" aria-hidden="true">#</a> 3.1 \u6807\u51C6\u7684\u805A\u5408</h3><p>\u6709\u4E86\u6570\u636E\uFF0C\u5F00\u59CB\u6784\u5EFA\u6211\u4EEC\u7684\u7B2C\u4E00\u4E2A\u805A\u5408\u3002\u6C7D\u8F66\u7ECF\u9500\u5546\u53EF\u80FD\u4F1A\u60F3\u77E5\u9053\u54EA\u4E2A\u989C\u8272\u7684\u6C7D\u8F66\u9500\u91CF\u6700\u597D\uFF0C\u7528\u805A\u5408\u53EF\u4EE5\u8F7B\u6613\u5F97\u5230\u7ED3\u679C\uFF0C\u7528 terms \u6876\u64CD\u4F5C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;aggs&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
        <span class="token string">&quot;popular_colors&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
            <span class="token string">&quot;terms&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
              <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;color.keyword&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>\u805A\u5408\u64CD\u4F5C\u88AB\u7F6E\u4E8E\u9876\u5C42\u53C2\u6570 aggs \u4E4B\u4E0B\uFF08\u5982\u679C\u4F60\u613F\u610F\uFF0C\u5B8C\u6574\u5F62\u5F0F aggregations \u540C\u6837\u6709\u6548\uFF09\u3002</li><li>\u7136\u540E\uFF0C\u53EF\u4EE5\u4E3A\u805A\u5408\u6307\u5B9A\u4E00\u4E2A\u6211\u4EEC\u60F3\u8981\u540D\u79F0\uFF0C\u672C\u4F8B\u4E2D\u662F\uFF1A popular_colors \u3002</li><li>\u6700\u540E\uFF0C\u5B9A\u4E49\u5355\u4E2A\u6876\u7684\u7C7B\u578B terms \u3002</li></ol><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806212249049.png" alt="image-20220806212249049" loading="lazy"></p><ol><li>\u56E0\u4E3A\u6211\u4EEC\u8BBE\u7F6E\u4E86 size \u53C2\u6570\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u6709 hits \u641C\u7D22\u7ED3\u679C\u8FD4\u56DE\u3002</li><li>popular_colors \u805A\u5408\u662F\u4F5C\u4E3A aggregations \u5B57\u6BB5\u7684\u4E00\u90E8\u5206\u88AB\u8FD4\u56DE\u7684\u3002</li><li>\u6BCF\u4E2A\u6876\u7684 key \u90FD\u4E0E color \u5B57\u6BB5\u91CC\u627E\u5230\u7684\u552F\u4E00\u8BCD\u5BF9\u5E94\u3002\u5B83\u603B\u4F1A\u5305\u542B doc_count \u5B57\u6BB5\uFF0C\u544A\u8BC9\u6211\u4EEC\u5305\u542B\u8BE5\u8BCD\u9879\u7684\u6587\u6863\u6570\u91CF\u3002</li><li>\u6BCF\u4E2A\u6876\u7684\u6570\u91CF\u4EE3\u8868\u8BE5\u989C\u8272\u7684\u6587\u6863\u6570\u91CF\u3002</li></ol><h3 id="_3-3-\u591A\u4E2A\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_3-3-\u591A\u4E2A\u805A\u5408" aria-hidden="true">#</a> 3.3 \u591A\u4E2A\u805A\u5408</h3><p>\u540C\u65F6\u8BA1\u7B97\u4E24\u79CD\u6876\u7684\u7ED3\u679C\uFF1A\u5BF9color\u548C\u5BF9make\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;aggs&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
        <span class="token string">&quot;popular_colors&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
            <span class="token string">&quot;terms&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
              <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;color.keyword&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;make_by&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
            <span class="token string">&quot;terms&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
              <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;make.keyword&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806212508399.png" alt="image-20220806212508399" loading="lazy"></p><h3 id="_3-4-\u805A\u5408\u7684\u5D4C\u5957" tabindex="-1"><a class="header-anchor" href="#_3-4-\u805A\u5408\u7684\u5D4C\u5957" aria-hidden="true">#</a> 3.4 \u805A\u5408\u7684\u5D4C\u5957</h3><p>\u8FD9\u4E2A\u65B0\u7684\u805A\u5408\u5C42\u8BA9\u6211\u4EEC\u53EF\u4EE5\u5C06 avg \u5EA6\u91CF\u5D4C\u5957\u7F6E\u4E8E terms \u6876\u5185\u3002\u5B9E\u9645\u4E0A\uFF0C\u8FD9\u5C31\u4E3A\u6BCF\u4E2A\u989C\u8272\u751F\u6210\u4E86\u5E73\u5747\u4EF7\u683C\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
   <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
   <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;colors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
         <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;color.keyword&quot;</span>
         <span class="token punctuation">}</span>,
         <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
            <span class="token string">&quot;avg_price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
               <span class="token string">&quot;avg&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                  <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;price&quot;</span> 
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806212634681.png" alt="image-20220806212634681" loading="lazy"></p><p>\u6B63\u5982 \u989C\u8272 \u7684\u4F8B\u5B50\uFF0C\u6211\u4EEC\u9700\u8981\u7ED9\u5EA6\u91CF\u8D77\u4E00\u4E2A\u540D\u5B57\uFF08 avg_price \uFF09\u8FD9\u6837\u53EF\u4EE5\u7A0D\u540E\u6839\u636E\u540D\u5B57\u83B7\u53D6\u5B83\u7684\u503C\u3002\u6700\u540E\uFF0C\u6211\u4EEC\u6307\u5B9A\u5EA6\u91CF\u672C\u8EAB\uFF08 avg \uFF09\u4EE5\u53CA\u6211\u4EEC\u60F3\u8981\u8BA1\u7B97\u5E73\u5747\u503C\u7684\u5B57\u6BB5\uFF08 price \uFF09</p><h3 id="_3-5-\u52A8\u6001\u811A\u672C\u7684\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_3-5-\u52A8\u6001\u811A\u672C\u7684\u805A\u5408" aria-hidden="true">#</a> 3.5 \u52A8\u6001\u811A\u672C\u7684\u805A\u5408</h3><p>\u8FD9\u4E2A\u4F8B\u5B50\u544A\u8BC9\u4F60\uFF0CElasticSearch\u8FD8\u652F\u6301\u4E00\u4E9B\u57FA\u4E8E\u811A\u672C\uFF08\u751F\u6210\u8FD0\u884C\u65F6\u7684\u5B57\u6BB5\uFF09\u7684\u590D\u6742\u7684\u52A8\u6001\u805A\u5408\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;runtime_mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;make.length&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;long&quot;</span>,
      <span class="token string">&quot;script&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;emit(doc[&#39;make.keyword&#39;].value.length())&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;make_length&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;histogram&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;interval&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;make.length&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806212851263.png" alt="image-20220806212851263" loading="lazy"></p><p>histogram\u53EF\u4EE5\u53C2\u8003\u540E\u6587\u5185\u5BB9\u3002</p><h2 id="_4-\u6309\u5206\u7C7B\u5B66\u4E60bucket\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_4-\u6309\u5206\u7C7B\u5B66\u4E60bucket\u805A\u5408" aria-hidden="true">#</a> 4. \u6309\u5206\u7C7B\u5B66\u4E60Bucket\u805A\u5408</h2><blockquote><p>\u6211\u4EEC\u5728\u5177\u4F53\u5B66\u4E60\u65F6\uFF0C\u4E5F\u65E0\u9700\u5B66\u4E60\u6BCF\u4E00\u4E2A\u70B9\uFF0C\u57FA\u4E8E\u4E0A\u9762\u56FE\u7684\u8BA4\u77E5\uFF0C\u6211\u4EEC\u53EA\u9700\u752820%\u7684\u65F6\u95F4\u5B66\u4E60\u6700\u4E3A\u5E38\u7528\u768480%\u529F\u80FD\u5373\u53EF\uFF0C\u5176\u5B83\u67E5\u67E5\u6587\u6863\u800C\u5DF2\u3002</p></blockquote><h3 id="_4-1-\u524D\u7F6E\u6761\u4EF6\u7684\u8FC7\u6EE4-filter" tabindex="-1"><a class="header-anchor" href="#_4-1-\u524D\u7F6E\u6761\u4EF6\u7684\u8FC7\u6EE4-filter" aria-hidden="true">#</a> 4.1 \u524D\u7F6E\u6761\u4EF6\u7684\u8FC7\u6EE4\uFF1Afilter</h3><p>\u5728\u5F53\u524D\u6587\u6863\u96C6\u4E0A\u4E0B\u6587\u4E2D\u5B9A\u4E49\u4E0E\u6307\u5B9A\u8FC7\u6EE4\u5668(Filter)\u5339\u914D\u7684\u6240\u6709\u6587\u6863\u7684\u5355\u4E2A\u5B58\u50A8\u6876\u3002\u901A\u5E38\uFF0C\u8FD9\u5C06\u7528\u4E8E\u5C06\u5F53\u524D\u805A\u5408\u4E0A\u4E0B\u6587\u7F29\u5C0F\u5230\u4E00\u7EC4\u7279\u5B9A\u7684\u6587\u6863\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;make_by&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;honda&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
      <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;avg_price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;avg&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;price&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806213145993.png" alt="image-20220806213145993" loading="lazy"></p><h3 id="_4-2-\u5BF9filter\u8FDB\u884C\u5206\u7EC4\u805A\u5408-filters" tabindex="-1"><a class="header-anchor" href="#_4-2-\u5BF9filter\u8FDB\u884C\u5206\u7EC4\u805A\u5408-filters" aria-hidden="true">#</a> 4.2 \u5BF9filter\u8FDB\u884C\u5206\u7EC4\u805A\u5408\uFF1Afilters</h3><p>\u8BBE\u8BA1\u4E00\u4E2A\u65B0\u7684\u4F8B\u5B50, \u65E5\u5FD7\u7CFB\u7EDF\u4E2D\uFF0C\u6BCF\u6761\u65E5\u5FD7\u90FD\u662F\u5728\u6587\u672C\u4E2D\uFF0C\u5305\u542Bwarning/info\u7B49\u4FE1\u606F\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>PUT /test-agg-logs/_bulk?refresh
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;warning: page could not be rendered&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;authentication error&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;warning: connection timed out&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">4</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;info: hello pdai&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u9700\u8981\u5BF9\u5305\u542B\u4E0D\u540C\u65E5\u5FD7\u7C7B\u578B\u7684\u65E5\u5FD7\u8FDB\u884C\u5206\u7EC4\uFF0C\u8FD9\u5C31\u9700\u8981filters:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-logs/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;messages&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;filters&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;other_bucket_key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;other_messages&quot;</span>,
        <span class="token string">&quot;filters&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;infos&quot;</span> <span class="token builtin class-name">:</span>   <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;info&quot;</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span>,
          <span class="token string">&quot;warnings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;warning&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806213455024.png" alt="image-20220806213455024" loading="lazy"></p><h3 id="_4-3-\u5BF9number\u7C7B\u578B\u805A\u5408-range" tabindex="-1"><a class="header-anchor" href="#_4-3-\u5BF9number\u7C7B\u578B\u805A\u5408-range" aria-hidden="true">#</a> 4.3 \u5BF9number\u7C7B\u578B\u805A\u5408\uFF1ARange</h3><p>\u57FA\u4E8E\u591A\u6876\u503C\u6E90\u7684\u805A\u5408\uFF0C\u4F7F\u7528\u6237\u80FD\u591F\u5B9A\u4E49\u4E00\u7EC4\u8303\u56F4-\u6BCF\u4E2A\u8303\u56F4\u4EE3\u8868\u4E00\u4E2A\u6876\u3002\u5728\u805A\u5408\u8FC7\u7A0B\u4E2D\uFF0C\u5C06\u4ECE\u6BCF\u4E2A\u5B58\u50A8\u533A\u8303\u56F4\u4E2D\u68C0\u67E5\u4ECE\u6BCF\u4E2A\u6587\u6863\u4E2D\u63D0\u53D6\u7684\u503C\uFF0C\u5E76\u201C\u5B58\u50A8\u201D\u76F8\u5173/\u5339\u914D\u7684\u6587\u6863\u3002\u8BF7\u6CE8\u610F\uFF0C\u6B64\u805A\u5408\u5305\u62ECfrom\u503C\uFF0C\u4F46\u4E0D\u5305\u62ECto\u6BCF\u4E2A\u8303\u56F4\u7684\u503C\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;price_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;price&quot;</span>,
        <span class="token string">&quot;ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token number">20000</span> <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span> <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token number">20000</span>, <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token number">40000</span> <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span> <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token number">40000</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806214158026.png" alt="image-20220806214158026" loading="lazy"></p><h3 id="_4-4-\u5BF9ip\u7C7B\u578B\u805A\u5408-ip-range" tabindex="-1"><a class="header-anchor" href="#_4-4-\u5BF9ip\u7C7B\u578B\u805A\u5408-ip-range" aria-hidden="true">#</a> 4.4 \u5BF9IP\u7C7B\u578B\u805A\u5408\uFF1AIP Range</h3><p>\u4E13\u7528\u4E8EIP\u503C\u7684\u8303\u56F4\u805A\u5408\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /ip_addresses/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;ip_range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ip&quot;</span>,
        <span class="token string">&quot;ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span> <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span> <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD4\u56DE</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token punctuation">..</span>.

  <span class="token string">&quot;aggregations&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;buckets&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*-10.0.0.5&quot;</span>,
          <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5-*&quot;</span>,
          <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">260</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>CIDR Mask\u5206\u7EC4</strong></li></ul><p>\u6B64\u5916\u8FD8\u53EF\u4EE5\u7528CIDR Mask\u5206\u7EC4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /ip_addresses/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;ip_range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ip&quot;</span>,
        <span class="token string">&quot;ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token string">&quot;mask&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.0/25&quot;</span> <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span> <span class="token string">&quot;mask&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.127/25&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD4\u56DE</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token punctuation">..</span>.

  <span class="token string">&quot;aggregations&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;buckets&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.0/25&quot;</span>,
          <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.0&quot;</span>,
          <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.128&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">128</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.127/25&quot;</span>,
          <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.0&quot;</span>,
          <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.128&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">128</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u589E\u52A0key\u663E\u793A</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /ip_addresses/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;ip_range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ip&quot;</span>,
        <span class="token string">&quot;ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span> <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span> <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;keyed&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span> // here
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD4\u56DE</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token punctuation">..</span>.

  <span class="token string">&quot;aggregations&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;buckets&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;*-10.0.0.5&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;10.0.0.5-*&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">260</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u81EA\u5B9A\u4E49key\u663E\u793A</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /ip_addresses/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;ip_range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ip&quot;</span>,
        <span class="token string">&quot;ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;infinity&quot;</span>, <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span> <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span> <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and-beyond&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;keyed&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD4\u56DE</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token punctuation">..</span>.

  <span class="token string">&quot;aggregations&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ip_ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;buckets&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;infinity&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;and-beyond&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.0.0.5&quot;</span>,
          <span class="token string">&quot;doc_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">260</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-\u5BF9\u65E5\u671F\u7C7B\u578B\u805A\u5408-date-range" tabindex="-1"><a class="header-anchor" href="#_4-5-\u5BF9\u65E5\u671F\u7C7B\u578B\u805A\u5408-date-range" aria-hidden="true">#</a> 4.5 \u5BF9\u65E5\u671F\u7C7B\u578B\u805A\u5408\uFF1ADate Range</h3><p>\u4E13\u7528\u4E8E\u65E5\u671F\u503C\u7684\u8303\u56F4\u805A\u5408\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;date_range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;sold&quot;</span>,
        <span class="token string">&quot;format&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yyyy-MM&quot;</span>,
        <span class="token string">&quot;ranges&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-01&quot;</span> <span class="token punctuation">}</span>,  
          <span class="token punctuation">{</span> <span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2014-12-31&quot;</span> <span class="token punctuation">}</span> 
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806214446795.png" alt="image-20220806214446795" loading="lazy"></p>`,90),r=n("\u6B64\u805A\u5408\u4E0ERange\u805A\u5408\u4E4B\u95F4\u7684\u4E3B\u8981\u533A\u522B\u5728\u4E8E from\u548Cto\u503C\u53EF\u4EE5\u5728"),d={href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.12/search-aggregations-bucket-daterange-aggregation.html#date-format-pattern",target:"_blank",rel:"noopener noreferrer"},k=n("Date Math\u8868\u8FBE\u5F0F"),m=n("\u4E2D\u8868\u793A\uFF0C\u5E76\u4E14\u8FD8\u53EF\u4EE5\u6307\u5B9A\u65E5\u671F\u683C\u5F0F\uFF0C\u901A\u8FC7\u8BE5\u65E5\u671F\u683C\u5F0F\u5C06\u8FD4\u56DEfrom and to\u54CD\u5E94\u5B57\u6BB5\u3002\u8BF7\u6CE8\u610F\uFF0C\u6B64\u805A\u5408\u5305\u62ECfrom\u503C\uFF0C\u4F46"),b=s("strong",null,"\u4E0D\u5305\u62ECto\u6BCF\u4E2A\u8303\u56F4\u7684\u503C",-1),v=n("\u3002"),g=e(`<h3 id="_4-6-\u5BF9\u67F1\u72B6\u56FE\u529F\u80FD-histrogram" tabindex="-1"><a class="header-anchor" href="#_4-6-\u5BF9\u67F1\u72B6\u56FE\u529F\u80FD-histrogram" aria-hidden="true">#</a> 4.6 \u5BF9\u67F1\u72B6\u56FE\u529F\u80FD\uFF1AHistrogram</h3><p>\u76F4\u65B9\u56FE histogram \u672C\u8D28\u4E0A\u662F\u5C31\u662F\u4E3A\u67F1\u72B6\u56FE\u529F\u80FD\u8BBE\u8BA1\u7684\u3002</p><p>\u521B\u5EFA\u76F4\u65B9\u56FE\u9700\u8981\u6307\u5B9A\u4E00\u4E2A\u533A\u95F4\uFF0C\u5982\u679C\u6211\u4EEC\u8981\u4E3A\u552E\u4EF7\u521B\u5EFA\u4E00\u4E2A\u76F4\u65B9\u56FE\uFF0C\u53EF\u4EE5\u5C06\u95F4\u9694\u8BBE\u4E3A 20,000\u3002\u8FD9\u6837\u505A\u5C06\u4F1A\u5728\u6BCF\u4E2A $20,000 \u6863\u521B\u5EFA\u4E00\u4E2A\u65B0\u6876\uFF0C\u7136\u540E\u6587\u6863\u4F1A\u88AB\u5206\u5230\u5BF9\u5E94\u7684\u6876\u4E2D\u3002</p><p>\u5BF9\u4E8E\u4EEA\u8868\u76D8\u6765\u8BF4\uFF0C\u6211\u4EEC\u5E0C\u671B\u77E5\u9053\u6BCF\u4E2A\u552E\u4EF7\u533A\u95F4\u5185\u6C7D\u8F66\u7684\u9500\u91CF\u3002\u6211\u4EEC\u8FD8\u4F1A\u60F3\u77E5\u9053\u6BCF\u4E2A\u552E\u4EF7\u533A\u95F4\u5185\u6C7D\u8F66\u6240\u5E26\u6765\u7684\u6536\u5165\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5BF9\u6BCF\u4E2A\u533A\u95F4\u5185\u5DF2\u552E\u6C7D\u8F66\u7684\u552E\u4EF7\u6C42\u548C\u5F97\u5230\u3002</p><p>\u53EF\u4EE5\u7528 histogram \u548C\u4E00\u4E2A\u5D4C\u5957\u7684 sum \u5EA6\u91CF\u5F97\u5230\u6211\u4EEC\u60F3\u8981\u7684\u7B54\u6848\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
   <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
   <span class="token string">&quot;aggs&quot;</span>:<span class="token punctuation">{</span>
      <span class="token string">&quot;price&quot;</span>:<span class="token punctuation">{</span>
         <span class="token string">&quot;histogram&quot;</span>:<span class="token punctuation">{</span> 
            <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;price.keyword&quot;</span>,
            <span class="token string">&quot;interval&quot;</span><span class="token builtin class-name">:</span> <span class="token number">20000</span>
         <span class="token punctuation">}</span>,
         <span class="token string">&quot;aggs&quot;</span>:<span class="token punctuation">{</span>
            <span class="token string">&quot;revenue&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
               <span class="token string">&quot;sum&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
                 <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;price&quot;</span>
               <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>histogram \u6876\u8981\u6C42\u4E24\u4E2A\u53C2\u6570\uFF1A\u4E00\u4E2A\u6570\u503C\u5B57\u6BB5\u4EE5\u53CA\u4E00\u4E2A\u5B9A\u4E49\u6876\u5927\u5C0F\u95F4\u9694\u3002</li><li>sum \u5EA6\u91CF\u5D4C\u5957\u5728\u6BCF\u4E2A\u552E\u4EF7\u533A\u95F4\u5185\uFF0C\u7528\u6765\u663E\u793A\u6BCF\u4E2A\u533A\u95F4\u5185\u7684\u603B\u6536\u5165\u3002</li></ol><p>\u5982\u6211\u4EEC\u6240\u89C1\uFF0C\u67E5\u8BE2\u662F\u56F4\u7ED5 price \u805A\u5408\u6784\u5EFA\u7684\uFF0C\u5B83\u5305\u542B\u4E00\u4E2A histogram \u6876\u3002\u5B83\u8981\u6C42\u5B57\u6BB5\u7684\u7C7B\u578B\u5FC5\u987B\u662F\u6570\u503C\u578B\u7684\u540C\u65F6\u9700\u8981\u8BBE\u5B9A\u5206\u7EC4\u7684\u95F4\u9694\u8303\u56F4\u3002 \u95F4\u9694\u8BBE\u7F6E\u4E3A 20,000 \u610F\u5473\u7740\u6211\u4EEC\u5C06\u4F1A\u5F97\u5230\u5982 [0-19999, 20000-39999, ...] \u8FD9\u6837\u7684\u533A\u95F4\u3002</p><p>\u63A5\u7740\uFF0C\u6211\u4EEC\u5728\u76F4\u65B9\u56FE\u5185\u5B9A\u4E49\u5D4C\u5957\u7684\u5EA6\u91CF\uFF0C\u8FD9\u4E2A sum \u5EA6\u91CF\uFF0C\u5B83\u4F1A\u5BF9\u843D\u5165\u67D0\u4E00\u5177\u4F53\u552E\u4EF7\u533A\u95F4\u7684\u6587\u6863\u4E2D price \u5B57\u6BB5\u7684\u503C\u8FDB\u884C\u6C42\u548C\u3002 \u8FD9\u53EF\u4EE5\u4E3A\u6211\u4EEC\u63D0\u4F9B\u6BCF\u4E2A\u552E\u4EF7\u533A\u95F4\u7684\u6536\u5165\uFF0C\u4ECE\u800C\u53EF\u4EE5\u53D1\u73B0\u5230\u5E95\u662F\u666E\u901A\u5BB6\u7528\u8F66\u8D5A\u94B1\u8FD8\u662F\u5962\u4F88\u8F66\u8D5A\u94B1\u3002</p><p>\u54CD\u5E94\u7ED3\u679C\u5982\u4E0B\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806214757439.png" alt="image-20220806214757439" loading="lazy"></p><p>\u7ED3\u679C\u5F88\u5BB9\u6613\u7406\u89E3\uFF0C\u4E0D\u8FC7\u5E94\u8BE5\u6CE8\u610F\u5230\u76F4\u65B9\u56FE\u7684\u952E\u503C\u662F\u533A\u95F4\u7684\u4E0B\u9650\u3002\u952E 0 \u4EE3\u8868\u533A\u95F4 0-19\uFF0C999 \uFF0C\u952E 20000 \u4EE3\u8868\u533A\u95F4 20\uFF0C000-39\uFF0C999 \uFF0C\u7B49\u7B49\u3002</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806214835882.png" alt="image-20220806214835882" loading="lazy"></p><p>\u5F53\u7136\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4E3A\u4EFB\u4F55\u805A\u5408\u8F93\u51FA\u7684\u5206\u7C7B\u548C\u7EDF\u8BA1\u7ED3\u679C\u521B\u5EFA\u6761\u5F62\u56FE\uFF0C\u800C\u4E0D\u53EA\u662F \u76F4\u65B9\u56FE \u6876\u3002\u8BA9\u6211\u4EEC\u4EE5\u6700\u53D7\u6B22\u8FCE 10 \u79CD\u6C7D\u8F66\u4EE5\u53CA\u5B83\u4EEC\u7684\u5E73\u5747\u552E\u4EF7\u3001\u6807\u51C6\u5DEE\u8FD9\u4E9B\u4FE1\u606F\u521B\u5EFA\u4E00\u4E2A\u6761\u5F62\u56FE\u3002 \u6211\u4EEC\u4F1A\u7528\u5230 terms \u6876\u548C extended_stats \u5EA6\u91CF\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>GET /test-agg-cars/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;makes&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;make.keyword&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;stats&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;extended_stats&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;price&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4F1A\u6309\u53D7\u6B22\u8FCE\u5EA6\u8FD4\u56DE\u5236\u9020\u5546\u5217\u8868\u4EE5\u53CA\u5B83\u4EEC\u5404\u81EA\u7684\u7EDF\u8BA1\u4FE1\u606F\u3002\u6211\u4EEC\u5BF9\u5176\u4E2D\u7684 stats.avg \u3001 stats.count \u548C stats.std_deviation \u4FE1\u606F\u7279\u522B\u611F\u5174\u8DA3\uFF0C\u5E76\u7528 \u5B83\u4EEC\u8BA1\u7B97\u51FA\u6807\u51C6\u5DEE\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>std_err <span class="token operator">=</span> std_deviation / count
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806214924884.png" alt="image-20220806214924884" loading="lazy"></p><p>\u5BF9\u5E94\u62A5\u8868\uFF1A</p><p><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220806214945987.png" alt="image-20220806214945987" loading="lazy"></p><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,21),q={href:"https://pdai.tech/md/db/nosql-es/elasticsearch-x-agg-bucket.html",target:"_blank",rel:"noopener noreferrer"},h=s("strong",null,"ES\u8BE6\u89E3 - \u805A\u5408\uFF1A\u805A\u5408\u67E5\u8BE2\u4E4BBucket\u805A\u5408\u8BE6\u89E3",-1);function _(f,z){const a=o("ExternalLinkIcon");return l(),p("div",null,[u,s("p",null,[r,s("a",d,[k,t(a)]),m,b,v]),g,s("p",null,[s("a",q,[h,t(a)])])])}const E=i(c,[["render",_],["__file","elasticsearch-x-agg-bucket.html.vue"]]);export{E as default};
