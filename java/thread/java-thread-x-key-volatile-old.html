<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://java.isture.com/java/thread/java-thread-x-key-volatile-old.html"><meta property="og:site_name" content="Javaå­¦ä¹ ç¬”è®°"><meta property="og:title" content="volatileå…³é”®å­—"><meta property="og:description" content="volatile å…³é”®å­—ä¸Javaå†…å­˜æ¨¡å‹æœ‰å…³ï¼Œæ‰€ä»¥å…ˆè¦æŒæ¡å†…å­˜æ¨¡å‹ç›¸å…³çš„æ¦‚å¿µå’ŒçŸ¥è¯†ï¼Œç„¶åæˆ‘ä»¬å†åˆ†ævolatitleå…³é”®å­—çš„å®ç°åŸç†ï¼Œæœ€åæ€»ç»“ä½¿ç”¨volatileçš„ä½¿ç”¨åœºæ™¯ 1. å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ CPUçš„é€Ÿåº¦è¿œæ¯”å†…å­˜å—ï¼Œæ‰€ä»¥å¯¹æ•°æ®çš„è¯»å†™ï¼Œæ”¾åœ¨CPUçš„é«˜é€Ÿç¼“å­˜ä¸­å®Œæˆ; å¤§å®¶éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½æ˜¯åœ¨CPUä¸­æ‰§è¡Œçš„ï¼Œè€Œæ‰§è¡ŒæŒ‡ä»¤çš„è¿‡ç¨‹æ±‡..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-02-20T13:42:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2023-02-20T13:42:31.000Z"><script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?78dc0e0b4e3aedf643d6621778307a6f";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
      </script><title>volatileå…³é”®å­— | Javaå­¦ä¹ ç¬”è®°</title><meta name="description" content="volatile å…³é”®å­—ä¸Javaå†…å­˜æ¨¡å‹æœ‰å…³ï¼Œæ‰€ä»¥å…ˆè¦æŒæ¡å†…å­˜æ¨¡å‹ç›¸å…³çš„æ¦‚å¿µå’ŒçŸ¥è¯†ï¼Œç„¶åæˆ‘ä»¬å†åˆ†ævolatitleå…³é”®å­—çš„å®ç°åŸç†ï¼Œæœ€åæ€»ç»“ä½¿ç”¨volatileçš„ä½¿ç”¨åœºæ™¯ 1. å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ CPUçš„é€Ÿåº¦è¿œæ¯”å†…å­˜å—ï¼Œæ‰€ä»¥å¯¹æ•°æ®çš„è¯»å†™ï¼Œæ”¾åœ¨CPUçš„é«˜é€Ÿç¼“å­˜ä¸­å®Œæˆ; å¤§å®¶éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½æ˜¯åœ¨CPUä¸­æ‰§è¡Œçš„ï¼Œè€Œæ‰§è¡ŒæŒ‡ä»¤çš„è¿‡ç¨‹æ±‡...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-21064aac.css" as="style"><link rel="stylesheet" href="/assets/style-21064aac.css">
    <link rel="modulepreload" href="/assets/app-f28eaf21.js"><link rel="modulepreload" href="/assets/framework-0cf5f349.js"><link rel="modulepreload" href="/assets/java-thread-x-key-volatile-old.html-d952586a.js"><link rel="modulepreload" href="/assets/java-thread-x-key-volatile-old.html-4737faee.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Javaå­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">Javaå­¦ä¹ ç¬”è®°</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-creative"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/java/base/Java-basis-oop.html" class="nav-link" aria-label="JavaåŸºç¡€"><!---->JavaåŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/java/io/java-io-overview.html" class="nav-link" aria-label="Java IO"><!---->Java IO<!----></a></li><li class="dropdown-item"><a href="/java/collection/java-collection-overview.html" class="nav-link" aria-label="Javaé›†åˆ"><!---->Javaé›†åˆ<!----></a></li><li class="dropdown-item"><a href="/java/thread/java-thread-x-theorty.html" class="nav-link" aria-label="Javaå¹¶å‘"><!---->Javaå¹¶å‘<!----></a></li><li class="dropdown-item"><a href="/java/java8/java8-lambda.html" class="nav-link" aria-label="Java8"><!---->Java8<!----></a></li><li class="dropdown-item"><a href="/java/jvm/jvm-overview.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="icon iconfont icon-creative"></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/sql/sql-x-basic.html" class="nav-link" aria-label="æ•°æ®åº“åŸºç¡€/SQLåŸºç¡€"><!---->æ•°æ®åº“åŸºç¡€/SQLåŸºç¡€<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Sqlæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/sql-mysql-overview.html" class="nav-link" aria-label="Mysql"><!---->Mysql<!----></a></li><li class="dropdown-subitem"><a href="/db/oracle/oracle-b-sequence.html" class="nav-link" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="dropdown-subitem"><a href="/db/dm/dm-operation-console.html" class="nav-link" aria-label="è¾¾æ¢¦"><!---->è¾¾æ¢¦<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSqlæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/redis/db-redis-introduce.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li><li class="dropdown-subitem"><a href="/db/mongodb/mongo-x-basic.html" class="nav-link" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="dropdown-subitem"><a href="/db/es/elasticsearch-x-introduce-1.html" class="nav-link" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¡†æ¶|ä¾èµ–"><span class="title"><span class="icon iconfont icon-creative"></span>æ¡†æ¶|ä¾èµ–</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/spring/spring-overview.html" class="nav-link" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/spring-boot/springboot-x-overview.html" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ORM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/mybatis/mybatis-y-arch.html" class="nav-link" aria-label="Mybatis"><!---->Mybatis<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/mybatis-plus/mybatis-plus-x-gen-code.html" class="nav-link" aria-label="Mybatis-Plus"><!---->Mybatis-Plus<!----></a></li></ul></li><li class="dropdown-item"><a href="/dependencies/office/office-x-aspose.html" class="nav-link" aria-label="Officeæ–‡æ¡£æ“ä½œ"><!---->Officeæ–‡æ¡£æ“ä½œ<!----></a></li><li class="dropdown-item"><a href="/dependencies/cas/cas-x-overview.html" class="nav-link" aria-label="CASå•ç‚¹ç™»å½•"><!---->CASå•ç‚¹ç™»å½•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¼€å‘|æµ‹è¯•"><span class="title"><span class="icon iconfont icon-creative"></span>å¼€å‘|æµ‹è¯•</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/develop/devlibrary/dev-lib-lombok.html" class="nav-link" aria-label="å¼€å‘-å¸¸ç”¨ç±»åº“"><span class="icon iconfont icon-creative"></span>å¼€å‘-å¸¸ç”¨ç±»åº“<!----></a></li><li class="dropdown-item"><a href="/develop/security/dev-security-x-injection.html" class="nav-link" aria-label="å¼€å‘-å®‰å…¨"><span class="icon iconfont icon-creative"></span>å¼€å‘-å®‰å…¨<!----></a></li><li class="dropdown-item"><a href="/develop/optimization/optimization-x-interface-optimization.html" class="nav-link" aria-label="å¼€å‘ - ä¼˜åŒ–"><span class="icon iconfont icon-creative"></span>å¼€å‘ - ä¼˜åŒ–<!----></a></li><li class="dropdown-item"><a href="/develop/style/dev-qt-code-style.html" class="nav-link" aria-label="å¼€å‘ - è§„èŒƒ/é£æ ¼"><span class="icon iconfont icon-creative"></span>å¼€å‘ - è§„èŒƒ/é£æ ¼<!----></a></li><li class="dropdown-item"><a href="/develop/test/ut-overview" class="nav-link" aria-label="æµ‹è¯•"><span class="icon iconfont icon-creative"></span>æµ‹è¯•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è½¯ä»¶|éƒ¨ç½²"><span class="title"><span class="icon iconfont icon-creative"></span>è½¯ä»¶|éƒ¨ç½²</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/deploy/docker/docker-basic-overview.html" class="nav-link" aria-label="Docker"><span class="icon iconfont icon-creative"></span>Docker<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æ¶ˆæ¯é˜Ÿåˆ—</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/mq/mq-a-overview.html" class="nav-link" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!---->æ¶ˆæ¯é˜Ÿåˆ—<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-rabbitmq/rabbitmq-x-overview.html" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-kafka/kafka-x-overview.html" class="nav-link" aria-label="Kafka"><!---->Kafka<!----></a></li></ul></li><li class="dropdown-item"><a href="/deploy/skywalking/skywalking-x-principle.html" class="nav-link" aria-label="Skywalking"><span class="icon iconfont icon-creative"></span>Skywalking<!----></a></li><li class="dropdown-item"><a href="/deploy/linux/linux-j-monitor-overview.html" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-creative"></span>Linux<!----></a></li><li class="dropdown-item"><a href="/deploy/jenkins/jenkins-overview.html" class="nav-link" aria-label="Jenkins"><span class="icon iconfont icon-creative"></span>Jenkins<!----></a></li><li class="dropdown-item"><a href="/deploy/nginx/nginx-x-overview.html" class="nav-link" aria-label="Nginx"><span class="icon iconfont icon-creative"></span>Nginx<!----></a></li><li class="dropdown-item"><a href="/deploy/deploy/docker-basic-overview" class="nav-link" aria-label="éƒ¨ç½²"><span class="icon iconfont icon-creative"></span>éƒ¨ç½²<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶æ„|ç³»ç»Ÿ"><span class="title"><span class="icon iconfont icon-creative"></span>æ¶æ„|ç³»ç»Ÿ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/arch/base/arch-basic.html" class="nav-link" aria-label="æ¶æ„åŸºç¡€"><span class="icon iconfont icon-creative"></span>æ¶æ„åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/arch/distributed/arch-id.html" class="nav-link" aria-label="åˆ†å¸ƒå¼ç³»ç»Ÿ"><span class="icon iconfont icon-creative"></span>åˆ†å¸ƒå¼ç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/arch/microservices/ms-overview.html" class="nav-link" aria-label="å¾®æœåŠ¡"><span class="icon iconfont icon-creative"></span>å¾®æœåŠ¡<!----></a></li><li class="dropdown-item"><a href="/arch/minio/minio-concept.html" class="nav-link" aria-label="å¯¹è±¡å­˜å‚¨-Minio"><span class="icon iconfont icon-creative"></span>å¯¹è±¡å­˜å‚¨-Minio<!----></a></li><li class="dropdown-item"><a href="/arch/manage-system/manage-system-technical-selection.html" class="nav-link" aria-label="åå°ç®¡ç†ç³»ç»Ÿ"><span class="icon iconfont icon-creative"></span>åå°ç®¡ç†ç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/arch/mall/mall-sku.html" class="nav-link" aria-label="å•†åŸè®¾è®¡"><span class="icon iconfont icon-creative"></span>å•†åŸè®¾è®¡<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è¯­è¨€|å¹³å°"><span class="title"><span class="icon iconfont icon-creative"></span>è¯­è¨€|å¹³å°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/language/frontend-layout/flex-layout-overview.html" class="nav-link" aria-label="å‰ç«¯"><span class="icon iconfont icon-creative"></span>å‰ç«¯<!----></a></li><li class="dropdown-item"><a href="/language/python/python-advantage.html" class="nav-link" aria-label="python"><span class="icon iconfont icon-creative"></span>python<!----></a></li><li class="dropdown-item"><a href="/language/weixin/wx-package-Optimization.html" class="nav-link" aria-label="å¾®ä¿¡"><span class="icon iconfont icon-creative"></span>å¾®ä¿¡<!----></a></li><li class="dropdown-item"><a href="/language/ai/knowledge-graph-build.html" class="nav-link" aria-label="AIäººå·¥æ™ºèƒ½"><span class="icon iconfont icon-creative"></span>AIäººå·¥æ™ºèƒ½<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ‚é¡¹|æ€è€ƒ"><span class="title"><span class="icon iconfont icon-creative"></span>æ‚é¡¹|æ€è€ƒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/think/deepImpression/redis-bigdata-slow-problem.html" class="nav-link" aria-label="å°è±¡æ·±åˆ»bug"><span class="icon iconfont icon-creative"></span>å°è±¡æ·±åˆ»bug<!----></a></li><li class="dropdown-item"><a href="/think/optimization/optimization-x-frequent-operation-db.html" class="nav-link" aria-label="ä¼˜åŒ–"><span class="icon iconfont icon-creative"></span>ä¼˜åŒ–<!----></a></li><li class="dropdown-item"><a href="/think/misc/misc-x-middleware.html" class="nav-link" aria-label="æ‚é¡¹"><span class="icon iconfont icon-creative"></span>æ‚é¡¹<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/zszdevelop/java-study-gitbook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">JavaåŸºç¡€</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java-IO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Javaé›†åˆ</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">å¤šçº¿ç¨‹ä¸å¹¶å‘</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/java/thread/java-thread-x-theorty.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å¹¶å‘ - ç†è®ºåŸºç¡€"><!---->Java å¹¶å‘ - ç†è®ºåŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-thread-basic.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å¹¶å‘ - çº¿ç¨‹åŸºç¡€"><!---->Java å¹¶å‘ - çº¿ç¨‹åŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-all-lock.html" class="nav-link sidebar-link sidebar-page" aria-label="Javaå¹¶å‘ - Javaä¸­æ‰€æœ‰çš„é”"><!---->Javaå¹¶å‘ - Javaä¸­æ‰€æœ‰çš„é”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadlocal.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å¹¶å‘ - ThreadLocalè¯¦è§£"><!---->Java å¹¶å‘ - ThreadLocalè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadlocal-interview.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å¹¶å‘ - ThreadLocal(é¢è¯•åœºæ™¯)"><!---->Java å¹¶å‘ - ThreadLocal(é¢è¯•åœºæ™¯)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-thread-communication.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å¹¶å‘ - Javaçº¿ç¨‹é€šä¿¡æ–¹å¼"><!---->Java å¹¶å‘ - Javaçº¿ç¨‹é€šä¿¡æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-async.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å¹¶å‘ - å¼‚æ­¥ç¼–ç¨‹çš„ 7 ç§å®ç°æ–¹å¼"><!---->Java å¹¶å‘ - å¼‚æ­¥ç¼–ç¨‹çš„ 7 ç§å®ç°æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-key-synchronized.html" class="nav-link sidebar-link sidebar-page" aria-label="å…³é”®å­—: synchronizedè¯¦è§£"><!---->å…³é”®å­—: synchronizedè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-key-volatile.html" class="nav-link sidebar-link sidebar-page" aria-label="å…³é”®å­—: volatile"><!---->å…³é”®å­—: volatile<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-key-final.html" class="nav-link sidebar-link sidebar-page" aria-label="å…³é”®å­—: finalè¯¦è§£"><!---->å…³é”®å­—: finalè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-AtomicInteger.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCåŸå­ç±»: CAS, Unsafeå’ŒåŸå­ç±»è¯¦è§£"><!---->JUCåŸå­ç±»: CAS, Unsafeå’ŒåŸå­ç±»è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-LockSupport-source.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCé”: LockSupportæºç åˆ†æ"><!---->JUCé”: LockSupportæºç åˆ†æ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-LockSupport.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCé”: LockSupportè¯¦è§£"><!---->JUCé”: LockSupportè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCé”: é”æ ¸å¿ƒç±»AQSè¯¦è§£"><!---->JUCé”: é”æ ¸å¿ƒç±»AQSè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-ReentrantLock.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCé”: ReentrantLockè¯¦è§£"><!---->JUCé”: ReentrantLockè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-collection-BlockingQueue.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCé›†åˆ: BlockingQueueè¯¦è§£"><!---->JUCé›†åˆ: BlockingQueueè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCçº¿ç¨‹æ± : ThreadPoolExecutorè¯¦è§£"><!---->JUCçº¿ç¨‹æ± : ThreadPoolExecutorè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCçº¿ç¨‹æ± : ScheduledThreadPoolExecutorè¯¦è§£"><!---->JUCçº¿ç¨‹æ± : ScheduledThreadPoolExecutorè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-tool-countdownlatch.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCå·¥å…·ç±»: CountDownLatchè¯¦è§£"><!---->JUCå·¥å…·ç±»: CountDownLatchè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-executor-FutureTask.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCå·¥å…·ç±»: FutureTaskè¯¦è§£"><!---->JUCå·¥å…·ç±»: FutureTaskè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-juc-tool-CompletableFuture.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCå·¥å…·ç±»: CompletableFuture è¯¦è§£"><!---->JUCå·¥å…·ç±»: CompletableFuture è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-atomic.html" class="nav-link sidebar-link sidebar-page" aria-label="AtomicåŸå­ç±»"><!---->AtomicåŸå­ç±»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-cas.html" class="nav-link sidebar-link sidebar-page" aria-label="CASï¼ˆæ¯”è¾ƒå¹¶æ›¿æ¢ï¼‰"><!---->CASï¼ˆæ¯”è¾ƒå¹¶æ›¿æ¢ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-executors-create.html" class="nav-link sidebar-link sidebar-page" aria-label="Executorsåˆ›å»ºçº¿ç¨‹æ± "><!---->Executorsåˆ›å»ºçº¿ç¨‹æ± <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-jmm.html" class="nav-link sidebar-link sidebar-page" aria-label="Javaå†…å­˜æ¨¡å‹"><!---->Javaå†…å­˜æ¨¡å‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-spinlock.html" class="nav-link sidebar-link sidebar-page" aria-label="javaè‡ªæ—‹é”"><!---->javaè‡ªæ—‹é”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-reentrantlock-condition-source.html" class="nav-link sidebar-link sidebar-page" aria-label="ReentrantLockä¹‹æ¡ä»¶é”Conditionæºç åˆ†æ"><!---->ReentrantLockä¹‹æ¡ä»¶é”Conditionæºç åˆ†æ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-reentrantlock-array-blocking-queue.html" class="nav-link sidebar-link sidebar-page" aria-label="ReentrantLockå’Œæ¡ä»¶é”Conditionå®ç°é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue"><!---->ReentrantLockå’Œæ¡ä»¶é”Conditionå®ç°é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-reentrantlock-source.html" class="nav-link sidebar-link sidebar-page" aria-label="ReentrantLockæºç åˆ†æ(ä¸€)-æ•´ä½“æµç¨‹"><!---->ReentrantLockæºç åˆ†æ(ä¸€)-æ•´ä½“æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-reentrantlock-source3.html" class="nav-link sidebar-link sidebar-page" aria-label="ReentrantLockæºç åˆ†æ(ä¸‰)-åº”ç”¨"><!---->ReentrantLockæºç åˆ†æ(ä¸‰)-åº”ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-reentrantlock-source2.html" class="nav-link sidebar-link sidebar-page" aria-label="ReentrantLockæºç åˆ†æ(äºŒ)-è·å–é”ç»†èŠ‚"><!---->ReentrantLockæºç åˆ†æ(äºŒ)-è·å–é”ç»†èŠ‚<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-lock-reentrantlock-back.html" class="nav-link sidebar-link sidebar-page" aria-label="ReentrantLocké‡å…¥é”"><!---->ReentrantLocké‡å…¥é”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-key-synchronized2.html" class="nav-link sidebar-link sidebar-page" aria-label="synchronizedå…³é”®å­—"><!---->synchronizedå…³é”®å­—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-x-key-synchronized-principle.html" class="nav-link sidebar-link sidebar-page" aria-label="Synchronizedçš„å®ç°åŸç†"><!---->Synchronizedçš„å®ç°åŸç†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadlocal2.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadLocal"><!---->ThreadLocal<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadlocal-leak.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadLocalä½¿ç”¨ä¸å½“å¯¼è‡´å†…å­˜æ³„æ¼"><!---->ThreadLocalä½¿ç”¨ä¸å½“å¯¼è‡´å†…å­˜æ³„æ¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadlocal-scene.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadLocalä½¿ç”¨åœºæ™¯"><!---->ThreadLocalä½¿ç”¨åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpoolexecutor.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadPoolExecutorç±»"><!---->ThreadPoolExecutorç±»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-task-executor.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadPoolTaskExecutorå’ŒThreadPoolExecutoræœ‰ä½•åŒºåˆ«?"><!---->ThreadPoolTaskExecutorå’ŒThreadPoolExecutoræœ‰ä½•åŒºåˆ«?<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="volatileå…³é”®å­—"><!---->volatileå…³é”®å­—<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_1-å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ"><!---->1. å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_1-1-æ¡ˆä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1 æ¡ˆä¾‹"><!---->1.1 æ¡ˆä¾‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_1-2-å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2 å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜"><!---->1.2 å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ"><!---->2. å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-1-åŸå­æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 åŸå­æ€§"><!---->2.1 åŸå­æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-2-å¯è§æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2 å¯è§æ€§"><!---->2.2 å¯è§æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-3-æœ‰åºæ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 æœ‰åºæ€§"><!---->2.3 æœ‰åºæ€§<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-javaå†…å­˜æ¨¡å‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. Javaå†…å­˜æ¨¡å‹"><!---->3. Javaå†…å­˜æ¨¡å‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-1-åŸå­æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 åŸå­æ€§"><!---->3.1 åŸå­æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-2-å¯è§æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 å¯è§æ€§"><!---->3.2 å¯è§æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-3-æœ‰åºæ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 æœ‰åºæ€§"><!---->3.3 æœ‰åºæ€§<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_4-æ·±å…¥å‰–ævolatileå…³é”®å­—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. æ·±å…¥å‰–ævolatileå…³é”®å­—"><!---->4. æ·±å…¥å‰–ævolatileå…³é”®å­—<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_4-1-volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1 volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰"><!---->4.1 volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_4-2-volatileä¿è¯åŸå­æ€§å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2 volatileä¿è¯åŸå­æ€§å—ï¼Ÿ"><!---->4.2 volatileä¿è¯åŸå­æ€§å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-3-volatileèƒ½ä¿è¯æœ‰åºæ€§å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 volatileèƒ½ä¿è¯æœ‰åºæ€§å—"><!---->2.3 volatileèƒ½ä¿è¯æœ‰åºæ€§å—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-4-volatileçš„åŸç†å’Œå®ç°æœºåˆ¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4 volatileçš„åŸç†å’Œå®ç°æœºåˆ¶"><!---->2.4 volatileçš„åŸç†å’Œå®ç°æœºåˆ¶<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_5-ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯"><!---->5. ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_6-è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6. è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«"><!---->6. è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#å‚è€ƒæ–‡ç« " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‚è€ƒæ–‡ç« "><!---->å‚è€ƒæ–‡ç« <!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-optimistic-lock.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¹è§‚é”å’Œæ‚²è§‚é”"><!---->ä¹è§‚é”å’Œæ‚²è§‚é”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-atomicinteger-source.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸå­ç±»AtomicIntegeræºç è§£æ"><!---->åŸå­ç±»AtomicIntegeræºç è§£æ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-data.html" class="nav-link sidebar-link sidebar-page" aria-label="åœ¨æ¥å£ä¸­ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¤„ç†æ•°æ®"><!---->åœ¨æ¥å£ä¸­ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¤„ç†æ•°æ®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-base.html" class="nav-link sidebar-link sidebar-page" aria-label="å¤šçº¿ç¨‹"><!---->å¤šçº¿ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-deadlock.html" class="nav-link sidebar-link sidebar-page" aria-label="å¦‚ä½•å‘ç°ã€é¢„é˜²ã€è§£å†³æ­»é”"><!---->å¦‚ä½•å‘ç°ã€é¢„é˜²ã€è§£å†³æ­»é”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-size.html" class="nav-link sidebar-link sidebar-page" aria-label="å¦‚ä½•åˆç†é…ç½®çº¿ç¨‹æ± çš„å¤§å°"><!---->å¦‚ä½•åˆç†é…ç½®çº¿ç¨‹æ± çš„å¤§å°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-deadlock2.html" class="nav-link sidebar-link sidebar-page" aria-label="æ­»é”"><!---->æ­»é”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-atomicstampedreference-source.html" class="nav-link sidebar-link sidebar-page" aria-label="ç‰ˆæœ¬å·åŸå­ç±»AtomicStampedReferenceæºç è§£æ"><!---->ç‰ˆæœ¬å·åŸå­ç±»AtomicStampedReferenceæºç è§£æ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± "><!---->çº¿ç¨‹æ± <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-example.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± ä½¿ç”¨ç¤ºä¾‹"><!---->çº¿ç¨‹æ± ä½¿ç”¨ç¤ºä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-create.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± å››ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•"><!---->çº¿ç¨‹æ± å››ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-finish.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± æ‰§è¡Œå®Œæ‰€æœ‰ä»»åŠ¡åå†æ‰§è¡Œä¸»çº¿ç¨‹æ–¹æ¡ˆ"><!---->çº¿ç¨‹æ± æ‰§è¡Œå®Œæ‰€æœ‰ä»»åŠ¡åå†æ‰§è¡Œä¸»çº¿ç¨‹æ–¹æ¡ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-principle.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± çš„å…·ä½“å®ç°åŸç†"><!---->çº¿ç¨‹æ± çš„å…·ä½“å®ç°åŸç†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-threadpool-handler.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹"><!---->çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-cycle.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ"><!---->çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/thread/java-thread-y-thread-notify.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹é€šä¿¡(ç­‰å¾…é€šçŸ¥wait/notifyæœºåˆ¶)"><!---->çº¿ç¨‹é€šä¿¡(ç­‰å¾…é€šçŸ¥wait/notifyæœºåˆ¶)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java8</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Jvm</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java-ç¼–è¯‘</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->volatileå…³é”®å­—</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://java.isture.com" target="_blank" rel="noopener noreferrer">zszdevelop</a></span><span property="author" content="zszdevelop"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-20T13:42:31.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 25 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT25M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_1-å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level2">1. å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_1-1-æ¡ˆä¾‹" class="router-link-active router-link-exact-active toc-link level3">1.1 æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_1-2-å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">1.2 å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level2">2. å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-1-åŸå­æ€§" class="router-link-active router-link-exact-active toc-link level3">2.1 åŸå­æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-2-å¯è§æ€§" class="router-link-active router-link-exact-active toc-link level3">2.2 å¯è§æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-3-æœ‰åºæ€§" class="router-link-active router-link-exact-active toc-link level3">2.3 æœ‰åºæ€§</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-javaå†…å­˜æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level2">3. Javaå†…å­˜æ¨¡å‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-1-åŸå­æ€§" class="router-link-active router-link-exact-active toc-link level3">3.1 åŸå­æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-2-å¯è§æ€§" class="router-link-active router-link-exact-active toc-link level3">3.2 å¯è§æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_3-3-æœ‰åºæ€§" class="router-link-active router-link-exact-active toc-link level3">3.3 æœ‰åºæ€§</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_4-æ·±å…¥å‰–ævolatileå…³é”®å­—" class="router-link-active router-link-exact-active toc-link level2">4. æ·±å…¥å‰–ævolatileå…³é”®å­—</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_4-1-volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰" class="router-link-active router-link-exact-active toc-link level3">4.1 volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_4-2-volatileä¿è¯åŸå­æ€§å—" class="router-link-active router-link-exact-active toc-link level3">4.2 volatileä¿è¯åŸå­æ€§å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-3-volatileèƒ½ä¿è¯æœ‰åºæ€§å—" class="router-link-active router-link-exact-active toc-link level3">2.3 volatileèƒ½ä¿è¯æœ‰åºæ€§å—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_2-4-volatileçš„åŸç†å’Œå®ç°æœºåˆ¶" class="router-link-active router-link-exact-active toc-link level3">2.4 volatileçš„åŸç†å’Œå®ç°æœºåˆ¶</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_5-ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯" class="router-link-active router-link-exact-active toc-link level2">5. ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#_6-è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level2">6. è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/thread/java-thread-x-key-volatile-old.html#å‚è€ƒæ–‡ç« " class="router-link-active router-link-exact-active toc-link level3">å‚è€ƒæ–‡ç« </a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="volatileå…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#volatileå…³é”®å­—" aria-hidden="true">#</a> volatileå…³é”®å­—</h1><p>volatile å…³é”®å­—ä¸Javaå†…å­˜æ¨¡å‹æœ‰å…³ï¼Œæ‰€ä»¥å…ˆè¦æŒæ¡å†…å­˜æ¨¡å‹ç›¸å…³çš„æ¦‚å¿µå’ŒçŸ¥è¯†ï¼Œç„¶åæˆ‘ä»¬å†åˆ†ævolatitleå…³é”®å­—çš„å®ç°åŸç†ï¼Œæœ€åæ€»ç»“ä½¿ç”¨volatileçš„ä½¿ç”¨åœºæ™¯</p><h2 id="_1-å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ" aria-hidden="true">#</a> 1. å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ</h2><ul><li>CPUçš„é€Ÿåº¦è¿œæ¯”å†…å­˜å—ï¼Œæ‰€ä»¥å¯¹æ•°æ®çš„è¯»å†™ï¼Œæ”¾åœ¨CPUçš„é«˜é€Ÿç¼“å­˜ä¸­å®Œæˆ</li></ul><blockquote><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½æ˜¯åœ¨CPUä¸­æ‰§è¡Œçš„ï¼Œè€Œæ‰§è¡ŒæŒ‡ä»¤çš„è¿‡ç¨‹æ±‡æ€»ï¼ŒåŠ¿å¿…æ¶‰åŠåˆ°æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚ç”±äºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶æ•°æ®æ˜¯å­˜æ”¾åœ¨ä¸»å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰å½“ä¸­çš„ï¼Œè¿™æ˜¯å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºCPUæ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œè€Œä»å†…å­˜è¯»å–æ•°æ®å’Œå‘å†…å­˜å†™å…¥æ•°æ®çš„è¿‡ç¨‹è·ŸCPUæ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦æ¯”èµ·æ¥è¦æ…¢çš„å¤šï¼Œå› æ­¤å¦‚æœä»»ä½•æ—¶å€™å¯¹æ•°æ®çš„æ“ä½œéƒ½è¦é€šè¿‡å’Œå†…å­˜çš„äº¤äº’è¿›è¡Œã€‚ä¼šå¤§å¤§é™ä½æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦ã€‚å› æ­¤CPUé‡Œé¢å°±æœ‰äº†é«˜é€Ÿç¼“å­˜</p></blockquote><ul><li>ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†éœ€è¦çš„æ•°æ®ä»<strong>ä¸»å­˜å¤åˆ¶ä¸€ä»½åˆ°CPUé«˜é€Ÿç¼“å­˜</strong>,CPUè¿›è¡Œè®¡ç®—æ—¶<strong>ä»é«˜é€Ÿç¼“å­˜è¯»å–æ•°æ®å’Œå‘å…¶ä¸­å†™å…¥æ•°æ®</strong>ï¼Œç„¶å<strong>åˆ·æ–°åˆ°ä¸»å­˜ä¸­</strong></li></ul><h3 id="_1-1-æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_1-1-æ¡ˆä¾‹" aria-hidden="true">#</a> 1.1 æ¡ˆä¾‹</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>i = i + 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å½“çº¿ç¨‹æ‰§è¡Œè¿™ä¸ªè¯­å¥æ—¶ï¼Œä¼šå…ˆä»ä¸»å­˜å½“ä¸­è¯»å–içš„å€¼ï¼Œç„¶åå¤åˆ¶ä¸€ä»½åˆ°é«˜é€Ÿç¼“å­˜å½“ä¸­ï¼Œç„¶åCPUæ‰§è¡ŒæŒ‡ä»¤å¯¹iè¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶åå°†æ•°æ®å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œæœ€åå°†é«˜é€Ÿç¼“å­˜ä¸­iæœ€æ–°çš„å€¼åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚</p><h3 id="_1-2-å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_1-2-å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜" aria-hidden="true">#</a> 1.2 å¤šçº¿ç¨‹é¢ä¸´çš„é—®é¢˜</h3><h4 id="_1-2-1-é—®é¢˜åŸå› " tabindex="-1"><a class="header-anchor" href="#_1-2-1-é—®é¢˜åŸå› " aria-hidden="true">#</a> 1.2.1 é—®é¢˜åŸå› </h4><p>åœ¨<strong>å¤šæ ¸CPU</strong>ä¸­æ¯æ¡<strong>çº¿ç¨‹å¯èƒ½è¿è¡Œåœ¨ä¸åŒçš„CPU</strong>ä¸­ï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼ˆå¯¹å•æ ¸CPUæ¥è¯´ï¼Œå…¶å®ä¹Ÿä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼Œåªä¸è¿‡æ˜¯ä»¥çº¿ç¨‹è°ƒåº¦çš„å½¢å¼æ¥åˆ†åˆ«æ‰§è¡Œçš„ï¼‰ã€‚æœ¬æ–‡æˆ‘ä»¬ä»¥å¤šæ ¸CPUä¸ºä¾‹ã€‚</p><h4 id="_1-2-2-ç¼“å­˜ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#_1-2-2-ç¼“å­˜ä¸€è‡´æ€§" aria-hidden="true">#</a> 1.2.2 ç¼“å­˜ä¸€è‡´æ€§</h4><p>â€‹ æ¯”å¦‚åŒæ—¶æœ‰2ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå‡å¦‚åˆå§‹æ—¶içš„å€¼ä¸º0ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¹‹åiçš„å€¼å˜ä¸º2ã€‚ä½†æ˜¯äº‹å®ä¼šæ˜¯è¿™æ ·å—ï¼Ÿ</p><p>å¯èƒ½å­˜åœ¨ä¸‹é¢ä¸€ç§æƒ…å†µï¼šåˆå§‹æ—¶ï¼Œä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¯»å–içš„å€¼å­˜å…¥å„è‡ªæ‰€åœ¨çš„CPUçš„é«˜é€Ÿç¼“å­˜å½“ä¸­ï¼Œç„¶åçº¿ç¨‹1è¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶åæŠŠiçš„æœ€æ–°å€¼1å†™å…¥åˆ°å†…å­˜ã€‚æ­¤æ—¶çº¿ç¨‹2çš„é«˜é€Ÿç¼“å­˜å½“ä¸­içš„å€¼è¿˜æ˜¯0ï¼Œè¿›è¡ŒåŠ 1æ“ä½œä¹‹åï¼Œiçš„å€¼ä¸º1ï¼Œç„¶åçº¿ç¨‹2æŠŠiçš„å€¼å†™å…¥å†…å­˜ã€‚</p><p>æœ€ç»ˆç»“æœiçš„å€¼æ˜¯1ï¼Œè€Œä¸æ˜¯2ã€‚è¿™å°±æ˜¯è‘—åçš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚é€šå¸¸ç§°è¿™ç§è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®çš„å˜é‡ä¸ºå…±äº«å˜é‡ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªå˜é‡åœ¨å¤šä¸ªCPUä¸­éƒ½å­˜åœ¨ç¼“å­˜ï¼ˆä¸€èˆ¬åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹æ—¶æ‰ä¼šå‡ºç°ï¼‰ï¼Œé‚£ä¹ˆå°±å¯èƒ½å­˜åœ¨ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><h4 id="_1-2-3-å¦‚ä½•è§£å†³" tabindex="-1"><a class="header-anchor" href="#_1-2-3-å¦‚ä½•è§£å†³" aria-hidden="true">#</a> 1.2.3 å¦‚ä½•è§£å†³</h4><ol><li>é€šè¿‡åœ¨æ€»çº¿åŠ LOCKé”çš„æ–¹å¼</li><li>é€šè¿‡ç¼“å­˜ä¸€è‡´æ€§åè®®</li></ol><p>è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯ç¡¬ä»¶å±‚é¢ä¸Šæä¾›çš„æ–¹å¼</p><h5 id="_1-2-3-1-é€šè¿‡åœ¨æ€»çº¿åŠ locké”çš„æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_1-2-3-1-é€šè¿‡åœ¨æ€»çº¿åŠ locké”çš„æ–¹å¼" aria-hidden="true">#</a> 1.2.3.1 é€šè¿‡åœ¨æ€»çº¿åŠ LOCKé”çš„æ–¹å¼</h5><p>åœ¨æ—©æœŸçš„CPUå½“ä¸­ï¼Œæ˜¯é€šè¿‡åœ¨æ€»çº¿ä¸ŠåŠ LOCK#é”çš„å½¢å¼æ¥è§£å†³ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å› ä¸ºCPUå’Œå…¶ä»–éƒ¨ä»¶è¿›è¡Œé€šä¿¡éƒ½æ˜¯é€šè¿‡æ€»çº¿æ¥è¿›è¡Œçš„ï¼Œå¦‚æœå¯¹æ€»çº¿åŠ LOCK#é”çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¯´é˜»å¡äº†å…¶ä»–CPUå¯¹å…¶ä»–éƒ¨ä»¶è®¿é—®ï¼ˆå¦‚å†…å­˜ï¼‰ï¼Œä»è€Œä½¿å¾—åªèƒ½æœ‰ä¸€ä¸ªCPUèƒ½ä½¿ç”¨è¿™ä¸ªå˜é‡çš„å†…å­˜ã€‚æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­ å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ i = i +1ï¼Œå¦‚æœåœ¨æ‰§è¡Œè¿™æ®µä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨æ€»çº¿ä¸Šå‘å‡ºäº†LCOK#é”çš„ä¿¡å·ï¼Œé‚£ä¹ˆåªæœ‰ç­‰å¾…è¿™æ®µä»£ç å®Œå…¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå…¶ä»–CPUæ‰èƒ½ä»å˜é‡iæ‰€åœ¨çš„å†…å­˜è¯»å–å˜é‡ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™æ ·å°±è§£å†³äº†ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ä¸Šé¢çš„æ–¹å¼ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºåœ¨<strong>é”ä½æ€»çº¿æœŸé—´ï¼Œå…¶ä»–CPUæ— æ³•è®¿é—®å†…å­˜ï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚</strong></p><h5 id="_1-2-3-2-ç¼“å­˜ä¸€è‡´æ€§åè®®" tabindex="-1"><a class="header-anchor" href="#_1-2-3-2-ç¼“å­˜ä¸€è‡´æ€§åè®®" aria-hidden="true">#</a> 1.2.3.2 ç¼“å­˜ä¸€è‡´æ€§åè®®</h5><p>æ‰€ä»¥å°±å‡ºç°äº†<strong>ç¼“å­˜ä¸€è‡´æ€§åè®®</strong>ã€‚æœ€å‡ºåçš„å°±æ˜¯Intel çš„MESIåè®®ï¼ŒMESIåè®®ä¿è¯äº†æ¯ä¸ªç¼“å­˜ä¸­ä½¿ç”¨çš„å…±äº«å˜é‡çš„å‰¯æœ¬æ˜¯ä¸€è‡´çš„ã€‚å®ƒæ ¸å¿ƒçš„æ€æƒ³æ˜¯ï¼š<strong>å½“CPUå†™æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç°æ“ä½œçš„å˜é‡æ˜¯å…±äº«å˜é‡</strong>ï¼Œå³åœ¨å…¶ä»–CPUä¸­ä¹Ÿå­˜åœ¨è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œä¼šå‘å‡ºä¿¡å·é€šçŸ¥å…¶ä»–CPUå°†è¯¥å˜é‡çš„<strong>ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆçŠ¶æ€</strong>ï¼Œå› æ­¤å½“å…¶ä»–CPUéœ€è¦è¯»å–è¿™ä¸ªå˜é‡æ—¶ï¼Œå‘ç°è‡ªå·±ç¼“å­˜ä¸­ç¼“å­˜è¯¥å˜é‡çš„ç¼“å­˜è¡Œæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä»å†…å­˜é‡æ–°è¯»å–ã€‚</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20190914220720769.png" alt="image-20190914220720769" tabindex="0" loading="lazy"><figcaption>image-20190914220720769</figcaption></figure><h2 id="_2-å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_2-å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ" aria-hidden="true">#</a> 2. å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ</h2><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼šåŸå­æ€§é—®é¢˜ï¼Œå¯è§æ€§é—®é¢˜ï¼Œæœ‰åºæ€§é—®é¢˜</p><h3 id="_2-1-åŸå­æ€§" tabindex="-1"><a class="header-anchor" href="#_2-1-åŸå­æ€§" aria-hidden="true">#</a> 2.1 åŸå­æ€§</h3><p>åŸå­æ€§ï¼šå³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œ <strong>è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ</strong>å¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œ<strong>è¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œ</strong>ã€‚</p><blockquote><p>ä¸€ä¸ªå¾ˆç»å…¸çš„ä¾‹å­å°±æ˜¯é“¶è¡Œè´¦æˆ·è½¬è´¦é—®é¢˜ï¼š</p><p>æ¯”å¦‚ä»è´¦æˆ·Aå‘è´¦æˆ·Bè½¬1000å…ƒï¼Œé‚£ä¹ˆå¿…ç„¶åŒ…æ‹¬2ä¸ªæ“ä½œï¼šä»è´¦æˆ·Aå‡å»1000å…ƒï¼Œå¾€è´¦æˆ·BåŠ ä¸Š1000å…ƒã€‚</p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¿™2ä¸ªæ“ä½œä¸å…·å¤‡åŸå­æ€§ï¼Œä¼šé€ æˆä»€ä¹ˆæ ·çš„åæœã€‚å‡å¦‚ä»è´¦æˆ·Aå‡å»1000å…ƒä¹‹åï¼Œæ“ä½œçªç„¶ä¸­æ­¢ã€‚ç„¶ååˆä»Bå–å‡ºäº†500å…ƒï¼Œå–å‡º500å…ƒä¹‹åï¼Œå†æ‰§è¡Œ å¾€è´¦æˆ·BåŠ ä¸Š1000å…ƒ çš„æ“ä½œã€‚è¿™æ ·å°±ä¼šå¯¼è‡´è´¦æˆ·Aè™½ç„¶å‡å»äº†1000å…ƒï¼Œä½†æ˜¯è´¦æˆ·Bæ²¡æœ‰æ”¶åˆ°è¿™ä¸ªè½¬è¿‡æ¥çš„1000å…ƒã€‚</p><p>æ‰€ä»¥è¿™2ä¸ªæ“ä½œå¿…é¡»è¦å…·å¤‡åŸå­æ€§æ‰èƒ½ä¿è¯ä¸å‡ºç°ä¸€äº›æ„å¤–çš„é—®é¢˜ã€‚</p><p>åŒæ ·åœ°åæ˜ åˆ°å¹¶å‘ç¼–ç¨‹ä¸­ä¼šå‡ºç°ä»€ä¹ˆç»“æœå‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œå¤§å®¶æƒ³ä¸€ä¸‹å‡å¦‚ä¸ºä¸€ä¸ª32ä½çš„å˜é‡èµ‹å€¼è¿‡ç¨‹ä¸å…·å¤‡åŸå­æ€§çš„è¯ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆåæœï¼Ÿ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>i = 9;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‡è‹¥ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¿™ä¸ªè¯­å¥æ—¶ï¼Œæˆ‘æš‚ä¸”å‡è®¾ä¸ºä¸€ä¸ª32ä½çš„å˜é‡èµ‹å€¼åŒ…æ‹¬ä¸¤ä¸ªè¿‡ç¨‹ï¼šä¸ºä½16ä½èµ‹å€¼ï¼Œä¸ºé«˜16ä½èµ‹å€¼ã€‚</p><p>é‚£ä¹ˆå°±å¯èƒ½å‘ç”Ÿä¸€ç§æƒ…å†µï¼šå½“å°†ä½16ä½æ•°å€¼å†™å…¥ä¹‹åï¼Œçªç„¶è¢«ä¸­æ–­ï¼Œè€Œæ­¤æ—¶åˆæœ‰ä¸€ä¸ªçº¿ç¨‹å»è¯»å–içš„å€¼ï¼Œé‚£ä¹ˆè¯»å–åˆ°çš„å°±æ˜¯é”™è¯¯çš„æ•°æ®ã€‚</p></blockquote><h3 id="_2-2-å¯è§æ€§" tabindex="-1"><a class="header-anchor" href="#_2-2-å¯è§æ€§" aria-hidden="true">#</a> 2.2 å¯è§æ€§</h3><p>å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹<strong>ä¿®æ”¹</strong>äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œ<strong>å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚</strong></p><blockquote><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//çº¿ç¨‹1æ‰§è¡Œçš„ä»£ç 
int i = 0;
i = 10;

//çº¿ç¨‹2æ‰§è¡Œçš„ä»£ç 
j = i;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è‹¥æ‰§è¡Œçº¿ç¨‹1çš„æ˜¯CPU1ï¼Œæ‰§è¡Œçº¿ç¨‹2çš„æ˜¯CPU2ã€‚ç”±ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œå½“çº¿ç¨‹1æ‰§è¡Œ i =10è¿™å¥æ—¶ï¼Œä¼šå…ˆæŠŠiçš„åˆå§‹å€¼åŠ è½½åˆ°CPU1çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç„¶åèµ‹å€¼ä¸º10ï¼Œé‚£ä¹ˆåœ¨CPU1çš„é«˜é€Ÿç¼“å­˜å½“ä¸­içš„å€¼å˜ä¸º10äº†ï¼Œå´æ²¡æœ‰ç«‹å³å†™å…¥åˆ°ä¸»å­˜å½“ä¸­ã€‚</p><p>æ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œ j = iï¼Œå®ƒä¼šå…ˆå»ä¸»å­˜è¯»å–içš„å€¼å¹¶åŠ è½½åˆ°CPU2çš„ç¼“å­˜å½“ä¸­ï¼Œæ³¨æ„æ­¤æ—¶å†…å­˜å½“ä¸­içš„å€¼è¿˜æ˜¯0ï¼Œé‚£ä¹ˆå°±ä¼šä½¿å¾—jçš„å€¼ä¸º0ï¼Œè€Œä¸æ˜¯10.</p><p>è¿™å°±æ˜¯å¯è§æ€§é—®é¢˜ï¼Œçº¿ç¨‹1å¯¹å˜é‡iä¿®æ”¹äº†ä¹‹åï¼Œçº¿ç¨‹2æ²¡æœ‰ç«‹å³çœ‹åˆ°çº¿ç¨‹1ä¿®æ”¹çš„å€¼ã€‚</p></blockquote><h3 id="_2-3-æœ‰åºæ€§" tabindex="-1"><a class="header-anchor" href="#_2-3-æœ‰åºæ€§" aria-hidden="true">#</a> 2.3 æœ‰åºæ€§</h3><p>æœ‰åºæ€§ï¼šå³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p><blockquote><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>int i = 0;              
boolean flag = false;
i = 1;                //è¯­å¥1  
flag = true;          //è¯­å¥2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªintå‹å˜é‡ï¼Œå®šä¹‰äº†ä¸€ä¸ªbooleanç±»å‹å˜é‡ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œã€‚ä»ä»£ç é¡ºåºä¸Šçœ‹ï¼Œè¯­å¥1æ˜¯åœ¨è¯­å¥2å‰é¢çš„ï¼Œé‚£ä¹ˆJVMåœ¨çœŸæ­£æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ä¼šä¿è¯è¯­å¥1ä¸€å®šä¼šåœ¨è¯­å¥2å‰é¢æ‰§è¡Œå—ï¼Ÿä¸ä¸€å®šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œå¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åºï¼ˆInstruction Reorderï¼‰ã€‚</p><p>ä¸‹é¢è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><p>æ¯”å¦‚ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè¯­å¥1å’Œè¯­å¥2è°å…ˆæ‰§è¡Œå¯¹æœ€ç»ˆçš„ç¨‹åºç»“æœå¹¶æ²¡æœ‰å½±å“ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯­å¥2å…ˆæ‰§è¡Œè€Œè¯­å¥1åæ‰§è¡Œã€‚</p><p>ä½†æ˜¯è¦æ³¨æ„ï¼Œè™½ç„¶å¤„ç†å™¨ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆç»“æœä¼šå’Œä»£ç é¡ºåºæ‰§è¡Œç»“æœç›¸åŒï¼Œé‚£ä¹ˆå®ƒé ä»€ä¹ˆä¿è¯çš„å‘¢ï¼Ÿå†çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>int a = 10;    //è¯­å¥1
int r = 2;    //è¯­å¥2
a = a + 3;    //è¯­å¥3
r = a*a;     //è¯­å¥4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç æœ‰4ä¸ªè¯­å¥ï¼Œé‚£ä¹ˆå¯èƒ½çš„ä¸€ä¸ªæ‰§è¡Œé¡ºåºæ˜¯ï¼š</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20190914221554358.png" alt="image-20190914221554358" tabindex="0" loading="lazy"><figcaption>image-20190914221554358</figcaption></figure><p>é‚£ä¹ˆå¯ä¸å¯èƒ½æ˜¯è¿™ä¸ªæ‰§è¡Œé¡ºåºå‘¢ï¼š è¯­å¥2 è¯­å¥1 è¯­å¥4 è¯­å¥3</p><p>ä¸å¯èƒ½ï¼Œå› ä¸ºå¤„ç†å™¨åœ¨è¿›è¡Œé‡æ’åºæ—¶æ˜¯ä¼šè€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ï¼Œå¦‚æœä¸€ä¸ªæŒ‡ä»¤Instruction 2å¿…é¡»ç”¨åˆ°Instruction 1çš„ç»“æœï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šä¿è¯Instruction 1ä¼šåœ¨Instruction 2ä¹‹å‰æ‰§è¡Œã€‚</p><p>è™½ç„¶é‡æ’åºä¸ä¼šå½±å“å•ä¸ªçº¿ç¨‹å†…ç¨‹åºæ‰§è¡Œçš„ç»“æœï¼Œä½†æ˜¯å¤šçº¿ç¨‹å‘¢ï¼Ÿä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//çº¿ç¨‹1:
context = loadContext();   //è¯­å¥1
inited = true;             //è¯­å¥2

//çº¿ç¨‹2:
while(!inited ){
 sleep()
}
doSomethingwithconfig(context);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºè¯­å¥1å’Œè¯­å¥2æ²¡æœ‰æ•°æ®ä¾èµ–æ€§ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«é‡æ’åºã€‚å‡å¦‚å‘ç”Ÿäº†é‡æ’åºï¼Œåœ¨çº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆæ‰§è¡Œè¯­å¥2ï¼Œè€Œæ­¤æ˜¯çº¿ç¨‹2ä¼šä»¥ä¸ºåˆå§‹åŒ–å·¥ä½œå·²ç»å®Œæˆï¼Œé‚£ä¹ˆå°±ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œå»æ‰§è¡ŒdoSomethingwithconfig(context)æ–¹æ³•ï¼Œè€Œæ­¤æ—¶contextå¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<strong>æŒ‡ä»¤é‡æ’åºä¸ä¼šå½±å“å•ä¸ªçº¿ç¨‹çš„æ‰§è¡Œï¼Œä½†æ˜¯ä¼šå½±å“åˆ°çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§</strong>ã€‚</p></blockquote><p>è¦æƒ³å¹¶å‘ç¨‹åºæ­£ç¡®åœ°æ‰§è¡Œï¼Œå¿…é¡»è¦ä¿è¯åŸå­æ€§ã€å¯è§æ€§ä»¥åŠæœ‰åºæ€§ã€‚åªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰è¢«ä¿è¯ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œä¸æ­£ç¡®ã€‚</p><h2 id="_3-javaå†…å­˜æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_3-javaå†…å­˜æ¨¡å‹" aria-hidden="true">#</a> 3. Javaå†…å­˜æ¨¡å‹</h2><p>Javaå†…å­˜æ¨¡å‹ä¸ºæˆ‘ä»¬æä¾›äº†å“ªäº›ä¿è¯ä»¥åŠåœ¨javaä¸­æä¾›äº†å“ªäº›æ–¹æ³•å’Œæœºåˆ¶æ¥è®©æˆ‘ä»¬åœ¨è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹æ—¶èƒ½å¤Ÿä¿è¯ç¨‹åºæ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</p><p>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ¥å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚</p><p><strong>Javaå†…å­˜æ¨¡å‹è§„å®šæ‰€æœ‰çš„å˜é‡éƒ½æ˜¯å­˜åœ¨ä¸»å­˜å½“ä¸­ï¼ˆç±»ä¼¼äºå‰é¢è¯´çš„ç‰©ç†å†…å­˜ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆç±»ä¼¼äºå‰é¢çš„é«˜é€Ÿç¼“å­˜ï¼‰ã€‚çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥å¯¹ä¸»å­˜è¿›è¡Œæ“ä½œã€‚å¹¶ä¸”æ¯ä¸ªçº¿ç¨‹ä¸èƒ½è®¿é—®å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ã€‚</strong></p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šåœ¨javaä¸­ï¼Œæ‰§è¡Œä¸‹é¢è¿™ä¸ªè¯­å¥ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>i  = 10;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œçº¿ç¨‹å¿…é¡»å…ˆåœ¨è‡ªå·±çš„å·¥ä½œçº¿ç¨‹ä¸­å¯¹å˜é‡iæ‰€åœ¨çš„ç¼“å­˜è¡Œè¿›è¡Œèµ‹å€¼æ“ä½œï¼Œç„¶åå†å†™å…¥ä¸»å­˜å½“ä¸­ã€‚è€Œä¸æ˜¯ç›´æ¥å°†æ•°å€¼10å†™å…¥ä¸»å­˜å½“ä¸­ã€‚</p><p>é‚£ä¹ˆJavaè¯­è¨€ æœ¬èº«å¯¹ åŸå­æ€§ã€å¯è§æ€§ä»¥åŠæœ‰åºæ€§æä¾›äº†å“ªäº›ä¿è¯å‘¢ï¼Ÿ</p><h3 id="_3-1-åŸå­æ€§" tabindex="-1"><a class="header-anchor" href="#_3-1-åŸå­æ€§" aria-hidden="true">#</a> 3.1 åŸå­æ€§</h3><p>åœ¨Javaä¸­ï¼Œå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡çš„è¯»å–å’Œèµ‹å€¼æ“ä½œæ˜¯åŸå­æ€§æ“ä½œï¼Œå³è¿™äº›æ“ä½œæ˜¯ä¸å¯è¢«ä¸­æ–­çš„ï¼Œè¦ä¹ˆæ‰§è¡Œï¼Œè¦ä¹ˆä¸æ‰§è¡Œã€‚</p><p>Javaå†…å­˜æ¨¡å‹åªä¿è¯äº†åŸºæœ¬è¯»å–å’Œèµ‹å€¼æ˜¯åŸå­æ€§æ“ä½œï¼Œå¦‚æœè¦å®ç°æ›´å¤§èŒƒå›´æ“ä½œçš„<strong>åŸå­æ€§ï¼Œå¯ä»¥é€šè¿‡synchronizedå’ŒLockæ¥å®ç°</strong>ã€‚ç”±äºsynchronizedå’ŒLockèƒ½å¤Ÿä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥ä»£ç å—ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸å­˜åœ¨åŸå­æ€§é—®é¢˜äº†ï¼Œä»è€Œä¿è¯äº†åŸå­æ€§ã€‚</p><blockquote><p>è¯·åˆ†æä»¥ä¸‹å“ªäº›æ“ä½œæ˜¯åŸå­æ€§æ“ä½œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    
<span class="token comment">//è¯­å¥1 </span>
x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  
<span class="token comment">//è¯­å¥2</span>
y <span class="token operator">=</span> x<span class="token punctuation">;</span>         
<span class="token comment">//è¯­å¥3</span>
x<span class="token operator">++</span><span class="token punctuation">;</span>     
<span class="token comment">//è¯­å¥4`</span>
x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å’‹ä¸€çœ‹ï¼Œæœ‰äº›æœ‹å‹å¯èƒ½ä¼šè¯´ä¸Šé¢çš„4ä¸ªè¯­å¥ä¸­çš„æ“ä½œéƒ½æ˜¯åŸå­æ€§æ“ä½œã€‚å…¶å®åªæœ‰è¯­å¥1æ˜¯åŸå­æ€§æ“ä½œï¼Œå…¶ä»–ä¸‰ä¸ªè¯­å¥éƒ½ä¸æ˜¯åŸå­æ€§æ“ä½œã€‚</p><p>è¯­å¥1æ˜¯ç›´æ¥å°†æ•°å€¼10èµ‹å€¼ç»™xï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„ä¼šç›´æ¥å°†æ•°å€¼10å†™å…¥åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚</p><p>è¯­å¥2å®é™…ä¸ŠåŒ…å«2ä¸ªæ“ä½œï¼Œå®ƒå…ˆè¦å»è¯»å–xçš„å€¼ï¼Œå†å°†xçš„å€¼å†™å…¥å·¥ä½œå†…å­˜ï¼Œè™½ç„¶è¯»å–xçš„å€¼ä»¥åŠ å°†xçš„å€¼å†™å…¥å·¥ä½œå†…å­˜ è¿™2ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§æ“ä½œï¼Œä½†æ˜¯åˆèµ·æ¥å°±ä¸æ˜¯åŸå­æ€§æ“ä½œäº†ã€‚</p><p>åŒæ ·çš„ï¼Œx++å’Œ x = x+1åŒ…æ‹¬3ä¸ªæ“ä½œï¼šè¯»å–xçš„å€¼ï¼Œè¿›è¡ŒåŠ 1æ“ä½œï¼Œå†™å…¥æ–°çš„å€¼ã€‚</p><p>æ‰€ä»¥ä¸Šé¢4ä¸ªè¯­å¥åªæœ‰è¯­å¥1çš„æ“ä½œå…·å¤‡åŸå­æ€§ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ç®€å•çš„è¯»å–ã€èµ‹å€¼ï¼ˆè€Œä¸”å¿…é¡»æ˜¯å°†æ•°å­—èµ‹å€¼ç»™æŸä¸ªå˜é‡ï¼Œå˜é‡ä¹‹é—´çš„ç›¸äº’èµ‹å€¼ä¸æ˜¯åŸå­æ“ä½œï¼‰æ‰æ˜¯åŸå­æ“ä½œã€‚</p><p>ä¸è¿‡è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šåœ¨32ä½å¹³å°ä¸‹ï¼Œå¯¹64ä½æ•°æ®çš„è¯»å–å’Œèµ‹å€¼æ˜¯éœ€è¦é€šè¿‡ä¸¤ä¸ªæ“ä½œæ¥å®Œæˆçš„ï¼Œä¸èƒ½ä¿è¯å…¶åŸå­æ€§ã€‚ä½†æ˜¯å¥½åƒåœ¨æœ€æ–°çš„JDKä¸­ï¼ŒJVMå·²ç»ä¿è¯å¯¹64ä½æ•°æ®çš„è¯»å–å’Œèµ‹å€¼ä¹Ÿæ˜¯åŸå­æ€§æ“ä½œäº†ã€‚</p><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒJavaå†…å­˜æ¨¡å‹åªä¿è¯äº†åŸºæœ¬è¯»å–å’Œèµ‹å€¼æ˜¯åŸå­æ€§æ“ä½œï¼Œå¦‚æœè¦å®ç°æ›´å¤§èŒƒå›´æ“ä½œçš„åŸå­æ€§ï¼Œå¯ä»¥é€šè¿‡synchronizedå’ŒLockæ¥å®ç°ã€‚ç”±äºsynchronizedå’ŒLockèƒ½å¤Ÿä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥ä»£ç å—ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸å­˜åœ¨åŸå­æ€§é—®é¢˜äº†ï¼Œä»è€Œä¿è¯äº†åŸå­æ€§ã€‚</p></blockquote><h3 id="_3-2-å¯è§æ€§" tabindex="-1"><a class="header-anchor" href="#_3-2-å¯è§æ€§" aria-hidden="true">#</a> 3.2 å¯è§æ€§</h3><p>å¯¹äºå¯è§æ€§ï¼ŒJavaæä¾›äº†volatileå…³é”®å­—æ¥ä¿è¯å¯è§æ€§ã€‚</p><p>é€šè¿‡synchronizedå’ŒLockä¹Ÿèƒ½å¤Ÿä¿è¯å¯è§æ€§</p><blockquote><p>â€‹ å½“ä¸€ä¸ªå…±äº«å˜é‡è¢«volatileä¿®é¥°æ—¶ï¼Œå®ƒä¼šä¿è¯ä¿®æ”¹çš„å€¼ä¼šç«‹å³è¢«æ›´æ–°åˆ°ä¸»å­˜ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦è¯»å–æ—¶ï¼Œå®ƒä¼šå»å†…å­˜ä¸­è¯»å–æ–°å€¼ã€‚</p><p>è€Œæ™®é€šçš„å…±äº«å˜é‡ä¸èƒ½ä¿è¯å¯è§æ€§ï¼Œå› ä¸ºæ™®é€šå…±äº«å˜é‡è¢«ä¿®æ”¹ä¹‹åï¼Œä»€ä¹ˆæ—¶å€™è¢«å†™å…¥ä¸»å­˜æ˜¯ä¸ç¡®å®šçš„ï¼Œå½“å…¶ä»–çº¿ç¨‹å»è¯»å–æ—¶ï¼Œæ­¤æ—¶å†…å­˜ä¸­å¯èƒ½è¿˜æ˜¯åŸæ¥çš„æ—§å€¼ï¼Œå› æ­¤æ— æ³•ä¿è¯å¯è§æ€§ã€‚</p><p>â€‹ å¦å¤–ï¼Œé€šè¿‡synchronizedå’ŒLockä¹Ÿèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œsynchronizedå’ŒLockèƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¹¶ä¸”åœ¨é‡Šæ”¾é”ä¹‹å‰ä¼šå°†å¯¹å˜é‡çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚å› æ­¤å¯ä»¥ä¿è¯å¯è§æ€§ã€‚</p></blockquote><h3 id="_3-3-æœ‰åºæ€§" tabindex="-1"><a class="header-anchor" href="#_3-3-æœ‰åºæ€§" aria-hidden="true">#</a> 3.3 æœ‰åºæ€§</h3><p>åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯é‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</p><blockquote><p>åœ¨Javaé‡Œé¢ï¼Œå¯ä»¥é€šè¿‡volatileå…³é”®å­—æ¥ä¿è¯ä¸€å®šçš„â€œæœ‰åºæ€§â€ï¼ˆå…·ä½“åŸç†åœ¨ä¸‹ä¸€èŠ‚è®²è¿°ï¼‰ã€‚å¦å¤–å¯ä»¥é€šè¿‡synchronizedå’ŒLockæ¥ä¿è¯æœ‰åºæ€§ï¼Œå¾ˆæ˜¾ç„¶ï¼Œsynchronizedå’ŒLockä¿è¯æ¯ä¸ªæ—¶åˆ»æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè‡ªç„¶å°±ä¿è¯äº†æœ‰åºæ€§ã€‚</p></blockquote><h2 id="_4-æ·±å…¥å‰–ævolatileå…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#_4-æ·±å…¥å‰–ævolatileå…³é”®å­—" aria-hidden="true">#</a> 4. æ·±å…¥å‰–ævolatileå…³é”®å­—</h2><h3 id="_4-1-volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰" tabindex="-1"><a class="header-anchor" href="#_4-1-volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰" aria-hidden="true">#</a> 4.1 volatileå…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰</h3><p>ä¸€æ—¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆç±»çš„æˆå‘˜å˜é‡ã€ç±»çš„é™æ€æˆå‘˜å˜é‡ï¼‰è¢«volatileä¿®é¥°ä¹‹åï¼Œé‚£ä¹ˆå°±å…·å¤‡äº†ä¸¤å±‚è¯­ä¹‰ï¼š</p><p>1ï¼‰ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚</p><p>2ï¼‰ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</p><blockquote><p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼Œå‡å¦‚çº¿ç¨‹1å…ˆæ‰§è¡Œï¼Œçº¿ç¨‹2åæ‰§è¡Œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//çº¿ç¨‹1</span>
<span class="token keyword">boolean</span> stop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//çº¿ç¨‹2</span>
stop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç æ˜¯å¾ˆå…¸å‹çš„ä¸€æ®µä»£ç ï¼Œå¾ˆå¤šäººåœ¨ä¸­æ–­çº¿ç¨‹æ—¶å¯èƒ½éƒ½ä¼šé‡‡ç”¨è¿™ç§æ ‡è®°åŠæ³•ã€‚ä½†æ˜¯äº‹å®ä¸Šï¼Œè¿™æ®µä»£ç ä¼šå®Œå…¨è¿è¡Œæ­£ç¡®ä¹ˆï¼Ÿå³ä¸€å®šä¼šå°†çº¿ç¨‹ä¸­æ–­ä¹ˆï¼Ÿä¸ä¸€å®šï¼Œä¹Ÿè®¸åœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œè¿™ä¸ªä»£ç èƒ½å¤ŸæŠŠçº¿ç¨‹ä¸­æ–­ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ä¼šå¯¼è‡´æ— æ³•ä¸­æ–­çº¿ç¨‹ï¼ˆè™½ç„¶è¿™ä¸ªå¯èƒ½æ€§å¾ˆå°ï¼Œä½†æ˜¯åªè¦ä¸€æ—¦å‘ç”Ÿè¿™ç§æƒ…å†µå°±ä¼šé€ æˆæ­»å¾ªç¯äº†ï¼‰ã€‚</p><p>ä¸‹é¢è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ä¸ºä½•æœ‰å¯èƒ½å¯¼è‡´æ— æ³•ä¸­æ–­çº¿ç¨‹ã€‚åœ¨å‰é¢å·²ç»è§£é‡Šè¿‡ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œé‚£ä¹ˆçº¿ç¨‹1åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå°†stopå˜é‡çš„å€¼æ‹·è´ä¸€ä»½æ”¾åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜å½“ä¸­ã€‚</p><p>é‚£ä¹ˆå½“çº¿ç¨‹2æ›´æ”¹äº†stopå˜é‡çš„å€¼ä¹‹åï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠå†™å…¥ä¸»å­˜å½“ä¸­ï¼Œçº¿ç¨‹2è½¬å»åšå…¶ä»–äº‹æƒ…äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹1ç”±äºä¸çŸ¥é“çº¿ç¨‹2å¯¹stopå˜é‡çš„æ›´æ”¹ï¼Œå› æ­¤è¿˜ä¼šä¸€ç›´å¾ªç¯ä¸‹å»ã€‚</p><p>ä½†æ˜¯ç”¨volatileä¿®é¥°ä¹‹åå°±å˜å¾—ä¸ä¸€æ ·äº†ï¼š</p><p>ç¬¬ä¸€ï¼šä½¿ç”¨volatileå…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ï¼›</p><p>ç¬¬äºŒï¼šä½¿ç”¨volatileå…³é”®å­—çš„è¯ï¼Œå½“çº¿ç¨‹2è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šå¯¼è‡´çº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡stopçš„ç¼“å­˜è¡Œæ— æ•ˆï¼ˆåæ˜ åˆ°ç¡¬ä»¶å±‚çš„è¯ï¼Œå°±æ˜¯CPUçš„L1æˆ–è€…L2ç¼“å­˜ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆï¼‰ï¼›</p><p>ç¬¬ä¸‰ï¼šç”±äºçº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡stopçš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œæ‰€ä»¥çº¿ç¨‹1å†æ¬¡è¯»å–å˜é‡stopçš„å€¼æ—¶ä¼šå»ä¸»å­˜è¯»å–ã€‚</p><p>é‚£ä¹ˆåœ¨çº¿ç¨‹2ä¿®æ”¹stopå€¼æ—¶ï¼ˆå½“ç„¶è¿™é‡ŒåŒ…æ‹¬2ä¸ªæ“ä½œï¼Œä¿®æ”¹çº¿ç¨‹2å·¥ä½œå†…å­˜ä¸­çš„å€¼ï¼Œç„¶åå°†ä¿®æ”¹åçš„å€¼å†™å…¥å†…å­˜ï¼‰ï¼Œä¼šä½¿å¾—çº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡stopçš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œç„¶åçº¿ç¨‹1è¯»å–æ—¶ï¼Œå‘ç°è‡ªå·±çš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œå®ƒä¼šç­‰å¾…ç¼“å­˜è¡Œå¯¹åº”çš„ä¸»å­˜åœ°å€è¢«æ›´æ–°ä¹‹åï¼Œç„¶åå»å¯¹åº”çš„ä¸»å­˜è¯»å–æœ€æ–°çš„å€¼ã€‚</p><p>é‚£ä¹ˆçº¿ç¨‹1è¯»å–åˆ°çš„å°±æ˜¯æœ€æ–°çš„æ­£ç¡®çš„å€¼ã€‚</p></blockquote><h3 id="_4-2-volatileä¿è¯åŸå­æ€§å—" tabindex="-1"><a class="header-anchor" href="#_4-2-volatileä¿è¯åŸå­æ€§å—" aria-hidden="true">#</a> 4.2 volatileä¿è¯åŸå­æ€§å—ï¼Ÿ</h3><blockquote><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> inc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       inc<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">final</span> <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
                       test<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
        
       <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span>
           <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤§å®¶æƒ³ä¸€ä¸‹è¿™æ®µç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯å¤šå°‘ï¼Ÿä¹Ÿè®¸æœ‰äº›æœ‹å‹è®¤ä¸ºæ˜¯10000ã€‚ä½†æ˜¯äº‹å®ä¸Šè¿è¡Œå®ƒä¼šå‘ç°æ¯æ¬¡è¿è¡Œç»“æœéƒ½ä¸ä¸€è‡´ï¼Œéƒ½æ˜¯ä¸€ä¸ªå°äº10000çš„æ•°å­—ã€‚</p><p>å¯èƒ½æœ‰çš„æœ‹å‹å°±ä¼šæœ‰ç–‘é—®ï¼Œä¸å¯¹å•Šï¼Œä¸Šé¢æ˜¯å¯¹å˜é‡incè¿›è¡Œè‡ªå¢æ“ä½œï¼Œç”±äºvolatileä¿è¯äº†å¯è§æ€§ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹incè‡ªå¢å®Œä¹‹åï¼Œåœ¨å…¶ä»–çº¿ç¨‹ä¸­éƒ½èƒ½çœ‹åˆ°ä¿®æ”¹åçš„å€¼å•Šï¼Œæ‰€ä»¥æœ‰10ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œäº†1000æ¬¡æ“ä½œï¼Œé‚£ä¹ˆæœ€ç»ˆincçš„å€¼åº”è¯¥æ˜¯1000*10=10000ã€‚</p><p>è¿™é‡Œé¢å°±æœ‰ä¸€ä¸ªè¯¯åŒºäº†ï¼Œvolatileå…³é”®å­—èƒ½ä¿è¯å¯è§æ€§æ²¡æœ‰é”™ï¼Œä½†æ˜¯ä¸Šé¢çš„ç¨‹åºé”™åœ¨æ²¡èƒ½ä¿è¯åŸå­æ€§ã€‚å¯è§æ€§åªèƒ½ä¿è¯æ¯æ¬¡è¯»å–çš„æ˜¯æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯volatileæ²¡åŠæ³•ä¿è¯å¯¹å˜é‡çš„æ“ä½œçš„åŸå­æ€§ã€‚</p><p>åœ¨å‰é¢å·²ç»æåˆ°è¿‡ï¼Œè‡ªå¢æ“ä½œæ˜¯ä¸å…·å¤‡åŸå­æ€§çš„ï¼Œå®ƒåŒ…æ‹¬è¯»å–å˜é‡çš„åŸå§‹å€¼ã€è¿›è¡ŒåŠ 1æ“ä½œã€å†™å…¥å·¥ä½œå†…å­˜ã€‚é‚£ä¹ˆå°±æ˜¯è¯´è‡ªå¢æ“ä½œçš„ä¸‰ä¸ªå­æ“ä½œå¯èƒ½ä¼šåˆ†å‰²å¼€æ‰§è¡Œï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä¸‹é¢è¿™ç§æƒ…å†µå‡ºç°ï¼š</p><p>å‡å¦‚æŸä¸ªæ—¶åˆ»å˜é‡incçš„å€¼ä¸º10ï¼Œ</p><p>çº¿ç¨‹1å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œçº¿ç¨‹1å…ˆè¯»å–äº†å˜é‡incçš„åŸå§‹å€¼ï¼Œç„¶åçº¿ç¨‹1è¢«é˜»å¡äº†ï¼›</p><p>ç„¶åçº¿ç¨‹2å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œçº¿ç¨‹2ä¹Ÿå»è¯»å–å˜é‡incçš„åŸå§‹å€¼ï¼Œç”±äºçº¿ç¨‹1åªæ˜¯å¯¹å˜é‡incè¿›è¡Œè¯»å–æ“ä½œï¼Œè€Œæ²¡æœ‰å¯¹å˜é‡è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´çº¿ç¨‹2çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡incçš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œæ‰€ä»¥çº¿ç¨‹2ä¼šç›´æ¥å»ä¸»å­˜è¯»å–incçš„å€¼ï¼Œå‘ç°incçš„å€¼æ—¶10ï¼Œç„¶åè¿›è¡ŒåŠ 1æ“ä½œï¼Œå¹¶æŠŠ11å†™å…¥å·¥ä½œå†…å­˜ï¼Œæœ€åå†™å…¥ä¸»å­˜ã€‚</p><p>ç„¶åçº¿ç¨‹1æ¥ç€è¿›è¡ŒåŠ 1æ“ä½œï¼Œç”±äºå·²ç»è¯»å–äº†incçš„å€¼ï¼Œæ³¨æ„æ­¤æ—¶åœ¨çº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­incçš„å€¼ä»ç„¶ä¸º10ï¼Œæ‰€ä»¥çº¿ç¨‹1å¯¹incè¿›è¡ŒåŠ 1æ“ä½œåincçš„å€¼ä¸º11ï¼Œç„¶åå°†11å†™å…¥å·¥ä½œå†…å­˜ï¼Œæœ€åå†™å…¥ä¸»å­˜ã€‚</p><p>é‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œäº†ä¸€æ¬¡è‡ªå¢æ“ä½œåï¼Œincåªå¢åŠ äº†1ã€‚</p><p>è§£é‡Šåˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰æœ‹å‹ä¼šæœ‰ç–‘é—®ï¼Œä¸å¯¹å•Šï¼Œå‰é¢ä¸æ˜¯ä¿è¯ä¸€ä¸ªå˜é‡åœ¨ä¿®æ”¹volatileå˜é‡æ—¶ï¼Œä¼šè®©ç¼“å­˜è¡Œæ— æ•ˆå—ï¼Ÿç„¶åå…¶ä»–çº¿ç¨‹å»è¯»å°±ä¼šè¯»åˆ°æ–°çš„å€¼ï¼Œå¯¹ï¼Œè¿™ä¸ªæ²¡é”™ã€‚è¿™ä¸ªå°±æ˜¯ä¸Šé¢çš„happens-beforeè§„åˆ™ä¸­çš„volatileå˜é‡è§„åˆ™ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œçº¿ç¨‹1å¯¹å˜é‡è¿›è¡Œè¯»å–æ“ä½œä¹‹åï¼Œè¢«é˜»å¡äº†çš„è¯ï¼Œå¹¶æ²¡æœ‰å¯¹incå€¼è¿›è¡Œä¿®æ”¹ã€‚ç„¶åè™½ç„¶volatileèƒ½ä¿è¯çº¿ç¨‹2å¯¹å˜é‡incçš„å€¼è¯»å–æ˜¯ä»å†…å­˜ä¸­è¯»å–çš„ï¼Œä½†æ˜¯çº¿ç¨‹1æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥çº¿ç¨‹2æ ¹æœ¬å°±ä¸ä¼šçœ‹åˆ°ä¿®æ”¹çš„å€¼ã€‚</p><p>æ ¹æºå°±åœ¨è¿™é‡Œï¼Œè‡ªå¢æ“ä½œä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œè€Œä¸”volatileä¹Ÿæ— æ³•ä¿è¯å¯¹å˜é‡çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚</p><p>æŠŠä¸Šé¢çš„ä»£ç æ”¹æˆä»¥ä¸‹ä»»ä½•ä¸€ç§éƒ½å¯ä»¥è¾¾åˆ°æ•ˆæœï¼š</p><p>é‡‡ç”¨synchronizedï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span>  <span class="token keyword">int</span> inc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  inc<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
                  test<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span>
      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡‡ç”¨Lockï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span>  <span class="token keyword">int</span> inc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
      inc<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span><span class="token punctuation">{</span>
      lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
                  test<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span>
      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡‡ç”¨AtomicIntegerï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span>  <span class="token class-name">AtomicInteger</span> inc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  inc<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
                  test<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span>
      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨java 1.5çš„java.util.concurrent.atomicåŒ…ä¸‹æä¾›äº†ä¸€äº›åŸå­æ“ä½œç±»ï¼Œå³å¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„ è‡ªå¢ï¼ˆåŠ 1æ“ä½œï¼‰ï¼Œè‡ªå‡ï¼ˆå‡1æ“ä½œï¼‰ã€ä»¥åŠåŠ æ³•æ“ä½œï¼ˆåŠ ä¸€ä¸ªæ•°ï¼‰ï¼Œå‡æ³•æ“ä½œï¼ˆå‡ä¸€ä¸ªæ•°ï¼‰è¿›è¡Œäº†å°è£…ï¼Œä¿è¯è¿™äº›æ“ä½œæ˜¯åŸå­æ€§æ“ä½œã€‚atomicæ˜¯åˆ©ç”¨CASæ¥å®ç°åŸå­æ€§æ“ä½œçš„ï¼ˆCompare And Swapï¼‰ï¼ŒCASå®é™…ä¸Šæ˜¯åˆ©ç”¨å¤„ç†å™¨æä¾›çš„CMPXCHGæŒ‡ä»¤å®ç°çš„ï¼Œè€Œå¤„ç†å™¨æ‰§è¡ŒCMPXCHGæŒ‡ä»¤æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œã€‚</p></blockquote><h3 id="_2-3-volatileèƒ½ä¿è¯æœ‰åºæ€§å—" tabindex="-1"><a class="header-anchor" href="#_2-3-volatileèƒ½ä¿è¯æœ‰åºæ€§å—" aria-hidden="true">#</a> 2.3 volatileèƒ½ä¿è¯æœ‰åºæ€§å—</h3><p>åœ¨å‰é¢æåˆ°volatileå…³é”®å­—èƒ½ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œæ‰€ä»¥volatileèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯æœ‰åºæ€§ã€‚</p><blockquote><p>volatileå…³é”®å­—ç¦æ­¢æŒ‡ä»¤é‡æ’åºæœ‰ä¸¤å±‚æ„æ€ï¼š</p><p>1ï¼‰å½“ç¨‹åºæ‰§è¡Œåˆ°volatileå˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼›</p><p>2ï¼‰åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°†åœ¨å¯¹volatileå˜é‡è®¿é—®çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠvolatileå˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚</p><p>å¯èƒ½ä¸Šé¢è¯´çš„æ¯”è¾ƒç»•ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//xã€yä¸ºévolatileå˜é‡</span>
<span class="token comment">//flagä¸ºvolatileå˜é‡</span>

x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token comment">//è¯­å¥1</span>
y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">//è¯­å¥2</span>
flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">//è¯­å¥3</span>
x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>         <span class="token comment">//è¯­å¥4</span>
y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment">//è¯­å¥5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºflagå˜é‡ä¸ºvolatileå˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒæŒ‡ä»¤é‡æ’åºçš„è¿‡ç¨‹çš„æ—¶å€™ï¼Œä¸ä¼šå°†è¯­å¥3æ”¾åˆ°è¯­å¥1ã€è¯­å¥2å‰é¢ï¼Œä¹Ÿä¸ä¼šè®²è¯­å¥3æ”¾åˆ°è¯­å¥4ã€è¯­å¥5åé¢ã€‚ä½†æ˜¯è¦æ³¨æ„è¯­å¥1å’Œè¯­å¥2çš„é¡ºåºã€è¯­å¥4å’Œè¯­å¥5çš„é¡ºåºæ˜¯ä¸ä½œä»»ä½•ä¿è¯çš„ã€‚</p><p>å¹¶ä¸”volatileå…³é”®å­—èƒ½ä¿è¯ï¼Œæ‰§è¡Œåˆ°è¯­å¥3æ—¶ï¼Œè¯­å¥1å’Œè¯­å¥2å¿…å®šæ˜¯æ‰§è¡Œå®Œæ¯•äº†çš„ï¼Œä¸”è¯­å¥1å’Œè¯­å¥2çš„æ‰§è¡Œç»“æœå¯¹è¯­å¥3ã€è¯­å¥4ã€è¯­å¥5æ˜¯å¯è§çš„ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å›åˆ°å‰é¢ä¸¾çš„ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//çº¿ç¨‹1:</span>
context <span class="token operator">=</span> <span class="token function">loadContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//è¯­å¥1</span>
inited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>             <span class="token comment">//è¯­å¥2</span>

<span class="token comment">//çº¿ç¨‹2:</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>inited <span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">doSomethingwithconfig</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰é¢ä¸¾è¿™ä¸ªä¾‹å­çš„æ—¶å€™ï¼Œæåˆ°æœ‰å¯èƒ½è¯­å¥2ä¼šåœ¨è¯­å¥1ä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆä¹…å¯èƒ½å¯¼è‡´contextè¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œè€Œçº¿ç¨‹2ä¸­å°±ä½¿ç”¨æœªåˆå§‹åŒ–çš„contextå»è¿›è¡Œæ“ä½œï¼Œå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p><p>è¿™é‡Œå¦‚æœç”¨volatileå…³é”®å­—å¯¹initedå˜é‡è¿›è¡Œä¿®é¥°ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼Œå› ä¸ºå½“æ‰§è¡Œåˆ°è¯­å¥2æ—¶ï¼Œå¿…å®šèƒ½ä¿è¯contextå·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚</p></blockquote><h3 id="_2-4-volatileçš„åŸç†å’Œå®ç°æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_2-4-volatileçš„åŸç†å’Œå®ç°æœºåˆ¶" aria-hidden="true">#</a> 2.4 <strong>volatileçš„åŸç†å’Œå®ç°æœºåˆ¶</strong></h3><p>ä¸‹é¢è¿™æ®µè¯æ‘˜è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼š</p><p>â€œè§‚å¯ŸåŠ å…¥volatileå…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥volatileå…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼ŒåŠ å…¥volatileå…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€æŒ‡ä»¤â€</p><p>lockå‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾›3ä¸ªåŠŸèƒ½ï¼š</p><p>1ï¼‰å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›</p><p>2ï¼‰å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›</p><p>3ï¼‰å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»–CPUä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚</p><h2 id="_5-ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_5-ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯" aria-hidden="true">#</a> 5. ä½¿ç”¨volatileå…³é”®å­—çš„åœºæ™¯</h2><p>synchronizedå…³é”®å­—æ˜¯é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸€æ®µä»£ç ï¼Œé‚£ä¹ˆå°±ä¼šå¾ˆå½±å“ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œè€Œvolatileå…³é”®å­—åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½è¦ä¼˜äºsynchronizedï¼Œä½†æ˜¯è¦æ³¨æ„volatileå…³é”®å­—æ˜¯æ— æ³•æ›¿ä»£synchronizedå…³é”®å­—çš„ï¼Œå› ä¸ºvolatileå…³é”®å­—æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨volatileå¿…é¡»å…·å¤‡ä»¥ä¸‹2ä¸ªæ¡ä»¶ï¼š</p><p>1ï¼‰å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼</p><p>2ï¼‰è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­</p><p>å®é™…ä¸Šï¼Œè¿™äº›æ¡ä»¶è¡¨æ˜ï¼Œå¯ä»¥è¢«å†™å…¥ volatile å˜é‡çš„è¿™äº›æœ‰æ•ˆå€¼ç‹¬ç«‹äºä»»ä½•ç¨‹åºçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å˜é‡çš„å½“å‰çŠ¶æ€ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘çš„ç†è§£å°±æ˜¯ä¸Šé¢çš„2ä¸ªæ¡ä»¶éœ€è¦ä¿è¯æ“ä½œæ˜¯åŸå­æ€§æ“ä½œï¼Œæ‰èƒ½ä¿è¯ä½¿ç”¨volatileå…³é”®å­—çš„ç¨‹åºåœ¨å¹¶å‘æ—¶èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œã€‚</p><p>ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªJavaä¸­ä½¿ç”¨volatileçš„å‡ ä¸ªåœºæ™¯ã€‚</p><p><strong>1.çŠ¶æ€æ ‡è®°é‡</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
 
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">boolean</span> inited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//çº¿ç¨‹1:</span>
context <span class="token operator">=</span> <span class="token function">loadContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
inited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            
 
<span class="token comment">//çº¿ç¨‹2:</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>inited <span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">doSomethingwithconfig</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.double check</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
     
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         
    <span class="token punctuation">}</span>
     
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_6-è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«" aria-hidden="true">#</a> 6. è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«</h2><ul><li><strong>volatileå…³é”®å­—</strong>æ˜¯çº¿ç¨‹åŒæ­¥çš„<strong>è½»é‡çº§å®ç°</strong>ï¼Œæ‰€ä»¥<strong>volatileæ€§èƒ½è‚¯å®šæ¯”synchronizedå…³é”®å­—è¦å¥½</strong>ã€‚ä½†æ˜¯<strong>volatileå…³é”®å­—åªèƒ½ç”¨äºå˜é‡è€Œsynchronizedå…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å—</strong>ã€‚synchronizedå…³é”®å­—åœ¨JavaSE1.6ä¹‹åè¿›è¡Œäº†ä¸»è¦åŒ…æ‹¬ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„åå‘é”å’Œè½»é‡çº§é”ä»¥åŠå…¶å®ƒå„ç§ä¼˜åŒ–ä¹‹åæ‰§è¡Œæ•ˆç‡æœ‰äº†æ˜¾è‘—æå‡ï¼Œ<strong>å®é™…å¼€å‘ä¸­ä½¿ç”¨ synchronized å…³é”®å­—çš„åœºæ™¯è¿˜æ˜¯æ›´å¤šä¸€äº›</strong>ã€‚</li><li><strong>å¤šçº¿ç¨‹è®¿é—®volatileå…³é”®å­—ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè€Œsynchronizedå…³é”®å­—å¯èƒ½ä¼šå‘ç”Ÿé˜»å¡</strong></li><li><strong>volatileå…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚synchronizedå…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</strong></li><li><strong>volatileå…³é”®å­—ä¸»è¦ç”¨äºè§£å†³å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œ synchronizedå…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§</strong></li></ul><h3 id="å‚è€ƒæ–‡ç« " tabindex="-1"><a class="header-anchor" href="#å‚è€ƒæ–‡ç« " aria-hidden="true">#</a> å‚è€ƒæ–‡ç« </h3><p><a href="https://www.cnblogs.com/dolphin0520/p/3920373.html" target="_blank" rel="noopener noreferrer">Javaå¹¶å‘ç¼–ç¨‹ï¼švolatileå…³é”®å­—è§£æ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zszdevelop/java-study-gitbook/edit/main/docs/java/thread/java-thread-x-key-volatile-old.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zszdevelop@163.com">zszdevelop</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/java/thread/java-thread-y-threadpool-task-executor.html" class="nav-link prev" aria-label="ThreadPoolTaskExecutorå’ŒThreadPoolExecutoræœ‰ä½•åŒºåˆ«?"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->ThreadPoolTaskExecutorå’ŒThreadPoolExecutoræœ‰ä½•åŒºåˆ«?</div></a><a href="/java/thread/java-thread-y-optimistic-lock.html" class="nav-link next" aria-label="ä¹è§‚é”å’Œæ‚²è§‚é”"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">ä¹è§‚é”å’Œæ‚²è§‚é”<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href='https://beian.miit.gov.cn' target='_blank' style='color: var(--c-text-lighter);>é—½ICPå¤‡18001806å·-1</a></div><div class="copyright">Copyright Â© 2023 zszdevelop</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-f28eaf21.js" defer></script>
  </body>
</html>
