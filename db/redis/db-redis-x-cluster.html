<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://java.isture.com/db/redis/db-redis-x-cluster.html"><meta property="og:site_name" content="Javaå­¦ä¹ ç¬”è®°"><meta property="og:title" content="Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£"><meta property="og:description" content="å‰é¢ä¸¤ç¯‡æ–‡ç« ï¼Œä¸»ä»å¤åˆ¶ ()å’Œå“¨å…µæœºåˆ¶ ()ä¿éšœäº†é«˜å¯ç”¨ï¼Œå°±è¯»å†™åˆ†ç¦»è€Œè¨€è™½ç„¶slaveèŠ‚ç‚¹æ‰©å±•äº†ä¸»ä»çš„è¯»å¹¶å‘èƒ½åŠ›ï¼Œä½†æ˜¯å†™èƒ½åŠ›å’Œå­˜å‚¨èƒ½åŠ›æ˜¯æ— æ³•è¿›è¡Œæ‰©å±•ï¼Œå°±åªèƒ½æ˜¯masterèŠ‚ç‚¹èƒ½å¤Ÿæ‰¿è½½çš„ä¸Šé™ã€‚å¦‚æœé¢å¯¹æµ·é‡æ•°æ®é‚£ä¹ˆå¿…ç„¶éœ€è¦æ„å»ºmasterï¼ˆä¸»èŠ‚ç‚¹åˆ†ç‰‡)ä¹‹é—´çš„é›†ç¾¤ï¼ŒåŒæ—¶å¿…ç„¶éœ€è¦å¸æ”¶é«˜å¯ç”¨ï¼ˆä¸»ä»å¤åˆ¶å’Œå“¨å…µæœºåˆ¶ï¼‰èƒ½åŠ›ï¼Œå³æ¯ä¸ªmasteråˆ†ç‰‡èŠ‚ç‚¹è¿˜éœ€è¦æœ‰slave..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-02-20T13:42:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2023-02-20T13:42:31.000Z"><script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?78dc0e0b4e3aedf643d6621778307a6f";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
      </script><title>Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£ | Javaå­¦ä¹ ç¬”è®°</title><meta name="description" content="å‰é¢ä¸¤ç¯‡æ–‡ç« ï¼Œä¸»ä»å¤åˆ¶ ()å’Œå“¨å…µæœºåˆ¶ ()ä¿éšœäº†é«˜å¯ç”¨ï¼Œå°±è¯»å†™åˆ†ç¦»è€Œè¨€è™½ç„¶slaveèŠ‚ç‚¹æ‰©å±•äº†ä¸»ä»çš„è¯»å¹¶å‘èƒ½åŠ›ï¼Œä½†æ˜¯å†™èƒ½åŠ›å’Œå­˜å‚¨èƒ½åŠ›æ˜¯æ— æ³•è¿›è¡Œæ‰©å±•ï¼Œå°±åªèƒ½æ˜¯masterèŠ‚ç‚¹èƒ½å¤Ÿæ‰¿è½½çš„ä¸Šé™ã€‚å¦‚æœé¢å¯¹æµ·é‡æ•°æ®é‚£ä¹ˆå¿…ç„¶éœ€è¦æ„å»ºmasterï¼ˆä¸»èŠ‚ç‚¹åˆ†ç‰‡)ä¹‹é—´çš„é›†ç¾¤ï¼ŒåŒæ—¶å¿…ç„¶éœ€è¦å¸æ”¶é«˜å¯ç”¨ï¼ˆä¸»ä»å¤åˆ¶å’Œå“¨å…µæœºåˆ¶ï¼‰èƒ½åŠ›ï¼Œå³æ¯ä¸ªmasteråˆ†ç‰‡èŠ‚ç‚¹è¿˜éœ€è¦æœ‰slave...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-21064aac.css" as="style"><link rel="stylesheet" href="/assets/style-21064aac.css">
    <link rel="modulepreload" href="/assets/app-33d8c51f.js"><link rel="modulepreload" href="/assets/framework-0cf5f349.js"><link rel="modulepreload" href="/assets/db-redis-x-cluster.html-6785abe8.js"><link rel="modulepreload" href="/assets/db-redis-x-cluster.html-95eee71b.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Javaå­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">Javaå­¦ä¹ ç¬”è®°</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-creative"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/java/base/Java-basis-oop.html" class="nav-link" aria-label="JavaåŸºç¡€"><!---->JavaåŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/java/io/java-io-overview.html" class="nav-link" aria-label="Java IO"><!---->Java IO<!----></a></li><li class="dropdown-item"><a href="/java/collection/java-collection-overview.html" class="nav-link" aria-label="Javaé›†åˆ"><!---->Javaé›†åˆ<!----></a></li><li class="dropdown-item"><a href="/java/thread/java-thread-x-theorty.html" class="nav-link" aria-label="Javaå¹¶å‘"><!---->Javaå¹¶å‘<!----></a></li><li class="dropdown-item"><a href="/java/java8/java8-lambda.html" class="nav-link" aria-label="Java8"><!---->Java8<!----></a></li><li class="dropdown-item"><a href="/java/jvm/jvm-overview.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="icon iconfont icon-creative"></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/sql/sql-x-basic.html" class="nav-link" aria-label="æ•°æ®åº“åŸºç¡€/SQLåŸºç¡€"><!---->æ•°æ®åº“åŸºç¡€/SQLåŸºç¡€<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Sqlæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/sql-mysql-overview.html" class="nav-link" aria-label="Mysql"><!---->Mysql<!----></a></li><li class="dropdown-subitem"><a href="/db/oracle/oracle-b-sequence.html" class="nav-link" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="dropdown-subitem"><a href="/db/dm/dm-operation-console.html" class="nav-link" aria-label="è¾¾æ¢¦"><!---->è¾¾æ¢¦<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSqlæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/redis/db-redis-introduce.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li><li class="dropdown-subitem"><a href="/db/mongodb/mongo-x-basic.html" class="nav-link" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="dropdown-subitem"><a href="/db/es/elasticsearch-x-introduce-1.html" class="nav-link" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¡†æ¶|ä¾èµ–"><span class="title"><span class="icon iconfont icon-creative"></span>æ¡†æ¶|ä¾èµ–</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/spring/spring-overview.html" class="nav-link" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/spring-boot/springboot-x-overview.html" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ORM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/mybatis/mybatis-y-arch.html" class="nav-link" aria-label="Mybatis"><!---->Mybatis<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/mybatis-plus/mybatis-plus-x-gen-code.html" class="nav-link" aria-label="Mybatis-Plus"><!---->Mybatis-Plus<!----></a></li></ul></li><li class="dropdown-item"><a href="/dependencies/office/office-x-aspose.html" class="nav-link" aria-label="Officeæ–‡æ¡£æ“ä½œ"><!---->Officeæ–‡æ¡£æ“ä½œ<!----></a></li><li class="dropdown-item"><a href="/dependencies/cas/cas-x-overview.html" class="nav-link" aria-label="CASå•ç‚¹ç™»å½•"><!---->CASå•ç‚¹ç™»å½•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¼€å‘|æµ‹è¯•"><span class="title"><span class="icon iconfont icon-creative"></span>å¼€å‘|æµ‹è¯•</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/develop/devlibrary/dev-lib-lombok.html" class="nav-link" aria-label="å¼€å‘-å¸¸ç”¨ç±»åº“"><span class="icon iconfont icon-creative"></span>å¼€å‘-å¸¸ç”¨ç±»åº“<!----></a></li><li class="dropdown-item"><a href="/develop/security/dev-security-x-injection.html" class="nav-link" aria-label="å¼€å‘-å®‰å…¨"><span class="icon iconfont icon-creative"></span>å¼€å‘-å®‰å…¨<!----></a></li><li class="dropdown-item"><a href="/develop/optimization/optimization-x-interface-optimization.html" class="nav-link" aria-label="å¼€å‘ - ä¼˜åŒ–"><span class="icon iconfont icon-creative"></span>å¼€å‘ - ä¼˜åŒ–<!----></a></li><li class="dropdown-item"><a href="/develop/style/dev-qt-code-style.html" class="nav-link" aria-label="å¼€å‘ - è§„èŒƒ/é£æ ¼"><span class="icon iconfont icon-creative"></span>å¼€å‘ - è§„èŒƒ/é£æ ¼<!----></a></li><li class="dropdown-item"><a href="/develop/test/ut-overview" class="nav-link" aria-label="æµ‹è¯•"><span class="icon iconfont icon-creative"></span>æµ‹è¯•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è½¯ä»¶|éƒ¨ç½²"><span class="title"><span class="icon iconfont icon-creative"></span>è½¯ä»¶|éƒ¨ç½²</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/deploy/docker/docker-basic-overview.html" class="nav-link" aria-label="Docker"><span class="icon iconfont icon-creative"></span>Docker<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æ¶ˆæ¯é˜Ÿåˆ—</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/mq/mq-a-overview.html" class="nav-link" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!---->æ¶ˆæ¯é˜Ÿåˆ—<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-rabbitmq/rabbitmq-x-overview.html" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-kafka/kafka-x-overview.html" class="nav-link" aria-label="Kafka"><!---->Kafka<!----></a></li></ul></li><li class="dropdown-item"><a href="/deploy/skywalking/skywalking-x-principle.html" class="nav-link" aria-label="Skywalking"><span class="icon iconfont icon-creative"></span>Skywalking<!----></a></li><li class="dropdown-item"><a href="/deploy/linux/linux-j-monitor-overview.html" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-creative"></span>Linux<!----></a></li><li class="dropdown-item"><a href="/deploy/jenkins/jenkins-overview.html" class="nav-link" aria-label="Jenkins"><span class="icon iconfont icon-creative"></span>Jenkins<!----></a></li><li class="dropdown-item"><a href="/deploy/nginx/nginx-x-overview.html" class="nav-link" aria-label="Nginx"><span class="icon iconfont icon-creative"></span>Nginx<!----></a></li><li class="dropdown-item"><a href="/deploy/deploy/docker-basic-overview" class="nav-link" aria-label="éƒ¨ç½²"><span class="icon iconfont icon-creative"></span>éƒ¨ç½²<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶æ„|ç³»ç»Ÿ"><span class="title"><span class="icon iconfont icon-creative"></span>æ¶æ„|ç³»ç»Ÿ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/arch/base/arch-basic.html" class="nav-link" aria-label="æ¶æ„åŸºç¡€"><span class="icon iconfont icon-creative"></span>æ¶æ„åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/arch/distributed/arch-id.html" class="nav-link" aria-label="åˆ†å¸ƒå¼ç³»ç»Ÿ"><span class="icon iconfont icon-creative"></span>åˆ†å¸ƒå¼ç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/arch/microservices/ms-overview.html" class="nav-link" aria-label="å¾®æœåŠ¡"><span class="icon iconfont icon-creative"></span>å¾®æœåŠ¡<!----></a></li><li class="dropdown-item"><a href="/arch/minio/minio-concept.html" class="nav-link" aria-label="å¯¹è±¡å­˜å‚¨-Minio"><span class="icon iconfont icon-creative"></span>å¯¹è±¡å­˜å‚¨-Minio<!----></a></li><li class="dropdown-item"><a href="/arch/manage-system/manage-system-technical-selection.html" class="nav-link" aria-label="åå°ç®¡ç†ç³»ç»Ÿ"><span class="icon iconfont icon-creative"></span>åå°ç®¡ç†ç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/arch/mall/mall-sku.html" class="nav-link" aria-label="å•†åŸè®¾è®¡"><span class="icon iconfont icon-creative"></span>å•†åŸè®¾è®¡<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è¯­è¨€|å¹³å°"><span class="title"><span class="icon iconfont icon-creative"></span>è¯­è¨€|å¹³å°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/language/frontend-layout/flex-layout-overview.html" class="nav-link" aria-label="å‰ç«¯"><span class="icon iconfont icon-creative"></span>å‰ç«¯<!----></a></li><li class="dropdown-item"><a href="/language/python/python-advantage.html" class="nav-link" aria-label="python"><span class="icon iconfont icon-creative"></span>python<!----></a></li><li class="dropdown-item"><a href="/language/weixin/wx-package-Optimization.html" class="nav-link" aria-label="å¾®ä¿¡"><span class="icon iconfont icon-creative"></span>å¾®ä¿¡<!----></a></li><li class="dropdown-item"><a href="/language/ai/knowledge-graph-build.html" class="nav-link" aria-label="AIäººå·¥æ™ºèƒ½"><span class="icon iconfont icon-creative"></span>AIäººå·¥æ™ºèƒ½<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ‚é¡¹|æ€è€ƒ"><span class="title"><span class="icon iconfont icon-creative"></span>æ‚é¡¹|æ€è€ƒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/think/deepImpression/redis-bigdata-slow-problem.html" class="nav-link" aria-label="å°è±¡æ·±åˆ»bug"><span class="icon iconfont icon-creative"></span>å°è±¡æ·±åˆ»bug<!----></a></li><li class="dropdown-item"><a href="/think/optimization/optimization-x-frequent-operation-db.html" class="nav-link" aria-label="ä¼˜åŒ–"><span class="icon iconfont icon-creative"></span>ä¼˜åŒ–<!----></a></li><li class="dropdown-item"><a href="/think/misc/misc-x-middleware.html" class="nav-link" aria-label="æ‚é¡¹"><span class="icon iconfont icon-creative"></span>æ‚é¡¹<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/zszdevelop/java-study-gitbook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">SQLåŸºç¡€</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Mysql</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Oracle</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">è¾¾æ¢¦</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Redis</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/db/redis/db-redis-introduce.html" class="nav-link sidebar-link sidebar-page" aria-label="Rediså…¥é—¨ - Redisæ¦‚å¿µå’ŒåŸºç¡€"><!---->Rediså…¥é—¨ - Redisæ¦‚å¿µå’ŒåŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-data-types.html" class="nav-link sidebar-link sidebar-page" aria-label="Rediså…¥é—¨ - æ•°æ®ç±»å‹ï¼š5ç§åŸºç¡€æ•°æ®ç±»å‹è¯¦è§£"><!---->Rediså…¥é—¨ - æ•°æ®ç±»å‹ï¼š5ç§åŸºç¡€æ•°æ®ç±»å‹è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-data-type-special.html" class="nav-link sidebar-link sidebar-page" aria-label="Rediså…¥é—¨ - 3ç§ç‰¹æ®Šç±»å‹è¯¦è§£"><!---->Rediså…¥é—¨ - 3ç§ç‰¹æ®Šç±»å‹è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-data-type-stream.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šStreamè¯¦è§£"><!---->Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šStreamè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-redis-object.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šå¯¹è±¡æœºåˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šå¯¹è±¡æœºåˆ¶è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-rdb-aof.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - æŒä¹…åŒ–ï¼šRDBå’ŒAOFæœºåˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - æŒä¹…åŒ–ï¼šRDBå’ŒAOFæœºåˆ¶è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-pub-sub.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - æ¶ˆæ¯ä¼ é€’ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼è¯¦è§£"><!---->Redisè¿›é˜¶ - æ¶ˆæ¯ä¼ é€’ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-event.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - äº‹ä»¶ï¼šRedisäº‹ä»¶æœºåˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - äº‹ä»¶ï¼šRedisäº‹ä»¶æœºåˆ¶è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-trans.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - äº‹åŠ¡ï¼šRedisäº‹åŠ¡è¯¦è§£"><!---->Redisè¿›é˜¶ - äº‹åŠ¡ï¼šRedisäº‹åŠ¡è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-copy.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-y-install-sentinel.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£"><!---->Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/db/redis/db-redis-x-cluster.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£"><!---->Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-redis-é›†ç¾¤çš„è®¾è®¡ç›®æ ‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. Redis é›†ç¾¤çš„è®¾è®¡ç›®æ ‡"><!---->1. Redis é›†ç¾¤çš„è®¾è®¡ç›®æ ‡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-1-redis-é›†ç¾¤è®¾è®¡ç›®æ ‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1 Redis é›†ç¾¤è®¾è®¡ç›®æ ‡"><!---->1.1 Redis é›†ç¾¤è®¾è®¡ç›®æ ‡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-2-redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2 Redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²"><!---->1.2 Redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-3-å†™å®‰å…¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3 å†™å®‰å…¨"><!---->1.3 å†™å®‰å…¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-4-å¯ç”¨æ€§-availability" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.4 å¯ç”¨æ€§(Availability)"><!---->1.4 å¯ç”¨æ€§(Availability)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-5-æ€§èƒ½-performance" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5 æ€§èƒ½(Performance)"><!---->1.5 æ€§èƒ½(Performance)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-6-é¿å…åˆå¹¶-merge-æ“ä½œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.6 é¿å…åˆå¹¶(merge)æ“ä½œ"><!---->1.6 é¿å…åˆå¹¶(merge)æ“ä½œ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-ä¸»è¦æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. ä¸»è¦æ¨¡å—ä»‹ç»"><!---->2. ä¸»è¦æ¨¡å—ä»‹ç»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-1-å“ˆå¸Œæ§½-hash-slot" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 å“ˆå¸Œæ§½(Hash Slot)"><!---->2.1 å“ˆå¸Œæ§½(Hash Slot)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-2-keys-hash-tags" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2 Keys hash tags"><!---->2.2 Keys hash tags<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-3-cluster-nodeså±æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 Cluster nodeså±æ€§"><!---->2.3 Cluster nodeså±æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-4-clusteræ€»çº¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4 Clusteræ€»çº¿"><!---->2.4 Clusteræ€»çº¿<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-5-é›†ç¾¤æ‹“æ‰‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.5 é›†ç¾¤æ‹“æ‰‘"><!---->2.5 é›†ç¾¤æ‹“æ‰‘<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-6-èŠ‚ç‚¹æ¡æ‰‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.6 èŠ‚ç‚¹æ¡æ‰‹"><!---->2.6 èŠ‚ç‚¹æ¡æ‰‹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-è¯·æ±‚é‡å®šå‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. è¯·æ±‚é‡å®šå‘"><!---->3. è¯·æ±‚é‡å®šå‘<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-1-moved-é‡å®šå‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 Moved é‡å®šå‘"><!---->3.1 Moved é‡å®šå‘<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-2-ask-é‡å®šå‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 ASK é‡å®šå‘"><!---->3.2 ASK é‡å®šå‘<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-3-smartå®¢æˆ·ç«¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 smartå®¢æˆ·ç«¯"><!---->3.3 smartå®¢æˆ·ç«¯<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_4-çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤"><!---->4. çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_4-1-gossipåè®®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1 Gossipåè®®"><!---->4.1 Gossipåè®®<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_4-2-é€šè®¯çŠ¶æ€å’Œç»´æŠ¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2 é€šè®¯çŠ¶æ€å’Œç»´æŠ¤"><!---->4.2 é€šè®¯çŠ¶æ€å’Œç»´æŠ¤<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_5-æ•…éšœæ¢å¤-failover" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. æ•…éšœæ¢å¤ï¼ˆFailoverï¼‰"><!---->5. æ•…éšœæ¢å¤ï¼ˆFailoverï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_6-æ‰©å®¹-ç¼©å®¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6. æ‰©å®¹&amp;ç¼©å®¹"><!---->6. æ‰©å®¹&amp;ç¼©å®¹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_6-1-æ‰©å®¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1 æ‰©å®¹"><!---->6.1 æ‰©å®¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_6-2-ç¼©å®¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2 ç¼©å®¹"><!---->6.2 ç¼©å®¹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_7-æ›´æ·±å…¥ç†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7. æ›´æ·±å…¥ç†è§£"><!---->7. æ›´æ·±å…¥ç†è§£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_7-1-ä¸ºä»€ä¹ˆredis-clusterçš„hash-slot-æ˜¯16384" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.1 ä¸ºä»€ä¹ˆRedis Clusterçš„Hash Slot æ˜¯16384ï¼Ÿ"><!---->7.1 ä¸ºä»€ä¹ˆRedis Clusterçš„Hash Slot æ˜¯16384ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_7-2-ä¸ºä»€ä¹ˆredis-clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.2 ä¸ºä»€ä¹ˆRedis Clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢ï¼Ÿ"><!---->7.2 ä¸ºä»€ä¹ˆRedis Clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-å…¶å®ƒå¸¸è§æ–¹æ¡ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8. å…¶å®ƒå¸¸è§æ–¹æ¡ˆ"><!---->8. å…¶å®ƒå¸¸è§æ–¹æ¡ˆ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-1-redis-sentinel-é›†ç¾¤-keepalived-haproxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.1 Redis Sentinel é›†ç¾¤ + Keepalived/Haproxy"><!---->8.1 Redis Sentinel é›†ç¾¤ + Keepalived/Haproxy<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-2-twemproxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.2 Twemproxy"><!---->8.2 Twemproxy<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-3-codis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.3 Codis"><!---->8.3 Codis<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#å‚è€ƒæ–‡ç« " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‚è€ƒæ–‡ç« "><!---->å‚è€ƒæ–‡ç« <!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-consistency.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - å¦‚ä½•ä¿éšœMySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"><!---->Redisè¿›é˜¶ - å¦‚ä½•ä¿éšœMySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-cache.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶  -  Redisç¼“å­˜é—®é¢˜ï¼šä¸€è‡´æ€§, ç©¿å‡», ç©¿é€, é›ªå´©, æ±¡æŸ“ç­‰"><!---->Redisè¿›é˜¶  -  Redisç¼“å­˜é—®é¢˜ï¼šä¸€è‡´æ€§, ç©¿å‡», ç©¿é€, é›ªå´©, æ±¡æŸ“ç­‰<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-hot-key.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - Redisçƒ­keyé—®é¢˜"><!---->Redisè¿›é˜¶ - Redisçƒ­keyé—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-x-performance.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisè¿›é˜¶ - æ€§èƒ½è°ƒä¼˜ï¼šRedisæ€§èƒ½è°ƒä¼˜è¯¦è§£"><!---->Redisè¿›é˜¶ - æ€§èƒ½è°ƒä¼˜ï¼šRedisæ€§èƒ½è°ƒä¼˜è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“"><!---->Redisé¢è¯• - redisé—®é¢˜æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-overview-detail.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)"><!---->Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-basic.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - å¸¸è§„é—®é¢˜"><!---->Redisé¢è¯• - å¸¸è§„é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-datatype.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„"><!---->Redisé¢è¯• - æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-persistence.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - æŒä¹…åŒ–å’Œå†…å­˜"><!---->Redisé¢è¯• - æŒä¹…åŒ–å’Œå†…å­˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-tran.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - äº‹åŠ¡"><!---->Redisé¢è¯• - äº‹åŠ¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-master-salve.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - é›†ç¾¤-ä¸»ä»å¤åˆ¶"><!---->Redisé¢è¯• - é›†ç¾¤-ä¸»ä»å¤åˆ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-sentinel.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - é›†ç¾¤-å“¨å…µæœºåˆ¶"><!---->Redisé¢è¯• - é›†ç¾¤-å“¨å…µæœºåˆ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-apply.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - åº”ç”¨åœºæ™¯"><!---->Redisé¢è¯• - åº”ç”¨åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-cluster.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯"><!---->Redisé¢è¯• - é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-new.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯• - æ–°ç‰ˆæœ¬"><!---->Redisé¢è¯• - æ–°ç‰ˆæœ¬<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-z-interview-other.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé¢è¯•  -  å…¶ä»–ç‰¹æ€§"><!---->Redisé¢è¯•  -  å…¶ä»–ç‰¹æ€§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-x-question-double-write.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§"><!---->Redisä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-y-install.html" class="nav-link sidebar-link sidebar-page" aria-label="Rediså®‰è£…"><!---->Rediså®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-y-action-bloom.html" class="nav-link sidebar-link sidebar-page" aria-label="Rediså¸ƒéš†è¿‡æ»¤å™¨"><!---->Rediså¸ƒéš†è¿‡æ»¤å™¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-x-cache-penetration.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisç¼“å­˜ç©¿é€"><!---->Redisç¼“å­˜ç©¿é€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-x-question-ache-valanche.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisç¼“å­˜é›ªå´©"><!---->Redisç¼“å­˜é›ªå´©<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-x-questuin-cache-warm-up.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisç¼“å­˜é¢„çƒ­"><!---->Redisç¼“å­˜é¢„çƒ­<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-y-action-client.html" class="nav-link sidebar-link sidebar-page" aria-label="redisè¿æ¥å®¢æˆ·ç«¯é€‰æ‹©ï¼šJedis,Redisson,Lettuce"><!---->redisè¿æ¥å®¢æˆ·ç«¯é€‰æ‹©ï¼šJedis,Redisson,Lettuce<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-hash.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé›†ç¾¤ï¼šhashå¯»å€ç®—æ³•"><!---->Redisé›†ç¾¤ï¼šhashå¯»å€ç®—æ³•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-x-sentinel-install.html" class="nav-link sidebar-link sidebar-page" aria-label="Redisé›†ç¾¤æ­å»ºè¯¦è§£"><!---->Redisé›†ç¾¤æ­å»ºè¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-y-action-springboot.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Booté›†æˆredisä½¿ç”¨"><!---->Spring Booté›†æˆredisä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-y-action.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringBooté›†æˆredisé¡¹ç›®èŒƒä¾‹"><!---->SpringBooté›†æˆredisé¡¹ç›®èŒƒä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-x-quest-key.html" class="nav-link sidebar-link sidebar-page" aria-label="å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜"><!---->å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/db-redis-y-install-remote.html" class="nav-link sidebar-link sidebar-page" aria-label="å¼€å¯è¿œç¨‹è®¿é—®"><!---->å¼€å¯è¿œç¨‹è®¿é—®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/redis/redis-y-action-gen-test-data.html" class="nav-link sidebar-link sidebar-page" aria-label="æ‰¹é‡ç”Ÿæˆredisæµ‹è¯•æ•°æ®æ–¹æ³•"><!---->æ‰¹é‡ç”Ÿæˆredisæµ‹è¯•æ•°æ®æ–¹æ³•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">MongoDB</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ElasticSearch</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">æœç´¢å¼•æ“-Solr</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://java.isture.com" target="_blank" rel="noopener noreferrer">zszdevelop</a></span><span property="author" content="zszdevelop"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-20T13:42:31.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="category-item category6" role>æ•°æ®åº“</span><span class="category-item category3" role>Redis</span><meta property="articleSection" content="æ•°æ®åº“,Redis"></span><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 34 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT34M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-redis-é›†ç¾¤çš„è®¾è®¡ç›®æ ‡" class="router-link-active router-link-exact-active toc-link level2">1. Redis é›†ç¾¤çš„è®¾è®¡ç›®æ ‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-1-redis-é›†ç¾¤è®¾è®¡ç›®æ ‡" class="router-link-active router-link-exact-active toc-link level3">1.1 Redis é›†ç¾¤è®¾è®¡ç›®æ ‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-2-redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²" class="router-link-active router-link-exact-active toc-link level3">1.2 Redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-3-å†™å®‰å…¨" class="router-link-active router-link-exact-active toc-link level3">1.3 å†™å®‰å…¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-4-å¯ç”¨æ€§-availability" class="router-link-active router-link-exact-active toc-link level3">1.4 å¯ç”¨æ€§(Availability)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-5-æ€§èƒ½-performance" class="router-link-active router-link-exact-active toc-link level3">1.5 æ€§èƒ½(Performance)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_1-6-é¿å…åˆå¹¶-merge-æ“ä½œ" class="router-link-active router-link-exact-active toc-link level3">1.6 é¿å…åˆå¹¶(merge)æ“ä½œ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-ä¸»è¦æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">2. ä¸»è¦æ¨¡å—ä»‹ç»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-1-å“ˆå¸Œæ§½-hash-slot" class="router-link-active router-link-exact-active toc-link level3">2.1 å“ˆå¸Œæ§½(Hash Slot)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-2-keys-hash-tags" class="router-link-active router-link-exact-active toc-link level3">2.2 Keys hash tags</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-3-cluster-nodeså±æ€§" class="router-link-active router-link-exact-active toc-link level3">2.3 Cluster nodeså±æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-4-clusteræ€»çº¿" class="router-link-active router-link-exact-active toc-link level3">2.4 Clusteræ€»çº¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-5-é›†ç¾¤æ‹“æ‰‘" class="router-link-active router-link-exact-active toc-link level3">2.5 é›†ç¾¤æ‹“æ‰‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_2-6-èŠ‚ç‚¹æ¡æ‰‹" class="router-link-active router-link-exact-active toc-link level3">2.6 èŠ‚ç‚¹æ¡æ‰‹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-è¯·æ±‚é‡å®šå‘" class="router-link-active router-link-exact-active toc-link level2">3. è¯·æ±‚é‡å®šå‘</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-1-moved-é‡å®šå‘" class="router-link-active router-link-exact-active toc-link level3">3.1 Moved é‡å®šå‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-2-ask-é‡å®šå‘" class="router-link-active router-link-exact-active toc-link level3">3.2 ASK é‡å®šå‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_3-3-smartå®¢æˆ·ç«¯" class="router-link-active router-link-exact-active toc-link level3">3.3 smartå®¢æˆ·ç«¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_4-çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤" class="router-link-active router-link-exact-active toc-link level2">4. çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_4-1-gossipåè®®" class="router-link-active router-link-exact-active toc-link level3">4.1 Gossipåè®®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_4-2-é€šè®¯çŠ¶æ€å’Œç»´æŠ¤" class="router-link-active router-link-exact-active toc-link level3">4.2 é€šè®¯çŠ¶æ€å’Œç»´æŠ¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_5-æ•…éšœæ¢å¤-failover" class="router-link-active router-link-exact-active toc-link level2">5. æ•…éšœæ¢å¤ï¼ˆFailoverï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_6-æ‰©å®¹-ç¼©å®¹" class="router-link-active router-link-exact-active toc-link level2">6. æ‰©å®¹&amp;ç¼©å®¹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_6-1-æ‰©å®¹" class="router-link-active router-link-exact-active toc-link level3">6.1 æ‰©å®¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_6-2-ç¼©å®¹" class="router-link-active router-link-exact-active toc-link level3">6.2 ç¼©å®¹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_7-æ›´æ·±å…¥ç†è§£" class="router-link-active router-link-exact-active toc-link level2">7. æ›´æ·±å…¥ç†è§£</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_7-1-ä¸ºä»€ä¹ˆredis-clusterçš„hash-slot-æ˜¯16384" class="router-link-active router-link-exact-active toc-link level3">7.1 ä¸ºä»€ä¹ˆRedis Clusterçš„Hash Slot æ˜¯16384ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_7-2-ä¸ºä»€ä¹ˆredis-clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢" class="router-link-active router-link-exact-active toc-link level3">7.2 ä¸ºä»€ä¹ˆRedis Clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-å…¶å®ƒå¸¸è§æ–¹æ¡ˆ" class="router-link-active router-link-exact-active toc-link level2">8. å…¶å®ƒå¸¸è§æ–¹æ¡ˆ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-1-redis-sentinel-é›†ç¾¤-keepalived-haproxy" class="router-link-active router-link-exact-active toc-link level3">8.1 Redis Sentinel é›†ç¾¤ + Keepalived/Haproxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-2-twemproxy" class="router-link-active router-link-exact-active toc-link level3">8.2 Twemproxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#_8-3-codis" class="router-link-active router-link-exact-active toc-link level3">8.3 Codis</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/redis/db-redis-x-cluster.html#å‚è€ƒæ–‡ç« " class="router-link-active router-link-exact-active toc-link level2">å‚è€ƒæ–‡ç« </a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="redisè¿›é˜¶-é«˜å¯æ‹“å±•-åˆ†ç‰‡æŠ€æœ¯-redis-cluster-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#redisè¿›é˜¶-é«˜å¯æ‹“å±•-åˆ†ç‰‡æŠ€æœ¯-redis-cluster-è¯¦è§£" aria-hidden="true">#</a> Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£</h1><blockquote><p>å‰é¢ä¸¤ç¯‡æ–‡ç« ï¼Œ<a href="">ä¸»ä»å¤åˆ¶</a>å’Œ<a href="">å“¨å…µæœºåˆ¶</a>ä¿éšœäº†é«˜å¯ç”¨ï¼Œå°±è¯»å†™åˆ†ç¦»è€Œè¨€è™½ç„¶slaveèŠ‚ç‚¹æ‰©å±•äº†ä¸»ä»çš„è¯»å¹¶å‘èƒ½åŠ›ï¼Œä½†æ˜¯<strong>å†™èƒ½åŠ›</strong>å’Œ<strong>å­˜å‚¨èƒ½åŠ›</strong>æ˜¯æ— æ³•è¿›è¡Œæ‰©å±•ï¼Œå°±åªèƒ½æ˜¯masterèŠ‚ç‚¹èƒ½å¤Ÿæ‰¿è½½çš„ä¸Šé™ã€‚å¦‚æœé¢å¯¹æµ·é‡æ•°æ®é‚£ä¹ˆå¿…ç„¶éœ€è¦æ„å»ºmasterï¼ˆä¸»èŠ‚ç‚¹åˆ†ç‰‡)ä¹‹é—´çš„é›†ç¾¤ï¼ŒåŒæ—¶å¿…ç„¶éœ€è¦å¸æ”¶é«˜å¯ç”¨ï¼ˆä¸»ä»å¤åˆ¶å’Œå“¨å…µæœºåˆ¶ï¼‰èƒ½åŠ›ï¼Œå³æ¯ä¸ªmasteråˆ†ç‰‡èŠ‚ç‚¹è¿˜éœ€è¦æœ‰slaveèŠ‚ç‚¹ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å…¸å‹çš„çºµå‘æ‰©å±•ï¼ˆé›†ç¾¤çš„åˆ†ç‰‡æŠ€æœ¯ï¼‰çš„ä½“ç°ï¼›æ‰€ä»¥åœ¨Redis 3.0ç‰ˆæœ¬ä¸­å¯¹åº”çš„è®¾è®¡å°±æ˜¯Redis Clusterã€‚</p></blockquote><h2 id="_1-redis-é›†ç¾¤çš„è®¾è®¡ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_1-redis-é›†ç¾¤çš„è®¾è®¡ç›®æ ‡" aria-hidden="true">#</a> 1. Redis é›†ç¾¤çš„è®¾è®¡ç›®æ ‡</h2><blockquote><p>Redis-clusteræ˜¯ä¸€ç§æœåŠ¡å™¨ShardingæŠ€æœ¯ï¼ŒRedis3.0ä»¥åç‰ˆæœ¬æ­£å¼æä¾›æ”¯æŒã€‚Redis Clusteråœ¨è®¾è®¡æ—¶è€ƒè™‘äº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä¸å¦¨çœ‹ä¸‹å®˜ç½‘çš„ä»‹ç» <a href="https://redis.io/topics/cluster-spec#redis-cluster-goals" target="_blank" rel="noopener noreferrer">Redis Cluster Specification<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="_1-1-redis-é›†ç¾¤è®¾è®¡ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_1-1-redis-é›†ç¾¤è®¾è®¡ç›®æ ‡" aria-hidden="true">#</a> 1.1 Redis é›†ç¾¤è®¾è®¡ç›®æ ‡</h3><p>é«˜æ€§èƒ½å¯çº¿æ€§æ‰©å±•è‡³æœ€å¤š1000èŠ‚ç‚¹ã€‚é›†ç¾¤ä¸­æ²¡æœ‰ä»£ç†ï¼Œï¼ˆé›†ç¾¤èŠ‚ç‚¹é—´ï¼‰ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œæ²¡æœ‰å½’å¹¶æ“ä½œ(merge operations on values)</p><p><strong>å¯æ¥å—çš„å†™å…¥å®‰å…¨</strong>:ç³»ç»Ÿå°è¯•(é‡‡ç”¨best-effortæ–¹å¼)ä¿ç•™æ‰€æœ‰è¿æ¥åˆ°masterèŠ‚ç‚¹çš„clientå‘èµ·çš„å†™æ“ä½œã€‚é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå°çš„æ—¶é—´çª—ï¼Œæ—¶é—´çª—å†…çš„å·²ç¡®è®¤å†™æ“ä½œå¯èƒ½ä¸¢å¤±(å³ï¼Œåœ¨å‘ç”Ÿfailoverä¹‹å‰çš„å°æ®µæ—¶é—´çª—å†…çš„å†™æ“ä½œå¯èƒ½åœ¨failoverä¸­ä¸¢å¤±)ã€‚è€Œåœ¨(ç½‘ç»œ)åˆ†åŒºæ•…éšœä¸‹ï¼Œå¯¹å°‘æ•°æ´¾masterçš„å†™å…¥ï¼Œå‘ç”Ÿå†™ä¸¢å¤±çš„æ—¶é—´çª—ä¼šå¾ˆå¤§ã€‚</p><p><strong>å¯ç”¨æ€§</strong>ï¼šRedis Clusteråœ¨ä»¥ä¸‹åœºæ™¯ä¸‹é›†ç¾¤æ€»æ˜¯å¯ç”¨ï¼šå¤§éƒ¨åˆ†masterèŠ‚ç‚¹å¯ç”¨ï¼Œå¹¶ä¸”å¯¹å°‘éƒ¨åˆ†ä¸å¯ç”¨çš„masterï¼Œæ¯ä¸€ä¸ªmasterè‡³å°‘æœ‰ä¸€ä¸ªå½“å‰å¯ç”¨çš„slaveã€‚æ›´è¿›ä¸€æ­¥ï¼Œé€šè¿‡ä½¿ç”¨ replicas migration æŠ€æœ¯ï¼Œå½“å‰æ²¡æœ‰slaveçš„masterä¼šä»å½“å‰æ‹¥æœ‰å¤šä¸ªslaveçš„masteræ¥å—åˆ°ä¸€ä¸ªæ–°slaveæ¥ç¡®ä¿å¯ç”¨æ€§ã€‚</p><h3 id="_1-2-redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²" tabindex="-1"><a class="header-anchor" href="#_1-2-redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²" aria-hidden="true">#</a> 1.2 Redisé›†ç¾¤åè®®ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²</h3><p>Redis Clusterçš„èŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤æ•°æ®ï¼Œå’Œè·å–é›†ç¾¤çŠ¶æ€ï¼Œè¿™åŒ…æ‹¬å°†keysæ˜ å°„åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ã€‚é›†ç¾¤èŠ‚ç‚¹åŒæ ·å¯ä»¥è‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹ã€æ£€æµ‹ä¸å·¥ä½œèŠ‚ç‚¹ã€ä»¥åŠåœ¨å‘ç°æ•…éšœå‘ç”Ÿæ—¶æ™‹å‡slaveèŠ‚ç‚¹åˆ°master</p><p>æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹é€šè¿‡ç”±TCPå’ŒäºŒè¿›åˆ¶åè®®ç»„æˆçš„ç§°ä¸º Redis Cluster Bus çš„æ–¹å¼æ¥å®ç°é›†ç¾¤çš„èŠ‚ç‚¹è‡ªåŠ¨å‘ç°ã€æ•…éšœèŠ‚ç‚¹æ¢æµ‹ã€slaveå‡çº§ä¸ºmasterç­‰ä»»åŠ¡ã€‚æ¯ä¸ªèŠ‚ç‚¹é€šè¿‡cluster busè¿æ¥æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ã€‚èŠ‚ç‚¹é—´ä½¿ç”¨<strong>gossipåè®®</strong>è¿›è¡Œé›†ç¾¤ä¿¡æ¯ä¼ æ’­ï¼Œä»¥æ­¤æ¥å®ç°æ–°èŠ‚ç‚¹å‘ç°ï¼Œå‘é€pingåŒ…ä»¥ç¡®è®¤å¯¹ç«¯å·¥ä½œæ­£å¸¸ï¼Œä»¥åŠå‘é€clusteræ¶ˆæ¯ç”¨æ¥æ ‡è®°ç‰¹å®šçŠ¶æ€ã€‚cluster busè¿˜è¢«ç”¨æ¥åœ¨é›†ç¾¤ä¸­åˆ›å»ºPub/Subæ¶ˆæ¯ï¼Œä»¥åŠåœ¨æ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚åç¼–æ’æ‰‹åŠ¨failoverã€‚</p><h3 id="_1-3-å†™å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#_1-3-å†™å®‰å…¨" aria-hidden="true">#</a> 1.3 å†™å®‰å…¨</h3><p>Redis Clusteråœ¨èŠ‚ç‚¹é—´é‡‡ç”¨äº†å¼‚æ­¥å¤åˆ¶ï¼Œä»¥åŠ last failover wins éšå«åˆå¹¶åŠŸèƒ½(implicit merge function)ï¼ˆã€è¯‘æ³¨ã€‘ä¸å­˜åœ¨åˆå¹¶åŠŸèƒ½ï¼Œè€Œæ˜¯æ€»æ˜¯è®¤ä¸ºæœ€è¿‘ä¸€æ¬¡failoverçš„èŠ‚ç‚¹æ˜¯æœ€æ–°çš„ï¼‰ã€‚è¿™æ„å‘³ç€æœ€åè¢«é€‰ä¸¾å‡ºçš„masteræ‰€åŒ…å«çš„æ•°æ®æœ€ç»ˆä¼šæ›¿ä»£ï¼ˆåŒä¸€å‰masterä¸‹ï¼‰æ‰€æœ‰å…¶ä»–å¤‡ä»½(replicas/slaves)èŠ‚ç‚¹ï¼ˆåŒ…å«çš„æ•°æ®ï¼‰ã€‚å½“å‘ç”Ÿåˆ†åŒºé—®é¢˜æ—¶ï¼Œæ€»æ˜¯ä¼šæœ‰ä¸€ä¸ªæ—¶é—´çª—å†…ä¼šå‘ç”Ÿå†™å…¥ä¸¢å¤±ã€‚ç„¶è€Œï¼Œå¯¹è¿æ¥åˆ°å¤šæ•°æ´¾masterï¼ˆmajority of mastersï¼‰çš„clientï¼Œä»¥åŠè¿æ¥åˆ°å°‘æ•°æ´¾masterï¼ˆmimority of mastersï¼‰çš„clientï¼Œè¿™ä¸ªæ—¶é—´çª—æ˜¯ä¸åŒçš„ã€‚</p><p>ç›¸æ¯”è¾ƒè¿æ¥åˆ°å°‘æ•°master(minority of masters)çš„clientï¼Œå¯¹è¿æ¥åˆ°å¤šæ•°master(majority of masters)çš„clientå‘èµ·çš„å†™å…¥ï¼ŒRedis clusterä¼šæ›´åŠªåŠ›åœ°å°è¯•å°†å…¶ä¿å­˜ã€‚ ä¸‹é¢çš„åœºæ™¯å°†ä¼šå¯¼è‡´åœ¨ä¸»åˆ†åŒºçš„masterä¸Šï¼Œå·²ç»ç¡®è®¤çš„å†™å…¥åœ¨æ•…éšœæœŸé—´å‘ç”Ÿä¸¢å¤±ï¼š</p><p>å†™å…¥è¯·æ±‚è¾¾åˆ°masterï¼Œä½†æ˜¯å½“masteræ‰§è¡Œå®Œå¹¶å›å¤clientæ—¶ï¼Œå†™æ“ä½œå¯èƒ½è¿˜æ²¡æœ‰é€šè¿‡å¼‚æ­¥å¤åˆ¶ä¼ æ’­åˆ°å®ƒçš„slaveã€‚å¦‚æœmasteråœ¨å†™æ“ä½œæŠµè¾¾slaveä¹‹å‰æŒ‚äº†ï¼Œå¹¶ä¸”masteræ— æ³•è§¦è¾¾(unreachable)çš„æ—¶é—´è¶³å¤Ÿé•¿è€Œå¯¼è‡´äº†slaveèŠ‚ç‚¹æ™‹å‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå†™æ“ä½œå°±æ°¸è¿œåœ°ä¸¢å¤±äº†ã€‚é€šå¸¸å¾ˆéš¾ç›´æ¥è§‚å¯Ÿåˆ°ï¼Œå› ä¸ºmasterå°è¯•å›å¤client(å†™å…¥ç¡®è®¤)å’Œä¼ æ’­å†™æ“ä½œåˆ°slaveé€šå¸¸å‡ ä¹æ˜¯åŒæ—¶å‘ç”Ÿã€‚ç„¶è€Œï¼Œè¿™å´æ˜¯çœŸå®ä¸–ç•Œä¸­çš„æ•…éšœæ–¹å¼ã€‚ï¼ˆã€è¯‘æ³¨ã€‘ä¸è€ƒè™‘è¿”å›åå®•æœºçš„åœºæ™¯ï¼Œå› ä¸ºå®•æœºå¯¼è‡´çš„å†™å…¥ä¸¢å¤±ï¼Œåœ¨å•æœºç‰ˆredisä¸ŠåŒæ ·å­˜åœ¨ï¼Œè¿™ä¸æ˜¯redis clusterå¼•å…¥çš„ç›®çš„åŠè¦è§£å†³çš„é—®é¢˜ï¼‰</p><p>å¦ä¸€ç§ç†è®ºä¸Šå¯èƒ½å‘ç”Ÿå†™å…¥ä¸¢å¤±çš„æ¨¡å¼æ˜¯ï¼š</p><ul><li>masterå› ä¸ºåˆ†åŒºåŸå› ä¸å¯ç”¨ï¼ˆunreachableï¼‰</li><li>è¯¥masterè¢«æŸä¸ªslaveæ›¿æ¢(failover)</li><li>ä¸€æ®µæ—¶é—´åï¼Œè¯¥masteré‡æ–°å¯ç”¨</li><li>åœ¨è¯¥old masterå˜ä¸ºslaveä¹‹å‰ï¼Œä¸€ä¸ªclienté€šè¿‡è¿‡æœŸçš„è·¯ç”±è¡¨å¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œå†™å…¥ã€‚</li></ul><p>ä¸Šè¿°ç¬¬äºŒç§å¤±è´¥åœºæ™¯é€šå¸¸éš¾ä»¥å‘ç”Ÿï¼Œå› ä¸ºï¼š</p><ul><li>å°‘æ•°æ´¾master(minority master)æ— æ³•ä¸å¤šæ•°æ´¾master(majority master)é€šä¿¡è¾¾åˆ°ä¸€å®šçš„æ—¶é—´åï¼Œå®ƒå°†æ‹’ç»å†™å…¥ï¼Œå¹¶ä¸”å½“åˆ†åŒºæ¢å¤åï¼Œè¯¥masteråœ¨é‡æ–°ä¸å¤šæ•°æ´¾masterå»ºç«‹è¿æ¥åï¼Œè¿˜å°†ä¿æŒæ‹’ç»å†™å…¥çŠ¶æ€ä¸€å°æ®µæ—¶é—´æ¥æ„ŸçŸ¥é›†ç¾¤é…ç½®å˜åŒ–ã€‚ç•™ç»™clientå¯å†™å…¥çš„æ—¶é—´çª—å¾ˆå°ã€‚</li><li>å‘ç”Ÿè¿™ç§é”™è¯¯è¿˜æœ‰ä¸€ä¸ªå‰ææ˜¯ï¼Œclientä¸€ç›´éƒ½åœ¨ä½¿ç”¨è¿‡æœŸçš„è·¯ç”±è¡¨ï¼ˆè€Œå®é™…ä¸Šé›†ç¾¤å› ä¸ºå‘ç”Ÿäº†failoverï¼Œå·²æœ‰slaveå‘ç”Ÿäº†æ™‹å‡ï¼‰ã€‚</li></ul><p>å†™å…¥å°‘æ•°æ´¾master(minority side of a partition)ä¼šæœ‰ä¸€ä¸ªæ›´é•¿çš„æ—¶é—´çª—ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å› ä¸ºå¦‚æœæœ€ç»ˆå¯¼è‡´äº†failoverï¼Œåˆ™å†™å…¥å°‘æ•°æ´¾masterçš„æ•°æ®å°†ä¼šè¢«å¤šæ•°æ´¾ä¸€ä¾§(majority side)è¦†ç›–ï¼ˆåœ¨å°‘æ•°æ´¾masterä½œä¸ºslaveé‡æ–°æ¥å…¥é›†ç¾¤åï¼‰ã€‚</p><p>ç‰¹åˆ«åœ°ï¼Œå¦‚æœè¦å‘ç”Ÿfailoverï¼Œmasterå¿…é¡»è‡³å°‘åœ¨NODE_TIMEOUTæ—¶é—´å†…æ— æ³•è¢«å¤šæ•°masters(majority of maters)è¿æ¥ï¼Œå› æ­¤å¦‚æœåˆ†åŒºåœ¨è¿™ä¸€æ—¶é—´å†…è¢«ä¿®å¤ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿå†™å…¥ä¸¢å¤±ã€‚å½“åˆ†åŒºæŒç»­æ—¶é—´è¶…è¿‡NODE_TIMEOUTæ—¶ï¼Œæ‰€æœ‰åœ¨è¿™æ®µæ—¶é—´å†…å¯¹å°‘æ•°æ´¾master(minority side)çš„å†™å…¥å°†ä¼šä¸¢å¤±ã€‚ç„¶è€Œå°‘æ•°æ´¾ä¸€ä¾§(minority side)å°†ä¼šåœ¨NODE_TIMEOUTæ—¶é—´ä¹‹åå¦‚æœè¿˜æ²¡æœ‰è¿ä¸Šå¤šæ•°æ´¾ä¸€ä¾§ï¼Œåˆ™å®ƒä¼šç«‹å³å¼€å§‹æ‹’ç»å†™å…¥ï¼Œå› æ­¤å¯¹å°‘æ•°æ´¾masterè€Œè¨€ï¼Œå­˜åœ¨ä¸€ä¸ªè¿›å…¥ä¸å¯ç”¨çŠ¶æ€çš„æœ€å¤§æ—¶é—´çª—ã€‚åœ¨è¿™ä¸€æ—¶é—´çª—ä¹‹å¤–ï¼Œä¸ä¼šå†æœ‰å†™å…¥è¢«æ¥å—æˆ–ä¸¢å¤±ã€‚</p><h3 id="_1-4-å¯ç”¨æ€§-availability" tabindex="-1"><a class="header-anchor" href="#_1-4-å¯ç”¨æ€§-availability" aria-hidden="true">#</a> 1.4 å¯ç”¨æ€§(Availability)</h3><p>Redis Clusteråœ¨å°‘æ•°æ´¾åˆ†åŒºä¾§ä¸å¯ç”¨ã€‚åœ¨å¤šæ•°æ´¾åˆ†åŒºä¾§ï¼Œå‡è®¾ç”±å¤šæ•°æ´¾masterså­˜åœ¨å¹¶ä¸”ä¸å¯è¾¾çš„masteræœ‰ä¸€ä¸ªslaveï¼Œclusterå°†ä¼šåœ¨NODE_TIMEOUTå¤–åŠ é‡æ–°é€‰ä¸¾æ‰€éœ€çš„ä¸€å°æ®µæ—¶é—´(é€šå¸¸1ï½2ç§’)åæ¢å¤å¯ç”¨ã€‚</p><p>è¿™æ„å‘³ç€ï¼ŒRedis Clusterè¢«è®¾è®¡ä¸ºå¯ä»¥å¿å—ä¸€å°éƒ¨åˆ†èŠ‚ç‚¹çš„æ•…éšœï¼Œä½†æ˜¯å¦‚æœéœ€è¦åœ¨å¤§ç½‘ç»œåˆ†è£‚(network splits)äº‹ä»¶ä¸­(ã€è¯‘æ³¨ã€‘æ¯”å¦‚å‘ç”Ÿå¤šåˆ†åŒºæ•…éšœå¯¼è‡´ç½‘ç»œè¢«åˆ†å‰²æˆå¤šå—ï¼Œä¸”ä¸å­˜åœ¨å¤šæ•°æ´¾masteråˆ†åŒº)ä¿æŒå¯ç”¨æ€§ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„æ–¹æ¡ˆ(ã€è¯‘æ³¨ã€‘æ¯”å¦‚ï¼Œä¸è¦å°è¯•åœ¨å¤šæœºæˆ¿é—´éƒ¨ç½²redis clusterï¼Œè¿™ä¸æ˜¯redis clusterè¯¥åšçš„äº‹)ã€‚</p><p>å‡è®¾ä¸€ä¸ªclusterç”±Nä¸ªmasterèŠ‚ç‚¹ç»„æˆå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹ä»…æ‹¥æœ‰ä¸€ä¸ªslaveï¼Œåœ¨å¤šæ•°ä¾§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å‡ºç°åˆ†åŒºé—®é¢˜æ—¶ï¼Œclusterçš„å¤šæ•°ä¾§(majority side)å¯ä»¥ä¿æŒå¯ç”¨ï¼Œè€Œå½“æœ‰ä¸¤ä¸ªèŠ‚ç‚¹å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œåªæœ‰ 1-(1/(N<em>2-1)) çš„å¯èƒ½æ€§ä¿æŒé›†ç¾¤å¯ç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç”±5ä¸ªmasterå’Œ5ä¸ªslaveç»„æˆçš„clusterï¼Œé‚£ä¹ˆå½“ä¸¤ä¸ªèŠ‚ç‚¹å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œå®ƒæœ‰ 1/(5</em>2-1)=11.11%çš„å¯èƒ½æ€§å‘ç”Ÿé›†ç¾¤ä¸å¯ç”¨ã€‚</p><p>Redis clusteræä¾›äº†ä¸€ç§æˆä¸º Replicas Migration çš„æœ‰ç”¨ç‰¹æ€§ï¼Œå®ƒé€šè¿‡è‡ªåŠ¨è½¬ç§»å¤‡ä»½èŠ‚ç‚¹åˆ°å­¤masterèŠ‚ç‚¹ï¼Œåœ¨çœŸå®ä¸–ç•Œçš„å¸¸è§åœºæ™¯ä¸­æå‡äº†clusterçš„å¯ç”¨æ€§ã€‚åœ¨æ¯æ¬¡æˆåŠŸçš„failoverä¹‹åï¼Œclusterä¼šè‡ªåŠ¨é‡æ–°é…ç½®slaveåˆ†å¸ƒä»¥å°½å¯èƒ½ä¿è¯åœ¨ä¸‹ä¸€æ¬¡failureä¸­æ‹¥æœ‰æ›´å¥½çš„æŠµå¾¡åŠ›</p><h3 id="_1-5-æ€§èƒ½-performance" tabindex="-1"><a class="header-anchor" href="#_1-5-æ€§èƒ½-performance" aria-hidden="true">#</a> 1.5 æ€§èƒ½(Performance)</h3><p>Redis Clusterä¸ä¼šå°†å‘½ä»¤è·¯ç”±åˆ°å…¶ä¸­çš„keyæ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œè€Œæ˜¯å‘clientå‘ä¸€ä¸ªé‡å®šå‘å‘½ä»¤ (- MOVED) å¼•å¯¼clientåˆ°æ­£ç¡®çš„èŠ‚ç‚¹ã€‚ æœ€ç»ˆclientä¼šè·å¾—ä¸€ä¸ªæœ€æ–°çš„cluster(hash slotsåˆ†å¸ƒ)å±•ç¤ºï¼Œä»¥åŠå“ªä¸ªèŠ‚ç‚¹æœåŠ¡äºå‘½ä»¤ä¸­çš„keysï¼Œå› æ­¤clientså°±å¯ä»¥è·å¾—æ­£ç¡®çš„èŠ‚ç‚¹å¹¶ç”¨æ¥ç»§ç»­æ‰§è¡Œå‘½ä»¤ã€‚</p><p>å› ä¸ºmasterå’Œslaveä¹‹é—´ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼ŒèŠ‚ç‚¹ä¸éœ€è¦ç­‰å¾…å…¶ä»–èŠ‚ç‚¹å¯¹å†™å…¥çš„ç¡®è®¤ï¼ˆé™¤éä½¿ç”¨äº†WAITå‘½ä»¤ï¼‰å°±å¯ä»¥å›å¤clientã€‚ åŒæ ·ï¼Œå› ä¸ºmulti-keyå‘½ä»¤è¢«é™åˆ¶åœ¨äº†ä¸´è¿‘çš„key(near keys)(ã€è¯‘æ³¨ã€‘å³åŒä¸€hash slotå†…çš„keyï¼Œæˆ–è€…ä»å®é™…ä½¿ç”¨åœºæ™¯æ¥è¯´ï¼Œæ›´å¤šçš„æ˜¯é€šè¿‡hash tagå®šä¹‰ä¸ºå…·å¤‡ç›¸åŒhashå­—æ®µçš„æœ‰ç›¸è¿‘ä¸šåŠ¡å«ä¹‰çš„ä¸€ç»„keys)ï¼Œæ‰€ä»¥é™¤éè§¦å‘reshardingï¼Œæ•°æ®æ°¸è¿œä¸ä¼šåœ¨èŠ‚ç‚¹é—´ç§»åŠ¨ã€‚</p><p>æ™®é€šçš„å‘½ä»¤(normal operations)ä¼šåƒåœ¨å•ä¸ªrediså®ä¾‹é‚£æ ·è¢«æ‰§è¡Œã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ‹¥æœ‰Nä¸ªmasterèŠ‚ç‚¹çš„Redis Clusterï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒæ‹¥æœ‰Nå€çš„å•ä¸ªRedisæ€§èƒ½ã€‚åŒæ—¶ï¼Œqueryé€šå¸¸éƒ½åœ¨ä¸€ä¸ªround tripä¸­æ‰§è¡Œï¼Œå› ä¸ºclienté€šå¸¸ä¼šä¿ç•™ä¸æ‰€æœ‰èŠ‚ç‚¹çš„æŒä¹…åŒ–è¿æ¥ï¼ˆè¿æ¥æ± ï¼‰ï¼Œå› æ­¤å»¶è¿Ÿä¹Ÿä¸å®¢æˆ·ç«¯æ“ä½œå•å°rediså®ä¾‹æ²¡æœ‰åŒºåˆ«ã€‚</p><p>åœ¨å¯¹æ•°æ®å®‰å…¨æ€§ã€å¯ç”¨æ€§æ–¹é¢æä¾›äº†åˆç†çš„å¼±ä¿è¯çš„å‰æä¸‹ï¼Œæä¾›æé«˜çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œè¿™æ˜¯Redis Clusterçš„ä¸»è¦ç›®æ ‡ã€‚</p><h3 id="_1-6-é¿å…åˆå¹¶-merge-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_1-6-é¿å…åˆå¹¶-merge-æ“ä½œ" aria-hidden="true">#</a> 1.6 é¿å…åˆå¹¶(merge)æ“ä½œ</h3><p>Redis Clusterè®¾è®¡ä¸Šé¿å…äº†åœ¨å¤šä¸ªæ‹¥æœ‰ç›¸åŒkey-valueå¯¹çš„èŠ‚ç‚¹ä¸Šçš„ç‰ˆæœ¬å†²çªï¼ˆåŠåˆå¹¶/mergeï¼‰ï¼Œå› ä¸ºåœ¨redisæ•°æ®æ¨¡å‹ä¸‹è¿™æ˜¯ä¸éœ€è¦çš„ã€‚Redisçš„å€¼åŒæ—¶éƒ½éå¸¸å¤§ï¼›ä¸€ä¸ªæ‹¥æœ‰æ•°ç™¾ä¸‡å…ƒç´ çš„listæˆ–sorted setæ˜¯å¾ˆå¸¸è§çš„ã€‚åŒæ ·ï¼Œæ•°æ®ç±»å‹çš„è¯­ä¹‰ä¹Ÿå¾ˆå¤æ‚ã€‚ä¼ è¾“å’Œåˆå¹¶è¿™ç±»å€¼å°†ä¼šäº§ç”Ÿæ˜æ˜¾çš„ç“¶é¢ˆï¼Œå¹¶å¯èƒ½éœ€è¦å¯¹åº”ç”¨ä¾§çš„é€»è¾‘åšæ˜æ˜¾çš„ä¿®æ”¹ï¼Œæ¯”å¦‚éœ€è¦æ›´å¤šçš„å†…å­˜æ¥ä¿å­˜meta-dataç­‰ã€‚</p><p>è¿™é‡Œ(ã€è¯‘æ³¨ã€‘åˆ»æ„é¿å…äº†merge)å¹¶æ²¡æœ‰ä¸¥æ ¼çš„æŠ€æœ¯é™åˆ¶ã€‚CRDTsæˆ–åŒæ­¥å¤åˆ¶çŠ¶æ€æœºå¯ä»¥å¡‘é€ ä¸redisç±»ä¼¼çš„å¤æ‚çš„æ•°æ®ç±»å‹ã€‚ç„¶è€Œï¼Œè¿™ç±»ç³»ç»Ÿè¿è¡Œæ—¶çš„è¡Œä¸ºä¸Redis Clusterå…¶å®æ˜¯ä¸ä¸€æ ·çš„ã€‚Redis Clusterè¢«è®¾è®¡ç”¨æ¥æ”¯æŒéé›†ç¾¤redisç‰ˆæœ¬æ— æ³•æ”¯æŒçš„ä¸€äº›é¢å¤–çš„åœºæ™¯ã€‚</p><h2 id="_2-ä¸»è¦æ¨¡å—ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_2-ä¸»è¦æ¨¡å—ä»‹ç»" aria-hidden="true">#</a> 2. ä¸»è¦æ¨¡å—ä»‹ç»</h2><blockquote><p><a href="https://redis.io/topics/cluster-spec#redis-cluster-goals" target="_blank" rel="noopener noreferrer">Redis Cluster Specification<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>åŒæ—¶è¿˜ä»‹ç»äº†Redis Clusterä¸­ä¸»è¦æ¨¡å—ï¼Œè¿™é‡Œé¢åŒ…å«äº†å¾ˆå¤šåŸºç¡€å’Œæ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸‹ã€‚</p></blockquote><h3 id="_2-1-å“ˆå¸Œæ§½-hash-slot" tabindex="-1"><a class="header-anchor" href="#_2-1-å“ˆå¸Œæ§½-hash-slot" aria-hidden="true">#</a> 2.1 å“ˆå¸Œæ§½(Hash Slot)</h3><p>Redis-clusteræ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯å¼•å…¥äº†<strong>å“ˆå¸Œæ§½</strong>çš„æ¦‚å¿µã€‚Redis-clusterä¸­æœ‰16384(å³2çš„14æ¬¡æ–¹ï¼‰ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16383å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ã€‚Clusterä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ï¼ˆhash slotï¼‰ã€‚</p><p>æ¯”å¦‚é›†ç¾¤ä¸­å­˜åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å¯èƒ½å­˜åœ¨çš„ä¸€ç§åˆ†é…å¦‚ä¸‹ï¼š</p><ul><li>èŠ‚ç‚¹AåŒ…å«0åˆ°5500å·å“ˆå¸Œæ§½ï¼›</li><li>èŠ‚ç‚¹BåŒ…å«5501åˆ°11000å·å“ˆå¸Œæ§½ï¼›</li><li>èŠ‚ç‚¹CåŒ…å«11001 åˆ° 16384å·å“ˆå¸Œæ§½ã€‚</li></ul><h3 id="_2-2-keys-hash-tags" tabindex="-1"><a class="header-anchor" href="#_2-2-keys-hash-tags" aria-hidden="true">#</a> 2.2 Keys hash tags</h3><p>Hash tagsæä¾›äº†ä¸€ç§é€”å¾„ï¼Œ<strong>ç”¨æ¥å°†å¤šä¸ª(ç›¸å…³çš„)keyåˆ†é…åˆ°ç›¸åŒçš„hash slotä¸­</strong>ã€‚è¿™æ—¶Redis Clusterä¸­å®ç°multi-keyæ“ä½œçš„åŸºç¡€ã€‚</p><p>hash tagè§„åˆ™å¦‚ä¸‹ï¼Œå¦‚æœæ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼Œ{å’Œ}ä¹‹é—´çš„å­—ç¬¦å°†ç”¨æ¥è®¡ç®—HASH_SLOTï¼Œä»¥ä¿è¯è¿™æ ·çš„keyä¿å­˜åœ¨åŒä¸€ä¸ªslotä¸­ã€‚</p><ul><li>keyåŒ…å«ä¸€ä¸ª{å­—ç¬¦</li><li>å¹¶ä¸” å¦‚æœåœ¨è¿™ä¸ª{çš„å³é¢æœ‰ä¸€ä¸ª}å­—ç¬¦</li><li>å¹¶ä¸” å¦‚æœåœ¨{å’Œ}ä¹‹é—´å­˜åœ¨è‡³å°‘ä¸€ä¸ªå­—ç¬¦</li></ul><p>ä¾‹å¦‚ï¼š</p><ul><li>{user1000}.followingå’Œ{user1000}.followersè¿™ä¸¤ä¸ªkeyä¼šè¢«hashåˆ°ç›¸åŒçš„hash slotä¸­ï¼Œå› ä¸ºåªæœ‰user1000ä¼šè¢«ç”¨æ¥è®¡ç®—hash slotå€¼ã€‚</li><li>foo{}{bar}è¿™ä¸ªkeyä¸ä¼šå¯ç”¨hash tagå› ä¸ºç¬¬ä¸€ä¸ª{å’Œ}ä¹‹é—´æ²¡æœ‰å­—ç¬¦ã€‚</li><li>foozapè¿™ä¸ªkeyä¸­çš„{baréƒ¨åˆ†ä¼šè¢«ç”¨æ¥è®¡ç®—hash slot</li><li>foo{bar}{zap}è¿™ä¸ªkeyä¸­çš„barä¼šè¢«ç”¨æ¥è®¡ç®—è®¡ç®—hash slotï¼Œè€Œzapä¸ä¼š</li></ul><h3 id="_2-3-cluster-nodeså±æ€§" tabindex="-1"><a class="header-anchor" href="#_2-3-cluster-nodeså±æ€§" aria-hidden="true">#</a> 2.3 Cluster nodeså±æ€§</h3><p>æ¯ä¸ª<strong>èŠ‚ç‚¹åœ¨clusterä¸­æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—</strong>ã€‚è¿™ä¸ªåå­—ç”±160bitéšæœºåå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºï¼Œå¹¶åœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶ç¬¬ä¸€æ¬¡è·å¾—(é€šå¸¸é€šè¿‡/dev/urandom)ã€‚èŠ‚ç‚¹åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿ç•™å®ƒçš„IDï¼Œå¹¶æ°¸è¿œåœ°ä½¿ç”¨è¿™ä¸ªIDï¼Œç›´åˆ°è¢«ç®¡ç†å‘˜ä½¿ç”¨CLUSTER RESET HARDå‘½ä»¤hard resetè¿™ä¸ªèŠ‚ç‚¹ã€‚</p><p>èŠ‚ç‚¹IDè¢«ç”¨æ¥åœ¨æ•´ä¸ªclusterä¸­æ ‡è¯†æ¯ä¸ªèŠ‚ç‚¹ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿®æ”¹è‡ªå·±çš„IPåœ°å€è€Œä¸éœ€è¦ä¿®æ”¹è‡ªå·±çš„IDã€‚Clusterå¯ä»¥æ£€æµ‹åˆ°IP /portçš„æ”¹åŠ¨å¹¶é€šè¿‡è¿è¡Œåœ¨cluster busä¸Šçš„gossipåè®®é‡æ–°é…ç½®è¯¥èŠ‚ç‚¹ã€‚</p><p>èŠ‚ç‚¹IDä¸æ˜¯å”¯ä¸€ä¸èŠ‚ç‚¹ç»‘å®šçš„ä¿¡æ¯ï¼Œä½†æ˜¯ä»–æ˜¯å”¯ä¸€çš„ä¸€ä¸ªæ€»æ˜¯ä¿æŒå…¨å±€ä¸€è‡´çš„å­—æ®µã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‹¥æœ‰ä¸€ç³»åˆ—ç›¸å…³çš„ä¿¡æ¯ã€‚ä¸€äº›ä¿¡æ¯æ—¶å…³äºæœ¬èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­é…ç½®ç»†èŠ‚ï¼Œå¹¶æœ€ç»ˆåœ¨clusterå†…éƒ¨ä¿æŒä¸€è‡´çš„ã€‚è€Œå…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚èŠ‚ç‚¹æœ€åè¢«pingçš„æ—¶é—´ï¼Œæ˜¯èŠ‚ç‚¹çš„æœ¬åœ°ä¿¡æ¯ã€‚</p><p>æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ç€é›†ç¾¤å†…å…¶ä»–èŠ‚ç‚¹çš„ä»¥ä¸‹ä¿¡æ¯ï¼š<code>node id</code>, <code>èŠ‚ç‚¹çš„IPå’Œport</code>ï¼Œ<code>èŠ‚ç‚¹æ ‡ç­¾</code>ï¼Œ<code>master node id</code>ï¼ˆå¦‚æœè¿™æ˜¯ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼‰ï¼Œ<code>æœ€åè¢«æŒ‚èµ·çš„pingçš„å‘é€æ—¶é—´</code>(å¦‚æœæ²¡æœ‰æŒ‚èµ·çš„pingåˆ™ä¸º0)ï¼Œ<code>æœ€åä¸€æ¬¡æ”¶åˆ°pongçš„æ—¶é—´</code>ï¼Œ<code>å½“å‰çš„èŠ‚ç‚¹configuration epoch</code> ï¼Œ<code>é“¾æ¥çŠ¶æ€</code>ï¼Œä»¥åŠæœ€åæ˜¯è¯¥èŠ‚ç‚¹æœåŠ¡çš„<code>hash slots</code>ã€‚</p><p>å¯¹èŠ‚ç‚¹å­—æ®µæ›´è¯¦ç»†çš„æè¿°ï¼Œå¯ä»¥å‚è€ƒå¯¹å‘½ä»¤ CLUSTER NODESçš„æè¿°ã€‚</p><p>CLUSTER NODESå‘½ä»¤å¯ä»¥è¢«å‘é€åˆ°é›†ç¾¤å†…çš„ä»»æ„èŠ‚ç‚¹ï¼Œä»–ä¼šæä¾›åŸºäºè¯¥èŠ‚ç‚¹è§†è§’(view)ä¸‹çš„é›†ç¾¤çŠ¶æ€ä»¥åŠæ¯ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå‘é€åˆ°ä¸€ä¸ªæ‹¥æœ‰3ä¸ªèŠ‚ç‚¹çš„å°é›†ç¾¤çš„masterèŠ‚ç‚¹çš„CLUSTER NODESè¾“å‡ºçš„ä¾‹å­ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ redis-cli cluster nodes

d1861060fe6a534d42d8a19aeb36600e18785e04 <span class="token number">127.0</span>.0.1:6379 myself - <span class="token number">0</span> <span class="token number">1318428930</span> <span class="token number">1</span> connected <span class="token number">0</span>-1364
3886e65cc906bfd9b1f7e7bde468726a052d1dae <span class="token number">127.0</span>.0.1:6380 master - <span class="token number">1318428930</span> <span class="token number">1318428931</span> <span class="token number">2</span> connected <span class="token number">1365</span>-2729
d289c575dcbc4bdd2931585fd4339089e461a27d <span class="token number">127.0</span>.0.1:6381 master - <span class="token number">1318428931</span> <span class="token number">1318428931</span> <span class="token number">3</span> connected <span class="token number">2730</span>-4095
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæŒ‰é¡ºåºåˆ—å‡ºäº†ä¸åŒçš„å­—æ®µï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">node</span> id, address:port, flags, last <span class="token function">ping</span> sent, last pong received, configuration epoch, <span class="token function">link</span> state, slots.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-4-clusteræ€»çº¿" tabindex="-1"><a class="header-anchor" href="#_2-4-clusteræ€»çº¿" aria-hidden="true">#</a> 2.4 Clusteræ€»çº¿</h3><p>æ¯ä¸ªRedis ClusterèŠ‚ç‚¹æœ‰ä¸€ä¸ªé¢å¤–çš„TCPç«¯å£ç”¨æ¥æ¥å—å…¶ä»–èŠ‚ç‚¹çš„è¿æ¥ã€‚è¿™ä¸ªç«¯å£ä¸ç”¨æ¥æ¥æ”¶clientå‘½ä»¤çš„æ™®é€šTCPç«¯å£æœ‰ä¸€ä¸ªå›ºå®šçš„offsetã€‚è¯¥ç«¯å£ç­‰äºæ™®é€šå‘½ä»¤ç«¯å£åŠ ä¸Š10000.ä¾‹å¦‚ï¼Œä¸€ä¸ªRedisè¡—é“å£åœ¨ç«¯å£6379å»ºç«‹å®¢æˆ·ç«¯è¿æ¥ï¼Œé‚£ä¹ˆå®ƒçš„é›†ç¾¤æ€»çº¿ç«¯å£16379ä¹Ÿä¼šè¢«æ‰“å¼€ã€‚</p><p><strong>èŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„é€šè®¯åªä½¿ç”¨é›†ç¾¤æ€»çº¿</strong>ï¼ŒåŒæ—¶ä½¿ç”¨é›†ç¾¤æ€»çº¿åè®®ï¼šæœ‰ä¸åŒçš„ç±»å‹å’Œå¤§å°çš„å¸§ç»„æˆçš„äºŒè¿›åˆ¶åè®®ã€‚é›†ç¾¤æ€»çº¿çš„äºŒè¿›åˆ¶åè®®æ²¡æœ‰è¢«å…¬å¼€æ–‡æ¡£è¯ï¼Œå› ä¸ºä»–ä¸å¸Œæœ›è¢«å¤–éƒ¨è½¯ä»¶è®¾å¤‡ç”¨æ¥é¢„è®¡ç¾¤èŠ‚ç‚¹è¿›è¡Œå¯¹è¯ã€‚</p><h3 id="_2-5-é›†ç¾¤æ‹“æ‰‘" tabindex="-1"><a class="header-anchor" href="#_2-5-é›†ç¾¤æ‹“æ‰‘" aria-hidden="true">#</a> 2.5 é›†ç¾¤æ‹“æ‰‘</h3><p>Redis Clusteræ˜¯ä¸€å¼ å…¨ç½‘æ‹“æ‰‘ï¼ŒèŠ‚ç‚¹ä¸å…¶ä»–æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½ä¿æŒç€TCPè¿æ¥ã€‚ åœ¨ä¸€ä¸ªæ‹¥æœ‰Nä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”±N-1ä¸ªTCPä¼ å‡ºè¿æ¥ï¼Œå’ŒN-1ä¸ªTCPä¼ å…¥è¿æ¥ã€‚ è¿™äº›TCPè¿æ¥æ€»æ˜¯ä¿æŒæ´»æ€§(be kept alive)ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹åœ¨é›†ç¾¤æ€»çº¿ä¸Šå‘é€äº†pingè¯·æ±‚å¹¶æœŸå¾…å¯¹æ–¹å›å¤pongï¼Œï¼ˆå¦‚æœæ²¡æœ‰å¾—åˆ°å›å¤ï¼‰åœ¨ç­‰å¾…è¶³å¤Ÿæˆæ—¶é—´ä»¥ä¾¿å°†å¯¹æ–¹æ ‡è®°ä¸ºä¸å¯è¾¾ä¹‹å‰ï¼Œå®ƒå°†å…ˆå°è¯•é‡æ–°è¿æ¥å¯¹æ–¹ä»¥åˆ·æ–°ä¸å¯¹æ–¹çš„è¿æ¥ã€‚ è€Œåœ¨å…¨ç½‘æ‹“æ‰‘ä¸­çš„Redis ClusterèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä½¿ç”¨gossipåè®®å’Œé…ç½®æ›´æ–°æœºåˆ¶æ¥é¿å…åœ¨æ­£å¸¸æƒ…å†µä¸‹èŠ‚ç‚¹ä¹‹é—´äº¤æ¢è¿‡å¤šçš„æ¶ˆæ¯ï¼Œå› æ­¤é›†ç¾¤å†…äº¤æ¢çš„æ¶ˆæ¯æ•°ç›®(ç›¸å¯¹èŠ‚ç‚¹æ•°ç›®)ä¸æ˜¯æŒ‡æ•°çº§çš„ã€‚</p><h3 id="_2-6-èŠ‚ç‚¹æ¡æ‰‹" tabindex="-1"><a class="header-anchor" href="#_2-6-èŠ‚ç‚¹æ¡æ‰‹" aria-hidden="true">#</a> 2.6 èŠ‚ç‚¹æ¡æ‰‹</h3><p>èŠ‚ç‚¹æ€»æ˜¯æ¥å—é›†ç¾¤æ€»çº¿ç«¯å£çš„é“¾æ¥ï¼Œå¹¶ä¸”æ€»æ˜¯ä¼šå›å¤pingè¯·æ±‚ï¼Œå³ä½¿pingæ¥è‡ªä¸€ä¸ªä¸å¯ä¿¡èŠ‚ç‚¹ã€‚ç„¶è€Œï¼Œå¦‚æœå‘é€èŠ‚ç‚¹è¢«è®¤ä¸ºä¸æ˜¯å½“å‰é›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰å…¶ä»–åŒ…å°†è¢«æŠ›å¼ƒã€‚</p><p>èŠ‚ç‚¹è®¤å®šå…¶ä»–èŠ‚ç‚¹æ˜¯å½“å‰é›†ç¾¤çš„ä¸€éƒ¨åˆ†æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å‡ºç°åœ¨äº†ä¸€æ¡MEETæ¶ˆæ¯ä¸­ã€‚ä¸€æ¡meetæ¶ˆæ¯éå¸¸åƒä¸€ä¸ªPINGæ¶ˆæ¯ï¼Œä½†æ˜¯å®ƒä¼šå¼ºåˆ¶æ¥æ”¶è€…æ¥å—ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„ä¸€éƒ¨åˆ†ã€‚èŠ‚ç‚¹åªæœ‰åœ¨æ¥æ”¶åˆ°ç³»ç»Ÿç®¡ç†å‘˜çš„å¦‚ä¸‹å‘½ä»¤åï¼Œæ‰ä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€MEETæ¶ˆæ¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CLUSTER MEET ip port
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å¦‚æœä¸€ä¸ªè¢«ä¿¡ä»»çš„èŠ‚ç‚¹gossipäº†æŸä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ¥æ”¶åˆ°gossipæ¶ˆæ¯çš„èŠ‚ç‚¹ä¹Ÿä¼šé‚£ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸ºé›†ç¾¤çš„ä¸€éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨é›†ç¾¤ä¸­ï¼ŒAçŸ¥é“Bï¼Œè€ŒBçŸ¥é“Cï¼Œæœ€ç»ˆBä¼šå‘é€gossipæ¶ˆæ¯åˆ°Aï¼Œå‘Šè¯‰AèŠ‚ç‚¹Cæ˜¯é›†ç¾¤çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ—¶ï¼ŒAä¼šæŠŠCæ³¨å†Œæœªç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶å°è¯•ä¸Cå»ºç«‹è¿æ¥ã€‚</p></li></ol><p>è¿™æ„å‘³ç€ï¼Œä¸€æ—¦æˆ‘ä»¬æŠŠæŸä¸ªèŠ‚ç‚¹åŠ å…¥äº†è¿æ¥å›¾(connected graph)ï¼Œå®ƒä»¬æœ€ç»ˆä¼šè‡ªåŠ¨å½¢æˆä¸€å¼ å…¨è¿æ¥å›¾(fully connected graph)ã€‚è¿™æ„å‘³ç€åªè¦ç³»ç»Ÿç®¡ç†å‘˜å¼ºåˆ¶åŠ å…¥äº†ä¸€æ¡ä¿¡ä»»å…³ç³»ï¼ˆåœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šé€šè¿‡meetå‘½ä»¤åŠ å…¥äº†ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼‰ï¼Œé›†ç¾¤å¯ä»¥è‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹ã€‚</p><h2 id="_3-è¯·æ±‚é‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#_3-è¯·æ±‚é‡å®šå‘" aria-hidden="true">#</a> 3. è¯·æ±‚é‡å®šå‘</h2><blockquote><p>Redis clusteré‡‡ç”¨å»ä¸­å¿ƒåŒ–çš„æ¶æ„ï¼Œé›†ç¾¤çš„ä¸»èŠ‚ç‚¹å„è‡ªè´Ÿè´£ä¸€éƒ¨åˆ†æ§½ï¼Œå®¢æˆ·ç«¯å¦‚ä½•ç¡®å®škeyåˆ°åº•ä¼šæ˜ å°„åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬è¦è®²çš„è¯·æ±‚é‡å®šå‘ã€‚</p></blockquote><p>åœ¨clusteræ¨¡å¼ä¸‹ï¼Œ<strong>èŠ‚ç‚¹å¯¹è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹</strong>å¦‚ä¸‹ï¼š</p><ul><li>æ£€æŸ¥å½“å‰keyæ˜¯å¦å­˜åœ¨å½“å‰NODEï¼Ÿ <ul><li>é€šè¿‡crc16ï¼ˆkeyï¼‰/16384è®¡ç®—å‡ºslot</li><li>æŸ¥è¯¢è´Ÿè´£è¯¥slotè´Ÿè´£çš„èŠ‚ç‚¹ï¼Œå¾—åˆ°èŠ‚ç‚¹æŒ‡é’ˆ</li><li>è¯¥æŒ‡é’ˆä¸è‡ªèº«èŠ‚ç‚¹æ¯”è¾ƒ</li></ul></li><li>è‹¥slotä¸æ˜¯ç”±è‡ªèº«è´Ÿè´£ï¼Œåˆ™è¿”å›MOVEDé‡å®šå‘</li><li>è‹¥slotç”±è‡ªèº«è´Ÿè´£ï¼Œä¸”keyåœ¨slotä¸­ï¼Œåˆ™è¿”å›è¯¥keyå¯¹åº”ç»“æœ</li><li>è‹¥keyä¸å­˜åœ¨æ­¤slotä¸­ï¼Œæ£€æŸ¥è¯¥slotæ˜¯å¦æ­£åœ¨è¿å‡ºï¼ˆMIGRATINGï¼‰ï¼Ÿ</li><li>è‹¥keyæ­£åœ¨è¿å‡ºï¼Œè¿”å›ASKé”™è¯¯é‡å®šå‘å®¢æˆ·ç«¯åˆ°è¿ç§»çš„ç›®çš„æœåŠ¡å™¨ä¸Š</li><li>è‹¥Slotæœªè¿å‡ºï¼Œæ£€æŸ¥Slotæ˜¯å¦å¯¼å…¥ä¸­ï¼Ÿ</li><li>è‹¥Slotå¯¼å…¥ä¸­ä¸”æœ‰ASKINGæ ‡è®°ï¼Œåˆ™ç›´æ¥æ“ä½œ</li><li>å¦åˆ™è¿”å›MOVEDé‡å®šå‘</li></ul><p>è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸¤ç‚¹éœ€è¦å…·ä½“ç†è§£ä¸‹ï¼š <strong>MOVEDé‡å®šå‘</strong> å’Œ <strong>ASKé‡å®šå‘</strong>ã€‚</p><h3 id="_3-1-moved-é‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#_3-1-moved-é‡å®šå‘" aria-hidden="true">#</a> 3.1 Moved é‡å®šå‘</h3><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626201534646.png" alt="image-20220626201534646" tabindex="0" loading="lazy"><figcaption>image-20220626201534646</figcaption></figure><ul><li>æ§½å‘½ä¸­ï¼šç›´æ¥è¿”å›ç»“æœ</li><li>æ§½ä¸å‘½ä¸­ï¼šå³å½“å‰é”®å‘½ä»¤æ‰€è¯·æ±‚çš„é”®ä¸åœ¨å½“å‰è¯·æ±‚çš„èŠ‚ç‚¹ä¸­ï¼Œåˆ™å½“å‰èŠ‚ç‚¹ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªMoved é‡å®šå‘ï¼Œå®¢æˆ·ç«¯æ ¹æ®Moved é‡å®šå‘æ‰€åŒ…å«çš„å†…å®¹æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œå†ä¸€æ¬¡å‘é€å‘½ä»¤ã€‚</li></ul><p>ä»ä¸‹é¢å¯ä»¥çœ‹å‡º php çš„æ§½ä½9244ä¸åœ¨å½“å‰èŠ‚ç‚¹ä¸­ï¼Œæ‰€ä»¥ä¼šé‡å®šå‘åˆ°èŠ‚ç‚¹ 192.168.2.23:7001ä¸­ã€‚redis-cliä¼šå¸®ä½ è‡ªåŠ¨é‡å®šå‘ï¼ˆå¦‚æœæ²¡æœ‰é›†ç¾¤æ–¹å¼å¯åŠ¨ï¼Œå³æ²¡åŠ å‚æ•° -cï¼Œredis-cliä¸ä¼šè‡ªåŠ¨é‡å®šå‘ï¼‰ï¼Œå¹¶ä¸”ç¼–å†™ç¨‹åºæ—¶ï¼Œå¯»æ‰¾ç›®æ ‡èŠ‚ç‚¹çš„é€»è¾‘éœ€è¦äº¤äºˆç¨‹åºå‘˜æ‰‹åŠ¨å®Œæˆã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cluster keyslot keyName # å¾—åˆ°keyNameçš„æ§½
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626201657777.png" alt="image-20220626201657777" tabindex="0" loading="lazy"><figcaption>image-20220626201657777</figcaption></figure><h3 id="_3-2-ask-é‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#_3-2-ask-é‡å®šå‘" aria-hidden="true">#</a> 3.2 ASK é‡å®šå‘</h3><p>Aské‡å®šå‘å‘ç”Ÿäºé›†ç¾¤ä¼¸ç¼©æ—¶ï¼Œé›†ç¾¤ä¼¸ç¼©ä¼šå¯¼è‡´æ§½è¿ç§»ï¼Œå½“æˆ‘ä»¬å»æºèŠ‚ç‚¹è®¿é—®æ—¶ï¼Œæ­¤æ—¶æ•°æ®å·²ç»å¯èƒ½å·²ç»è¿ç§»åˆ°äº†ç›®æ ‡èŠ‚ç‚¹ï¼Œä½¿ç”¨Aské‡å®šå‘æ¥è§£å†³æ­¤ç§æƒ…å†µã€‚</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626201804388.png" alt="image-20220626201804388" tabindex="0" loading="lazy"><figcaption>image-20220626201804388</figcaption></figure><h3 id="_3-3-smartå®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_3-3-smartå®¢æˆ·ç«¯" aria-hidden="true">#</a> 3.3 smartå®¢æˆ·ç«¯</h3><p>ä¸Šè¿°ä¸¤ç§é‡å®šå‘çš„æœºåˆ¶ä½¿å¾—å®¢æˆ·ç«¯çš„å®ç°æ›´åŠ å¤æ‚ï¼Œæä¾›äº†smartå®¢æˆ·ç«¯ï¼ˆJedisClusterï¼‰æ¥<strong>å‡ä½å¤æ‚æ€§ï¼Œè¿½æ±‚æ›´å¥½çš„æ€§èƒ½</strong>ã€‚å®¢æˆ·ç«¯å†…éƒ¨è´Ÿè´£è®¡ç®—/ç»´æŠ¤é”®-&gt; æ§½ -&gt; èŠ‚ç‚¹æ˜ å°„ï¼Œç”¨äºå¿«é€Ÿå®šä½ç›®æ ‡èŠ‚ç‚¹ã€‚</p><p>å®ç°åŸç†ï¼š</p><ul><li>ä»é›†ç¾¤ä¸­é€‰å–ä¸€ä¸ªå¯è¿è¡ŒèŠ‚ç‚¹ï¼Œä½¿ç”¨ cluster slotså¾—åˆ°æ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»</li></ul><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626202106087.png" alt="image-20220626202106087"><ul><li>å°†ä¸Šè¿°æ˜ å°„å…³ç³»å­˜åˆ°æœ¬åœ°ï¼Œé€šè¿‡æ˜ å°„å…³ç³»å°±å¯ä»¥ç›´æ¥å¯¹ç›®æ ‡èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼ˆCRC16(key) -&gt; slot -&gt; nodeï¼‰ï¼Œå¾ˆå¥½åœ°é¿å…äº†Movedé‡å®šå‘ï¼Œå¹¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºJedisPool</li><li>è‡³æ­¤å°±å¯ä»¥ç”¨æ¥è¿›è¡Œå‘½ä»¤æ“ä½œ</li></ul><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626202204697.png" alt="image-20220626202204697" tabindex="0" loading="lazy"><figcaption>image-20220626202204697</figcaption></figure><h2 id="_4-çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤" tabindex="-1"><a class="header-anchor" href="#_4-çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤" aria-hidden="true">#</a> 4. çŠ¶æ€æ£€æµ‹åŠç»´æŠ¤</h2><blockquote><p>Redis Clusterä¸­èŠ‚ç‚¹çŠ¶æ€å¦‚ä½•ç»´æŠ¤å‘¢ï¼Ÿè¿™é‡Œä¾¿æ¶‰åŠ <strong>æœ‰å“ªäº›çŠ¶æ€</strong>ï¼Œ<strong>åº•å±‚åè®®Gossip</strong>ï¼ŒåŠ<strong>å…·ä½“çš„é€šè®¯ï¼ˆå¿ƒè·³ï¼‰æœºåˆ¶</strong>ã€‚</p></blockquote><p>Clusterä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤ä¸€ä»½åœ¨è‡ªå·±çœ‹æ¥å½“å‰æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>å½“å‰é›†ç¾¤çŠ¶æ€</li><li>é›†ç¾¤ä¸­å„èŠ‚ç‚¹æ‰€è´Ÿè´£çš„slotsä¿¡æ¯ï¼ŒåŠå…¶migrateçŠ¶æ€</li><li>é›†ç¾¤ä¸­å„èŠ‚ç‚¹çš„master-slaveçŠ¶æ€</li><li>é›†ç¾¤ä¸­å„èŠ‚ç‚¹çš„å­˜æ´»çŠ¶æ€åŠä¸å¯è¾¾æŠ•ç¥¨</li></ul><p>å½“é›†ç¾¤çŠ¶æ€å˜åŒ–æ—¶ï¼Œå¦‚<code>æ–°èŠ‚ç‚¹åŠ å…¥</code>ã€<code>slotè¿ç§»</code>ã€<code>èŠ‚ç‚¹å®•æœº</code>ã€<code>slaveæå‡ä¸ºæ–°Master</code>ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›å˜åŒ–å°½å¿«çš„è¢«å‘ç°ï¼Œä¼ æ’­åˆ°æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹å¹¶è¾¾æˆä¸€è‡´ã€‚èŠ‚ç‚¹ä¹‹é—´ç›¸äº’çš„<strong>å¿ƒè·³</strong>ï¼ˆPINGï¼ŒPONGï¼ŒMEETï¼‰åŠå…¶æºå¸¦çš„æ•°æ®æ˜¯é›†ç¾¤çŠ¶æ€ä¼ æ’­æœ€ä¸»è¦çš„é€”å¾„ã€‚</p><h3 id="_4-1-gossipåè®®" tabindex="-1"><a class="header-anchor" href="#_4-1-gossipåè®®" aria-hidden="true">#</a> 4.1 Gossipåè®®</h3><blockquote><p>Redis Cluster é€šè®¯åº•å±‚æ˜¯Gossipåè®®ï¼Œæ‰€ä»¥éœ€è¦å¯¹Gossipåè®®æœ‰ä¸€å®šçš„äº†è§£ã€‚</p></blockquote><p>gossip åè®®ï¼ˆgossip protocolï¼‰åˆç§° epidemic åè®®ï¼ˆepidemic protocolï¼‰ï¼Œæ˜¯åŸºäºæµè¡Œç—…ä¼ æ’­æ–¹å¼çš„èŠ‚ç‚¹æˆ–è€…è¿›ç¨‹ä¹‹é—´ä¿¡æ¯äº¤æ¢çš„åè®®ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ gossip åè®®æ¥ç¡®ä¿ç½‘ç»œä¸­æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ä¸€æ ·ã€‚</p><p>Gossipåè®®å·²ç»æ˜¯P2Pç½‘ç»œä¸­æ¯”è¾ƒæˆç†Ÿçš„åè®®äº†ã€‚Gossipåè®®çš„æœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œ<strong>å³ä½¿é›†ç¾¤èŠ‚ç‚¹çš„æ•°é‡å¢åŠ ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ä¹Ÿä¸ä¼šå¢åŠ å¾ˆå¤šï¼Œå‡ ä¹æ˜¯æ’å®šçš„ã€‚è¿™å°±å…è®¸Consulç®¡ç†çš„é›†ç¾¤è§„æ¨¡èƒ½æ¨ªå‘æ‰©å±•åˆ°æ•°åƒä¸ªèŠ‚ç‚¹</strong>ã€‚</p><p>Gossipç®—æ³•åˆè¢«ç§°ä¸ºåç†µï¼ˆAnti-Entropyï¼‰ï¼Œç†µæ˜¯ç‰©ç†å­¦ä¸Šçš„ä¸€ä¸ªæ¦‚å¿µï¼Œä»£è¡¨æ‚ä¹±æ— ç« ï¼Œè€Œåç†µå°±æ˜¯åœ¨æ‚ä¹±æ— ç« ä¸­å¯»æ±‚ä¸€è‡´ï¼Œè¿™å……åˆ†è¯´æ˜äº†Gossipçš„ç‰¹ç‚¹ï¼šåœ¨ä¸€ä¸ªæœ‰ç•Œç½‘ç»œä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éšæœºåœ°ä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ï¼Œç»è¿‡ä¸€ç•ªæ‚ä¹±æ— ç« çš„é€šä¿¡ï¼Œæœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€éƒ½ä¼šè¾¾æˆä¸€è‡´ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½çŸ¥é“æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½ä»…çŸ¥é“å‡ ä¸ªé‚»å±…èŠ‚ç‚¹ï¼Œåªè¦è¿™äº›èŠ‚å¯ä»¥é€šè¿‡ç½‘ç»œè¿é€šï¼Œæœ€ç»ˆä»–ä»¬çš„çŠ¶æ€éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ç–«æƒ…ä¼ æ’­çš„ç‰¹ç‚¹ã€‚<a href="https://www.backendcloud.cn/2017/11/12/raft-gossip/" target="_blank" rel="noopener noreferrer">https://www.backendcloud.cn/2017/11/12/raft-gossip/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¸Šé¢çš„æè¿°éƒ½æ¯”è¾ƒå­¦æœ¯ï¼Œå…¶å®Gossipåè®®å¯¹äºæˆ‘ä»¬åƒç“œç¾¤ä¼—æ¥è¯´ä¸€ç‚¹ä¹Ÿä¸é™Œç”Ÿï¼ŒGossipåè®®ä¹Ÿç§°ä¸ºæµè¨€åè®®ï¼Œè¯´ç™½äº†å°±æ˜¯å…«å¦åè®®ï¼Œè¿™ç§ä¼ æ’­è§„æ¨¡å’Œä¼ æ’­é€Ÿåº¦éƒ½æ˜¯éå¸¸å¿«çš„ï¼Œä½ å¯ä»¥ä½“ä¼šä¸€ä¸‹ã€‚æ‰€ä»¥è®¡ç®—æœºä¸­çš„å¾ˆå¤šç®—æ³•éƒ½æ˜¯æºè‡ªç”Ÿæ´»ï¼Œè€Œåˆé«˜äºç”Ÿæ´»çš„ã€‚</p><h4 id="_4-1-1-gossipåè®®çš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_4-1-1-gossipåè®®çš„ä½¿ç”¨" aria-hidden="true">#</a> 4.1.1 Gossipåè®®çš„ä½¿ç”¨</h4><p>Redis é›†ç¾¤æ˜¯å»ä¸­å¿ƒåŒ–çš„ï¼Œå½¼æ­¤ä¹‹é—´çŠ¶æ€åŒæ­¥é  gossip åè®®é€šä¿¡ï¼Œé›†ç¾¤çš„æ¶ˆæ¯æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li><code>Meet</code> é€šè¿‡ã€Œcluster meet ip portã€å‘½ä»¤ï¼Œå·²æœ‰é›†ç¾¤çš„èŠ‚ç‚¹ä¼šå‘æ–°çš„èŠ‚ç‚¹å‘é€é‚€è¯·ï¼ŒåŠ å…¥ç°æœ‰é›†ç¾¤ã€‚</li><li><code>Ping</code> èŠ‚ç‚¹æ¯ç§’ä¼šå‘é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹å‘é€ ping æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­å¸¦æœ‰è‡ªå·±å·²çŸ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹çš„åœ°å€ã€æ§½ã€çŠ¶æ€ä¿¡æ¯ã€æœ€åä¸€æ¬¡é€šä¿¡æ—¶é—´ç­‰ã€‚</li><li><code>Pong</code> èŠ‚ç‚¹æ”¶åˆ° ping æ¶ˆæ¯åä¼šå›å¤ pong æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­åŒæ ·å¸¦æœ‰è‡ªå·±å·²çŸ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¿¡æ¯ã€‚</li><li><code>Fail</code> èŠ‚ç‚¹ ping ä¸é€šæŸèŠ‚ç‚¹åï¼Œä¼šå‘é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹å¹¿æ’­è¯¥èŠ‚ç‚¹æŒ‚æ‰çš„æ¶ˆæ¯ã€‚å…¶ä»–èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯åæ ‡è®°å·²ä¸‹çº¿ã€‚</li></ul><h4 id="_4-1-2-åŸºäºgossipåè®®çš„æ•…éšœæ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#_4-1-2-åŸºäºgossipåè®®çš„æ•…éšœæ£€æµ‹" aria-hidden="true">#</a> 4.1.2 åŸºäºGossipåè®®çš„æ•…éšœæ£€æµ‹</h4><p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸåœ°å‘é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å‘é€PINGæ¶ˆæ¯ï¼Œä»¥æ­¤äº¤æ¢å„ä¸ªèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼Œæ£€æµ‹å„ä¸ªèŠ‚ç‚¹çŠ¶æ€ï¼š<strong>åœ¨çº¿çŠ¶æ€</strong>ã€<strong>ç–‘ä¼¼ä¸‹çº¿çŠ¶æ€PFAIL</strong>ã€<strong>å·²ä¸‹çº¿çŠ¶æ€FAIL</strong>ã€‚</p><p><strong>è‡ªå·±ä¿å­˜ä¿¡æ¯</strong>ï¼šå½“ä¸»èŠ‚ç‚¹Aé€šè¿‡æ¶ˆæ¯å¾—çŸ¥ä¸»èŠ‚ç‚¹Bè®¤ä¸ºä¸»èŠ‚ç‚¹Dè¿›å…¥äº†ç–‘ä¼¼ä¸‹çº¿(PFAIL)çŠ¶æ€æ—¶,ä¸»èŠ‚ç‚¹Aä¼šåœ¨è‡ªå·±çš„clusterState.nodeså­—å…¸ä¸­æ‰¾åˆ°ä¸»èŠ‚ç‚¹Dæ‰€å¯¹åº”çš„clusterNodeç»“æ„ï¼Œå¹¶å°†ä¸»èŠ‚ç‚¹Bçš„ä¸‹çº¿æŠ¥å‘Šæ·»åŠ åˆ°clusterNodeç»“æ„çš„fail_reportsé“¾è¡¨ä¸­ï¼Œå¹¶åç»­å…³äºç»“ç‚¹Dç–‘ä¼¼ä¸‹çº¿çš„çŠ¶æ€é€šè¿‡Gossipåè®®é€šçŸ¥å…¶ä»–èŠ‚ç‚¹ã€‚</p><p><strong>ä¸€èµ·è£å®š</strong>ï¼šå¦‚æœé›†ç¾¤é‡Œé¢ï¼ŒåŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹éƒ½å°†ä¸»èŠ‚ç‚¹DæŠ¥å‘Šä¸ºç–‘ä¼¼ä¸‹çº¿ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹Då°†è¢«æ ‡è®°ä¸ºå·²ä¸‹çº¿(FAIL)çŠ¶æ€ï¼Œå°†ä¸»èŠ‚ç‚¹Dæ ‡è®°ä¸ºå·²ä¸‹çº¿çš„èŠ‚ç‚¹ä¼šå‘é›†ç¾¤å¹¿æ’­ä¸»èŠ‚ç‚¹Dçš„FAILæ¶ˆæ¯ï¼Œæ‰€æœ‰æ”¶åˆ°FAILæ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ä¼šç«‹å³æ›´æ–°nodesé‡Œé¢ä¸»èŠ‚ç‚¹DçŠ¶æ€æ ‡è®°ä¸ºå·²ä¸‹çº¿ã€‚</p><p><strong>æœ€ç»ˆè£å®š</strong>ï¼šå°† node æ ‡è®°ä¸º FAIL éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>æœ‰åŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹å°† node æ ‡è®°ä¸º PFAIL çŠ¶æ€ã€‚</li><li>å½“å‰èŠ‚ç‚¹ä¹Ÿå°† node æ ‡è®°ä¸º PFAIL çŠ¶æ€ã€‚</li></ul><h3 id="_4-2-é€šè®¯çŠ¶æ€å’Œç»´æŠ¤" tabindex="-1"><a class="header-anchor" href="#_4-2-é€šè®¯çŠ¶æ€å’Œç»´æŠ¤" aria-hidden="true">#</a> 4.2 é€šè®¯çŠ¶æ€å’Œç»´æŠ¤</h3><blockquote><p>æˆ‘ä»¬ç†è§£äº†Gossipåè®®åŸºç¡€åï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥ç†è§£RedisèŠ‚ç‚¹ä¹‹é—´ç›¸äº’çš„é€šè®¯<strong>å¿ƒè·³</strong>ï¼ˆPINGï¼ŒPONGï¼ŒMEETï¼‰å®ç°å’Œç»´æŠ¤äº†ã€‚æˆ‘ä»¬é€šè¿‡å‡ ä¸ªé—®é¢˜æ¥å…·ä½“ç†è§£ã€‚</p></blockquote><h4 id="_4-2-1-ä»€ä¹ˆæ—¶å€™è¿›è¡Œå¿ƒè·³" tabindex="-1"><a class="header-anchor" href="#_4-2-1-ä»€ä¹ˆæ—¶å€™è¿›è¡Œå¿ƒè·³" aria-hidden="true">#</a> 4.2.1 ä»€ä¹ˆæ—¶å€™è¿›è¡Œå¿ƒè·³ï¼Ÿ</h4><p>RedisèŠ‚ç‚¹ä¼šè®°å½•å…¶å‘æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¸€æ¬¡å‘å‡ºpingå’Œæ”¶åˆ°pongçš„æ—¶é—´ï¼Œå¿ƒè·³å‘é€æ—¶æœºä¸è¿™ä¸¤ä¸ªå€¼æœ‰å…³ã€‚é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ—¢èƒ½ä¿è¯åŠæ—¶æ›´æ–°é›†ç¾¤çŠ¶æ€ï¼Œåˆä¸è‡³äºä½¿å¿ƒè·³æ•°è¿‡å¤šï¼š</p><ul><li>æ¯æ¬¡Cronå‘æ‰€æœ‰æœªå»ºç«‹é“¾æ¥çš„èŠ‚ç‚¹å‘é€pingæˆ–meet</li><li>æ¯1ç§’ä»æ‰€æœ‰å·²çŸ¥èŠ‚ç‚¹ä¸­éšæœºé€‰å–5ä¸ªï¼Œå‘å…¶ä¸­ä¸Šæ¬¡æ”¶åˆ°pongæœ€ä¹…è¿œçš„ä¸€ä¸ªå‘é€ping</li><li>æ¯æ¬¡Cronå‘æ”¶åˆ°pongè¶…è¿‡timeout/2çš„èŠ‚ç‚¹å‘é€ping</li><li>æ”¶åˆ°pingæˆ–meetï¼Œç«‹å³å›å¤pong</li></ul><h4 id="_4-2-2-å‘é€å“ªäº›å¿ƒè·³æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_4-2-2-å‘é€å“ªäº›å¿ƒè·³æ•°æ®" aria-hidden="true">#</a> 4.2.2 å‘é€å“ªäº›å¿ƒè·³æ•°æ®ï¼Ÿ</h4><ul><li>Headerï¼Œå‘é€è€…è‡ªå·±çš„ä¿¡æ¯ <ul><li>æ‰€è´Ÿè´£slotsçš„ä¿¡æ¯</li><li>ä¸»ä»ä¿¡æ¯</li><li>ip portä¿¡æ¯</li><li>çŠ¶æ€ä¿¡æ¯</li></ul></li><li>Gossipï¼Œå‘é€è€…æ‰€äº†è§£çš„éƒ¨åˆ†å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯ <ul><li>ping_sent, pong_received</li><li>ip, portä¿¡æ¯</li><li>çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚å‘é€è€…è®¤ä¸ºè¯¥èŠ‚ç‚¹å·²ç»ä¸å¯è¾¾ï¼Œä¼šåœ¨çŠ¶æ€ä¿¡æ¯ä¸­æ ‡è®°å…¶ä¸ºPFAILæˆ–FAIL</li></ul></li></ul><h4 id="_4-2-3-å¦‚ä½•å¤„ç†å¿ƒè·³" tabindex="-1"><a class="header-anchor" href="#_4-2-3-å¦‚ä½•å¤„ç†å¿ƒè·³" aria-hidden="true">#</a> 4.2.3 å¦‚ä½•å¤„ç†å¿ƒè·³ï¼Ÿ</h4><p>1ï¼Œ<strong>æ–°èŠ‚ç‚¹åŠ å…¥</strong></p><ul><li>å‘é€meetåŒ…åŠ å…¥é›†ç¾¤</li><li>ä»pongåŒ…ä¸­çš„gossipå¾—åˆ°æœªçŸ¥çš„å…¶ä»–èŠ‚ç‚¹</li><li>å¾ªç¯ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æœ€ç»ˆåŠ å…¥é›†ç¾¤</li></ul><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626204216536.png" alt="image-20220626204216536" tabindex="0" loading="lazy"><figcaption>image-20220626204216536</figcaption></figure><p>2ï¼Œ<strong>Slotsä¿¡æ¯</strong></p><ul><li>åˆ¤æ–­å‘é€è€…å£°æ˜çš„slotsä¿¡æ¯ï¼Œè·Ÿæœ¬åœ°è®°å½•çš„æ˜¯å¦æœ‰ä¸åŒ</li><li>å¦‚æœä¸åŒï¼Œä¸”å‘é€è€…epochè¾ƒå¤§ï¼Œæ›´æ–°æœ¬åœ°è®°å½•</li><li>å¦‚æœä¸åŒï¼Œä¸”å‘é€è€…epochå°ï¼Œå‘é€Updateä¿¡æ¯é€šçŸ¥å‘é€è€…</li></ul><p>3ï¼Œ<strong>Master slaveä¿¡æ¯</strong></p><p>å‘ç°å‘é€è€…çš„masterã€slaveä¿¡æ¯å˜åŒ–ï¼Œæ›´æ–°æœ¬åœ°çŠ¶æ€</p><p>4ï¼Œ<strong>èŠ‚ç‚¹Failæ¢æµ‹(æ•…éšœå‘ç°)</strong></p><ul><li>è¶…è¿‡è¶…æ—¶æ—¶é—´ä»ç„¶æ²¡æœ‰æ”¶åˆ°pongåŒ…çš„èŠ‚ç‚¹ä¼šè¢«å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºPFAIL</li><li>PFAILæ ‡è®°ä¼šéšç€gossipä¼ æ’­</li><li>æ¯æ¬¡æ”¶åˆ°å¿ƒè·³åŒ…ä¼šæ£€æµ‹å…¶ä¸­å¯¹å…¶ä»–èŠ‚ç‚¹çš„PFAILæ ‡è®°ï¼Œå½“åšå¯¹è¯¥èŠ‚ç‚¹FAILçš„æŠ•ç¥¨ç»´æŠ¤åœ¨æœ¬æœº</li><li>å¯¹æŸä¸ªèŠ‚ç‚¹çš„PFAILæ ‡è®°è¾¾åˆ°å¤§å¤šæ•°æ—¶ï¼Œå°†å…¶å˜ä¸ºFAILæ ‡è®°å¹¶å¹¿æ’­FAILæ¶ˆæ¯</li></ul><blockquote><p>æ³¨ï¼šGossipçš„å­˜åœ¨ä½¿å¾—é›†ç¾¤çŠ¶æ€çš„æ”¹å˜å¯ä»¥æ›´å¿«çš„è¾¾åˆ°æ•´ä¸ªé›†ç¾¤ã€‚æ¯ä¸ªå¿ƒè·³åŒ…ä¸­ä¼šåŒ…å«å¤šä¸ªGossipåŒ…ï¼Œé‚£ä¹ˆå¤šå°‘ä¸ªæ‰æ˜¯åˆé€‚çš„å‘¢ï¼Œredisçš„é€‰æ‹©æ˜¯N/10ï¼Œå…¶ä¸­Næ˜¯èŠ‚ç‚¹æ•°ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åœ¨PFAILæŠ•ç¥¨çš„è¿‡æœŸæ—¶é—´å†…ï¼ŒèŠ‚ç‚¹å¯ä»¥æ”¶åˆ°80%æœºå™¨å…³äºå¤±è´¥èŠ‚ç‚¹çš„gossipï¼Œä»è€Œä½¿å…¶é¡ºåˆ©è¿›å…¥FAILçŠ¶æ€ã€‚</p></blockquote><h4 id="_4-2-4-å°†ä¿¡æ¯å¹¿æ’­ç»™å…¶å®ƒèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_4-2-4-å°†ä¿¡æ¯å¹¿æ’­ç»™å…¶å®ƒèŠ‚ç‚¹" aria-hidden="true">#</a> 4.2.4 å°†ä¿¡æ¯å¹¿æ’­ç»™å…¶å®ƒèŠ‚ç‚¹ï¼Ÿ</h4><p>å½“éœ€è¦å‘å¸ƒä¸€äº›éå¸¸é‡è¦éœ€è¦ç«‹å³é€è¾¾çš„ä¿¡æ¯æ—¶ï¼Œä¸Šè¿°å¿ƒè·³åŠ Gossipçš„æ–¹å¼å°±æ˜¾å¾—æ‰è¥Ÿè§è‚˜äº†ï¼Œè¿™æ—¶å°±éœ€è¦å‘æ‰€æœ‰é›†ç¾¤å†…æœºå™¨çš„å¹¿æ’­ä¿¡æ¯ï¼Œä½¿ç”¨å¹¿æ’­å‘çš„åœºæ™¯ï¼š</p><ul><li><strong>èŠ‚ç‚¹çš„Failä¿¡æ¯</strong>ï¼šå½“å‘ç°æŸä¸€èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œæ¢æµ‹èŠ‚ç‚¹ä¼šå°†å…¶æ ‡è®°ä¸ºPFAILçŠ¶æ€ï¼Œå¹¶é€šè¿‡å¿ƒè·³ä¼ æ’­å‡ºå»ã€‚å½“æŸä¸€èŠ‚ç‚¹å‘ç°è¿™ä¸ªèŠ‚ç‚¹çš„PFAILè¶…è¿‡åŠæ•°æ—¶ä¿®æ”¹å…¶ä¸ºFAILå¹¶å‘èµ·å¹¿æ’­ã€‚</li><li><strong>Failover Requestä¿¡æ¯</strong>ï¼šslaveå°è¯•å‘èµ·FailOveræ—¶å¹¿æ’­å…¶è¦æ±‚æŠ•ç¥¨çš„ä¿¡æ¯</li><li><strong>æ–°Masterä¿¡æ¯</strong>ï¼šFailoveræˆåŠŸçš„èŠ‚ç‚¹å‘æ•´ä¸ªé›†ç¾¤å¹¿æ’­è‡ªå·±çš„ä¿¡æ¯</li></ul><h2 id="_5-æ•…éšœæ¢å¤-failover" tabindex="-1"><a class="header-anchor" href="#_5-æ•…éšœæ¢å¤-failover" aria-hidden="true">#</a> 5. æ•…éšœæ¢å¤ï¼ˆFailoverï¼‰</h2><blockquote><p>masterèŠ‚ç‚¹æŒ‚äº†ä¹‹åï¼Œå¦‚ä½•è¿›è¡Œæ•…éšœæ¢å¤å‘¢ï¼Ÿ</p></blockquote><p>å½“slaveå‘ç°è‡ªå·±çš„masterå˜ä¸ºFAILçŠ¶æ€æ—¶ï¼Œä¾¿å°è¯•è¿›è¡ŒFailoverï¼Œä»¥æœŸæˆä¸ºæ–°çš„masterã€‚ç”±äºæŒ‚æ‰çš„masterå¯èƒ½ä¼šæœ‰å¤šä¸ªslaveã€‚Failoverçš„è¿‡ç¨‹éœ€è¦ç»è¿‡ç±»Raftåè®®çš„è¿‡ç¨‹åœ¨æ•´ä¸ªé›†ç¾¤å†…è¾¾åˆ°ä¸€è‡´ï¼Œ å…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>slaveå‘ç°è‡ªå·±çš„masterå˜ä¸ºFAIL</li><li>å°†è‡ªå·±è®°å½•çš„é›†ç¾¤currentEpochåŠ 1ï¼Œå¹¶å¹¿æ’­Failover Requestä¿¡æ¯</li><li>å…¶ä»–èŠ‚ç‚¹æ”¶åˆ°è¯¥ä¿¡æ¯ï¼Œåªæœ‰masterå“åº”ï¼Œåˆ¤æ–­è¯·æ±‚è€…çš„åˆæ³•æ€§ï¼Œå¹¶å‘é€FAILOVER_AUTH_ACKï¼Œå¯¹æ¯ä¸€ä¸ªepochåªå‘é€ä¸€æ¬¡ack</li><li>å°è¯•failoverçš„slaveæ”¶é›†FAILOVER_AUTH_ACK</li><li>è¶…è¿‡åŠæ•°åå˜æˆæ–°Master</li><li>å¹¿æ’­Pongé€šçŸ¥å…¶ä»–é›†ç¾¤èŠ‚ç‚¹</li></ul><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626204607046.png" alt="image-20220626204607046"><h2 id="_6-æ‰©å®¹-ç¼©å®¹" tabindex="-1"><a class="header-anchor" href="#_6-æ‰©å®¹-ç¼©å®¹" aria-hidden="true">#</a> 6. æ‰©å®¹&amp;ç¼©å®¹</h2><blockquote><p>Redis Clusteræ˜¯å¦‚ä½•è¿›è¡Œæ‰©å®¹å’Œç¼©å®¹çš„å‘¢ï¼Ÿ</p></blockquote><h3 id="_6-1-æ‰©å®¹" tabindex="-1"><a class="header-anchor" href="#_6-1-æ‰©å®¹" aria-hidden="true">#</a> 6.1 æ‰©å®¹</h3><p>å½“é›†ç¾¤å‡ºç°å®¹é‡é™åˆ¶æˆ–è€…å…¶ä»–ä¸€äº›åŸå› éœ€è¦æ‰©å®¹æ—¶</p><ul><li><p>redis clusterå¯ä»¥å®ç°å¯¹èŠ‚ç‚¹çš„çµæ´»ä¸Šä¸‹çº¿æ§åˆ¶</p></li><li><p>3ä¸ªä¸»èŠ‚ç‚¹åˆ†åˆ«ç»´æŠ¤è‡ªå·±è´Ÿè´£çš„æ§½å’Œå¯¹åº”çš„æ•°æ®ï¼Œå¦‚æœå¸Œæœ›åŠ å…¥ä¸€ä¸ªèŠ‚ç‚¹å®ç°æ‰©å®¹ï¼Œå°±éœ€è¦æŠŠä¸€éƒ¨åˆ†æ§½å’Œæ•°æ®è¿ç§»åˆ°æ–°èŠ‚ç‚¹</p></li></ul><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220701193315441.png" alt="image-20220701193315441"><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220701193332382.png" alt="image-20220701193332382"><p><strong>æ¯ä¸ªmasteræŠŠä¸€éƒ¨åˆ†æ§½å’Œæ•°æ®è¿ç§»åˆ°æ–°çš„èŠ‚ç‚¹node04</strong></p><h4 id="_6-1-1-æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_6-1-1-æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤" aria-hidden="true">#</a> 6.1.1 æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h4><blockquote><p>é¦–å…ˆå°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œ</p><ul><li>é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œcluster meet æ–°èŠ‚ç‚¹ip:ç«¯å£ï¼Œ</li><li>é€šè¿‡redis-trib add nodeæ·»åŠ ï¼Œæ–°æ·»åŠ çš„èŠ‚ç‚¹é»˜è®¤åœ¨é›†ç¾¤ä¸­éƒ½æ˜¯ä¸»èŠ‚ç‚¹ã€‚</li></ul></blockquote><h5 id="_6-1-1-æ–¹å¼ä¸€-cluster-meet" tabindex="-1"><a class="header-anchor" href="#_6-1-1-æ–¹å¼ä¸€-cluster-meet" aria-hidden="true">#</a> 6.1.1 æ–¹å¼ä¸€ï¼šcluster meet</h5><p>åœ¨åŸæœ‰é›†ç¾¤ä»»æ„èŠ‚ç‚¹å†…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><div class="language-ruby line-numbers-mode" data-ext="rb"><pre class="language-ruby"><code>root<span class="token variable">@node01</span> opt<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -h 10.0.0.100 -p 6380</span>
<span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">6380</span><span class="token operator">&gt;</span> cluster meet <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.103</span> <span class="token number">6379</span>
<span class="token constant">OK</span>
<span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">6380</span><span class="token operator">&gt;</span> cluster meet <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.103</span> <span class="token number">6380</span>
<span class="token constant">OK</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é›†ç¾¤å†…æ–°æ—§èŠ‚ç‚¹ç»è¿‡ä¸€æ®µæ—¶é—´çš„é€šä¿¡ä¹‹åï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¼šæ›´æ–°å®ƒä»¬çš„çŠ¶æ€å¹¶ä¿å­˜åˆ°æœ¬åœ°</p><div class="language-ruby line-numbers-mode" data-ext="rb"><pre class="language-ruby"><code><span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">6380</span><span class="token operator">&gt;</span> cluster nodes
<span class="token comment"># å¯ä»¥çœ‹åˆ°æ–°åŠ å…¥ä¸¤ä¸ªæœåŠ¡(10.0.0.103:6379/10.0.0.103:6380)éƒ½æ˜¯masterï¼Œå®ƒä»¬è¿˜æ²¡æœ‰ç®¡ç†slot</span>
<span class="token number">4</span>fb4c538d5f29255f6212f2eae8a761fbe364a89 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.101</span><span class="token operator">:</span><span class="token number">6380</span>@<span class="token number">16380</span> master <span class="token operator">-</span> <span class="token number">0</span> <span class="token number">1585048391000</span> <span class="token number">7</span> connected <span class="token number">0</span><span class="token operator">-</span><span class="token number">5460</span>
<span class="token number">690</span>b2e1f604a0227068388d3e5b1f1940524c565 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.102</span><span class="token operator">:</span><span class="token number">6379</span>@<span class="token number">16379</span> master <span class="token operator">-</span> <span class="token number">0</span> <span class="token number">1585048389000</span> <span class="token number">3</span> connected <span class="token number">10923</span><span class="token operator">-</span><span class="token number">16383</span>
<span class="token number">1</span>be5d1aaaa9e9542224554f461694da9cba7c2b8 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.101</span><span class="token operator">:</span><span class="token number">6379</span>@<span class="token number">16379</span> master <span class="token operator">-</span> <span class="token number">0</span> <span class="token number">1585048392055</span> <span class="token number">2</span> connected <span class="token number">5461</span><span class="token operator">-</span><span class="token number">10922</span>
<span class="token number">724</span>a8a15f4efe5a01454cb971d7471d6e84279f3 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.103</span><span class="token operator">:</span><span class="token number">6379</span>@<span class="token number">16379</span> master <span class="token operator">-</span> <span class="token number">0</span> <span class="token number">1585048388000</span> <span class="token number">8</span> connected
ed9b72fffd04b8a7e5ad20afdaf1f53e0eb95011 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.103</span><span class="token operator">:</span><span class="token number">6380</span>@<span class="token number">16380</span> master <span class="token operator">-</span> <span class="token number">0</span> <span class="token number">1585048391046</span> <span class="token number">0</span> connected
<span class="token number">89</span>f52bfbb8803db19ab0c5a90adc4099df8287f7 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">6379</span>@<span class="token number">16379</span> slave <span class="token number">4</span>fb4c538d5f29255f6212f2eae8a761fbe364a89 <span class="token number">0</span> <span class="token number">1585048388000</span> <span class="token number">7</span> connected
<span class="token number">86e1881611440012</span>c87fbf3fa98b7b6d79915e25 <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.102</span><span class="token operator">:</span><span class="token number">6380</span>@<span class="token number">16380</span> slave <span class="token number">1</span>be5d1aaaa9e9542224554f461694da9cba7c2b8 <span class="token number">0</span> <span class="token number">1585048389033</span> <span class="token number">6</span> connected
<span class="token number">8</span>c13a2afa76194ef9582bb06675695bfef76b11d <span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">6380</span>@<span class="token number">16380</span> myself<span class="token punctuation">,</span>slave <span class="token number">690</span>b2e1f604a0227068388d3e5b1f1940524c565 <span class="token number">0</span> <span class="token number">1585048390000</span> <span class="token number">4</span> connected
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–°èŠ‚ç‚¹åˆšå¼€å§‹éƒ½æ˜¯masterèŠ‚ç‚¹ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è´Ÿè´£çš„æ§½ï¼Œæ‰€ä»¥ä¸èƒ½æ¥æ”¶ä»»ä½•è¯»å†™æ“ä½œï¼Œå¯¹æ–°èŠ‚ç‚¹çš„åç»­æ“ä½œï¼Œä¸€èˆ¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>ä»å…¶ä»–çš„èŠ‚ç‚¹è¿ç§»æ§½å’Œæ•°æ®ç»™æ–°èŠ‚ç‚¹</li><li>ä½œä¸ºå…¶ä»–èŠ‚ç‚¹çš„slaveè´Ÿè´£æ•…éšœè½¬ç§»</li></ul><h5 id="_1-1-2-æ–¹å¼äºŒ-redis-trib-add-nodeæ·»åŠ " tabindex="-1"><a class="header-anchor" href="#_1-1-2-æ–¹å¼äºŒ-redis-trib-add-nodeæ·»åŠ " aria-hidden="true">#</a> 1.1.2 æ–¹å¼äºŒï¼šredis-trib add nodeæ·»åŠ  ()</h5><p>redis-trib.rbå·¥å…·ä¹Ÿå®ç°äº†ä¸ºç°æœ‰é›†ç¾¤æ·»åŠ æ–°èŠ‚ç‚¹çš„å‘½ä»¤ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†ç›´æ¥æ·»åŠ ä¸ºslaveçš„æ”¯æŒï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</span>
redis<span class="token operator">-</span>trib<span class="token punctuation">.</span>rb add<span class="token operator">-</span>node new_host<span class="token punctuation">:</span>new_port old_host<span class="token punctuation">:</span>old_port
<span class="token comment"># æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤å¹¶ä½œä¸ºæŒ‡å®šmasterçš„slave</span>
redis<span class="token operator">-</span>trib<span class="token punctuation">.</span>rb add<span class="token operator">-</span>node new_host<span class="token punctuation">:</span>new_port old_host<span class="token punctuation">:</span>old_port <span class="token operator">-</span><span class="token operator">-</span>slave <span class="token operator">-</span><span class="token operator">-</span>master<span class="token operator">-</span><span class="token builtin">id</span> <span class="token operator">&lt;</span>master<span class="token operator">-</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å»ºè®®ä½¿ç”¨<code>redis-trib.rb add-node</code>å°†æ–°èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ä¸­ï¼Œè¯¥å‘½ä»¤ä¼šæ£€æŸ¥æ–°èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¦‚æœæ–°èŠ‚ç‚¹å·²ç»åŠ å…¥äº†å…¶ä»–é›†ç¾¤æˆ–è€…å·²ç»åŒ…å«æ•°æ®ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œè€Œä½¿ç”¨<code>cluster meet</code>å‘½ä»¤åˆ™ä¸ä¼šåšè¿™æ ·çš„æ£€æŸ¥ï¼Œå‡å¦‚æ–°èŠ‚ç‚¹å·²ç»å­˜åœ¨æ•°æ®ï¼Œåˆ™ä¼šåˆå¹¶åˆ°é›†ç¾¤ä¸­ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´</p><h4 id="_6-1-2-è¿ç§»slotå’Œæ•°æ®" tabindex="-1"><a class="header-anchor" href="#_6-1-2-è¿ç§»slotå’Œæ•°æ®" aria-hidden="true">#</a> 6.1.2 è¿ç§»slotå’Œæ•°æ®</h4><blockquote><p>æ— éœ€è¦æ±‚æ¯ä¸ªmasterçš„slotç¼–å·æ˜¯è¿ç»­çš„ï¼Œåªè¦æ¯ä¸ªmasterç®¡ç†çš„slotçš„æ•°é‡å‡è¡¡å°±å¯ä»¥ã€‚</p></blockquote><ul><li>slotè¿ç§»æ˜¯é›†ç¾¤ä¼¸ç¼©çš„æœ€æ ¸å¿ƒæ­¥éª¤</li><li>å‡è®¾åŸæœ‰3ä¸ªmasterï¼Œæ¯ä¸ªmasterè´Ÿè´£10384 / 3 â‰ˆ 5461ä¸ªslot</li><li>åŠ å…¥ä¸€ä¸ªæ–°çš„masterä¹‹åï¼Œæ¯ä¸ªmasterè´Ÿè´£10384 / 4 = 4096ä¸ªslot</li><li>ç¡®å®šå¥½è¿ç§»è®¡åˆ’ä¹‹åï¼Œä¾‹å¦‚ï¼Œæ¯ä¸ªmasterå°†è¶…è¿‡4096ä¸ªslotçš„éƒ¨åˆ†è¿ç§»åˆ°æ–°çš„masterä¸­ï¼Œç„¶åå¼€å§‹ä»¥slotä¸ºå•ä½è¿›è¡Œè¿ç§»</li><li>æ¯ä¸ªslotçš„è¿ç§»è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220701200253514.png" alt="image-20220701200253514"><ol><li><p>å¯¹ç›®æ ‡èŠ‚ç‚¹å‘é€å¯¼å…¥å‘½ä»¤ï¼Œè®©ç›®æ ‡èŠ‚ç‚¹å‡†å¤‡å¯¼å…¥æ§½çš„æ•°æ®ã€‚</p></li><li><p>å¯¹æºèŠ‚ç‚¹å‘é€å¯¼å‡ºå‘½ä»¤ï¼Œè®©æºèŠ‚ç‚¹å‡†å¤‡è¿å‡ºæ§½çš„æ•°æ®ã€‚</p></li><li><p>æºèŠ‚ç‚¹å¾ªç¯æ‰§è¡Œè¿ç§»å‘½ä»¤ï¼Œå°†æ§½è·Ÿæ•°æ®è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</p></li><li><p>å‘é›†ç¾¤å¹¿æ’­æ§½å·²ç»è¿ç§»åˆ°BèŠ‚ç‚¹</p></li></ol><h5 id="_6-1-2-1-redis-trib-rbå·¥å…·å®Œæˆslotè¿ç§»" tabindex="-1"><a class="header-anchor" href="#_6-1-2-1-redis-trib-rbå·¥å…·å®Œæˆslotè¿ç§»" aria-hidden="true">#</a> 6.1.2.1 redis-trib.rbå·¥å…·å®Œæˆslotè¿ç§»</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-trib.rb reshard host:port <span class="token parameter variable">--from</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span> <span class="token parameter variable">--to</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span> <span class="token parameter variable">--slots</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span> <span class="token parameter variable">--yes</span> <span class="token parameter variable">--timeout</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span> <span class="token parameter variable">--pipeline</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>
 
host:portï¼šéšä¾¿æŒ‡å®šä¸€ä¸ªé›†ç¾¤ä¸­çš„host:portï¼Œç”¨ä»¥è·å–å…¨éƒ¨é›†ç¾¤çš„ä¿¡æ¯
--fromï¼šæºèŠ‚ç‚¹çš„idï¼Œæç¤ºç”¨æˆ·è¾“å…¥
--toï¼šç›®æ ‡èŠ‚ç‚¹çš„idï¼Œæç¤ºç”¨æˆ·è¾“å…¥
--slotsï¼šéœ€è¦è¿ç§»çš„slotçš„æ€»æ•°é‡ï¼Œæç¤ºç”¨æˆ·è¾“å…¥
--yesï¼šå½“æ‰“å°å‡ºslotè¿ç§»è®¡åˆ’åæ˜¯å¦éœ€è¦ç”¨æˆ·è¾“å…¥yesç¡®è®¤åæ‰§è¡Œ
--timeoutï¼šæ§åˆ¶æ¯æ¬¡migrateæ“ä½œçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤60000ms
--pipelineï¼šæ§åˆ¶æ¯æ¬¡æ‰¹é‡è¿ç§»çš„keyçš„æ•°é‡ï¼Œé»˜è®¤10
 
<span class="token punctuation">[</span>root@node01 redis<span class="token punctuation">]</span><span class="token comment"># redis-trib.rb reshard 10.0.0.100:6379</span>
 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">10.0</span>.0.100:6379<span class="token punctuation">)</span>
S: 89f52bfbb8803db19ab0c5a90adc4099df8287f7 <span class="token number">10.0</span>.0.100:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 4fb4c538d5f29255f6212f2eae8a761fbe364a89
S: 8c13a2afa76194ef9582bb06675695bfef76b11d <span class="token number">10.0</span>.0.100:6380
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 690b2e1f604a0227068388d3e5b1f1940524c565
M: 690b2e1f604a0227068388d3e5b1f1940524c565 <span class="token number">10.0</span>.0.102:6379
   slots:10923-16383 <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 4fb4c538d5f29255f6212f2eae8a761fbe364a89 <span class="token number">10.0</span>.0.101:6380
   slots:0-5460 <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: ed9b72fffd04b8a7e5ad20afdaf1f53e0eb95011 <span class="token number">10.0</span>.0.103:6380
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
   <span class="token number">0</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 86e1881611440012c87fbf3fa98b7b6d79915e25 <span class="token number">10.0</span>.0.102:6380
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 1be5d1aaaa9e9542224554f461694da9cba7c2b8
M: 1be5d1aaaa9e9542224554f461694da9cba7c2b8 <span class="token number">10.0</span>.0.101:6379
   slots:5461-10922 <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 724a8a15f4efe5a01454cb971d7471d6e84279f3 <span class="token number">10.0</span>.0.103:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
   <span class="token number">0</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
<span class="token comment"># è¦è¿ç§»å¤šå°‘ä¸ªslotï¼Ÿ</span>
How many slots <span class="token keyword">do</span> you want to move <span class="token punctuation">(</span>from <span class="token number">1</span> to <span class="token number">16384</span><span class="token punctuation">)</span>? <span class="token number">4096</span>
<span class="token comment"># è¿ç§»åˆ°é‚£ä¸ªmasterï¼Ÿ</span>
What is the receiving <span class="token function">node</span> ID? 724a8a15f4efe5a01454cb971d7471d6e84279f3
Please enter all the <span class="token builtin class-name">source</span> <span class="token function">node</span> IDs.
  Type <span class="token string">&#39;all&#39;</span> to use all the nodes as <span class="token builtin class-name">source</span> nodes <span class="token keyword">for</span> the <span class="token builtin class-name">hash</span> slots.
  Type <span class="token string">&#39;done&#39;</span> once you entered all the <span class="token builtin class-name">source</span> nodes IDs.
<span class="token comment"># ä»å“ªé‡Œè¿ç§»ï¼Ÿ</span>
Source <span class="token function">node</span> <span class="token comment">#1:4fb4c538d5f29255f6212f2eae8a761fbe364a89</span>
Source <span class="token function">node</span> <span class="token comment">#2:690b2e1f604a0227068388d3e5b1f1940524c565</span>
Source <span class="token function">node</span> <span class="token comment">#3:1be5d1aaaa9e9542224554f461694da9cba7c2b8</span>
Source <span class="token function">node</span> <span class="token comment">#4:done</span>
 
Ready to move <span class="token number">4096</span> slots.
  Source nodes:
    M: 4fb4c538d5f29255f6212f2eae8a761fbe364a89 <span class="token number">10.0</span>.0.101:6380
   slots:0-5460 <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    M: 690b2e1f604a0227068388d3e5b1f1940524c565 <span class="token number">10.0</span>.0.102:6379
   slots:10923-16383 <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    M: 1be5d1aaaa9e9542224554f461694da9cba7c2b8 <span class="token number">10.0</span>.0.101:6379
   slots:5461-10922 <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
  Destination node:
    M: 724a8a15f4efe5a01454cb971d7471d6e84279f3 <span class="token number">10.0</span>.0.103:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
   <span class="token number">0</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
  Resharding plan:
    Moving slot <span class="token number">5461</span> from 1be5d1aaaa9e9542224554f461694da9cba7c2b8
    Moving slot <span class="token number">5462</span> from 1be5d1aaaa9e9542224554f461694da9cba7c2b8
    Moving slot <span class="token number">5463</span> from 1be5d1aaaa9e9542224554f461694da9cba7c2b8
    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    
<span class="token number">10.0</span>.0.100:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> cluster nodes
1be5d1aaaa9e9542224554f461694da9cba7c2b8 <span class="token number">10.0</span>.0.101:6379@16379 master - <span class="token number">0</span> <span class="token number">1585053959158</span> <span class="token number">2</span> connected <span class="token number">6827</span>-10922
<span class="token comment"># å¯ä»¥çœ‹åˆ°æ–°åŠ å…¥çš„ä¸€ä¸ªèŠ‚ç‚¹å·²ç»åˆ†é…åˆ°äº†slot</span>
724a8a15f4efe5a01454cb971d7471d6e84279f3 <span class="token number">10.0</span>.0.103:6379@16379 master - <span class="token number">0</span> <span class="token number">1585053957000</span> <span class="token number">8</span> connected <span class="token number">0</span>-1364 <span class="token number">5461</span>-6826 <span class="token number">10923</span>-12287
4fb4c538d5f29255f6212f2eae8a761fbe364a89 <span class="token number">10.0</span>.0.101:6380@16380 master - <span class="token number">0</span> <span class="token number">1585053960166</span> <span class="token number">7</span> connected <span class="token number">1365</span>-5460
ed9b72fffd04b8a7e5ad20afdaf1f53e0eb95011 <span class="token number">10.0</span>.0.103:6380@16380 master - <span class="token number">0</span> <span class="token number">1585053957000</span> <span class="token number">0</span> connected
690b2e1f604a0227068388d3e5b1f1940524c565 <span class="token number">10.0</span>.0.102:6379@16379 master - <span class="token number">0</span> <span class="token number">1585053959000</span> <span class="token number">3</span> connected <span class="token number">12288</span>-16383
89f52bfbb8803db19ab0c5a90adc4099df8287f7 <span class="token number">10.0</span>.0.100:6379@16379 slave 4fb4c538d5f29255f6212f2eae8a761fbe364a89 <span class="token number">0</span> <span class="token number">1585053958149</span> <span class="token number">7</span> connected
86e1881611440012c87fbf3fa98b7b6d79915e25 <span class="token number">10.0</span>.0.102:6380@16380 slave 1be5d1aaaa9e9542224554f461694da9cba7c2b8 <span class="token number">0</span> <span class="token number">1585053958000</span> <span class="token number">6</span> connected
8c13a2afa76194ef9582bb06675695bfef76b11d <span class="token number">10.0</span>.0.100:6380@16380 myself,slave 690b2e1f604a0227068388d3e5b1f1940524c565 <span class="token number">0</span> <span class="token number">1585053954000</span> <span class="token number">4</span> connected
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-ç¼©å®¹" tabindex="-1"><a class="header-anchor" href="#_6-2-ç¼©å®¹" aria-hidden="true">#</a> 6.2 ç¼©å®¹</h3><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220701200752061.png" alt="image-20220701200752061"><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220701200806168.png" alt="image-20220701200806168" tabindex="0" loading="lazy"><figcaption>image-20220701200806168</figcaption></figure><ul><li>éœ€è¦åˆ¤æ–­ä¸‹çº¿çš„èŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä»¥åŠä¸»èŠ‚ç‚¹ä¸Šæ˜¯å¦æœ‰æ§½ <ul><li>å¦‚æœä¸‹çº¿çš„æ˜¯masterï¼Œé‚£ä¹ˆå°†æ­¤masterçš„slotè¿ç§»åˆ°å…¶ä»–masterä¹‹åï¼Œé€šçŸ¥å…¶ä»–èŠ‚ç‚¹å¿˜è®°æ­¤masterèŠ‚ç‚¹</li><li>å¦‚æœä¸‹çº¿çš„æ˜¯slaveï¼Œé‚£ä¹ˆé€šçŸ¥å…¶ä»–èŠ‚ç‚¹å¿˜è®°ä¸‹çº¿çš„èŠ‚ç‚¹</li></ul></li><li>å…¶ä»–èŠ‚ç‚¹éƒ½å¿˜è®°äº†ä¸‹çº¿çš„èŠ‚ç‚¹ä¹‹åï¼Œæ­¤èŠ‚ç‚¹å°±å¯ä»¥æ­£å¸¸åœæ­¢æœåŠ¡äº†</li></ul><blockquote><p>æœ€åéœ€è¦å°†è¯¥ä¸‹çº¿ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹æŒ‡å‘å…¶ä»–ä¸»èŠ‚ç‚¹ï¼Œå½“ç„¶æœ€å¥½æ˜¯å…ˆå°†ä»èŠ‚ç‚¹ä¸‹çº¿ã€‚</p></blockquote><h2 id="_7-æ›´æ·±å…¥ç†è§£" tabindex="-1"><a class="header-anchor" href="#_7-æ›´æ·±å…¥ç†è§£" aria-hidden="true">#</a> 7. æ›´æ·±å…¥ç†è§£</h2><blockquote><p>é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œå†æ·±å…¥ç†è§£Redis Cluster</p></blockquote><h3 id="_7-1-ä¸ºä»€ä¹ˆredis-clusterçš„hash-slot-æ˜¯16384" tabindex="-1"><a class="header-anchor" href="#_7-1-ä¸ºä»€ä¹ˆredis-clusterçš„hash-slot-æ˜¯16384" aria-hidden="true">#</a> 7.1 ä¸ºä»€ä¹ˆRedis Clusterçš„Hash Slot æ˜¯16384ï¼Ÿ</h3><p>æˆ‘ä»¬çŸ¥é“ä¸€è‡´æ€§hashç®—æ³•æ˜¯2çš„16æ¬¡æ–¹ï¼Œä¸ºä»€ä¹ˆhash slotæ˜¯2çš„14æ¬¡æ–¹å‘¢ï¼Ÿ</p><ol><li><p>å¦‚æœæ§½ä½ä¸º65536ï¼Œå‘é€å¿ƒè·³ä¿¡æ¯çš„æ¶ˆæ¯å¤´è¾¾8kï¼Œå‘é€çš„å¿ƒè·³åŒ…è¿‡äºåºå¤§ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨æ¶ˆæ¯å¤´ä¸­ï¼Œæœ€å ç©ºé—´çš„æ˜¯myslots[CLUSTER_SLOTS/8]ã€‚ å½“æ§½ä½ä¸º65536æ—¶ï¼Œè¿™å—çš„å¤§å°æ˜¯: 65536Ã·8Ã·1024=8kb å› ä¸ºæ¯ç§’é’Ÿï¼ŒredisèŠ‚ç‚¹éœ€è¦å‘é€ä¸€å®šæ•°é‡çš„pingæ¶ˆæ¯ä½œä¸ºå¿ƒè·³åŒ…ï¼Œå¦‚æœæ§½ä½ä¸º65536ï¼Œè¿™ä¸ªpingæ¶ˆæ¯çš„æ¶ˆæ¯å¤´å¤ªå¤§äº†ï¼Œæµªè´¹å¸¦å®½ã€‚</p></li><li><p>redisçš„é›†ç¾¤ä¸»èŠ‚ç‚¹æ•°é‡åŸºæœ¬ä¸å¯èƒ½è¶…è¿‡1000ä¸ªã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œé›†ç¾¤èŠ‚ç‚¹è¶Šå¤šï¼Œå¿ƒè·³åŒ…çš„æ¶ˆæ¯ä½“å†…æºå¸¦çš„æ•°æ®è¶Šå¤šã€‚å¦‚æœèŠ‚ç‚¹è¿‡1000ä¸ªï¼Œä¹Ÿä¼šå¯¼è‡´ç½‘ç»œæ‹¥å µã€‚å› æ­¤redisä½œè€…ï¼Œä¸å»ºè®®redis clusterèŠ‚ç‚¹æ•°é‡è¶…è¿‡1000ä¸ªã€‚ é‚£ä¹ˆï¼Œå¯¹äºèŠ‚ç‚¹æ•°åœ¨1000ä»¥å†…çš„redis clusteré›†ç¾¤ï¼Œ16384ä¸ªæ§½ä½å¤Ÿç”¨äº†ã€‚æ²¡æœ‰å¿…è¦æ‹“å±•åˆ°65536ä¸ªã€‚</p></li><li><p>æ§½ä½è¶Šå°ï¼ŒèŠ‚ç‚¹å°‘çš„æƒ…å†µä¸‹ï¼Œå‹ç¼©æ¯”é«˜</p><p>Redisä¸»èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯ä¸­ï¼Œå®ƒæ‰€è´Ÿè´£çš„å“ˆå¸Œæ§½æ˜¯é€šè¿‡ä¸€å¼ bitmapçš„å½¢å¼æ¥ä¿å­˜çš„ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹bitmapè¿›è¡Œå‹ç¼©ï¼Œä½†æ˜¯å¦‚æœbitmapçš„å¡«å……ç‡slots / Nå¾ˆé«˜çš„è¯(Nè¡¨ç¤ºèŠ‚ç‚¹æ•°)ï¼Œbitmapçš„å‹ç¼©ç‡å°±å¾ˆä½ã€‚ å¦‚æœèŠ‚ç‚¹æ•°å¾ˆå°‘ï¼Œè€Œå“ˆå¸Œæ§½æ•°é‡å¾ˆå¤šçš„è¯ï¼Œbitmapçš„å‹ç¼©ç‡å°±å¾ˆä½ã€‚</p></li></ol><h3 id="_7-2-ä¸ºä»€ä¹ˆredis-clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢" tabindex="-1"><a class="header-anchor" href="#_7-2-ä¸ºä»€ä¹ˆredis-clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢" aria-hidden="true">#</a> 7.2 ä¸ºä»€ä¹ˆRedis Clusterä¸­ä¸å»ºè®®ä½¿ç”¨å‘å¸ƒè®¢é˜…å‘¢ï¼Ÿ</h3><p>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„publishå‘½ä»¤éƒ½ä¼šå‘æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ä»èŠ‚ç‚¹ï¼‰è¿›è¡Œå¹¿æ’­ï¼Œé€ æˆæ¯æ¡publishæ•°æ®éƒ½ä¼šåœ¨é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹ä¼ æ’­ä¸€æ¬¡ï¼ŒåŠ é‡äº†å¸¦å®½è´Ÿæ‹…ï¼Œå¯¹äºåœ¨æœ‰å¤§é‡èŠ‚ç‚¹çš„é›†ç¾¤ä¸­é¢‘ç¹ä½¿ç”¨pubï¼Œä¼šä¸¥é‡æ¶ˆè€—å¸¦å®½ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ï¼ˆè™½ç„¶å®˜ç½‘ä¸Šè®²æœ‰æ—¶å€™å¯ä»¥ä½¿ç”¨Bloomè¿‡æ»¤å™¨æˆ–å…¶ä»–ç®—æ³•è¿›è¡Œä¼˜åŒ–çš„ï¼‰</p><h2 id="_8-å…¶å®ƒå¸¸è§æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_8-å…¶å®ƒå¸¸è§æ–¹æ¡ˆ" aria-hidden="true">#</a> 8. å…¶å®ƒå¸¸è§æ–¹æ¡ˆ</h2><blockquote><p>è¿˜æœ‰ä¸€äº›æ–¹æ¡ˆå‡ºç°åœ¨å†å²èˆå°ä¸Šï¼Œæˆ‘æŒ‘äº†å‡ ä¸ªç»å…¸çš„ã€‚ç®€å•äº†è§£ä¸‹ï¼Œå¢å¼ºä¸‹å…³è”çš„çŸ¥è¯†ä½“ç³»ã€‚</p></blockquote><h3 id="_8-1-redis-sentinel-é›†ç¾¤-keepalived-haproxy" tabindex="-1"><a class="header-anchor" href="#_8-1-redis-sentinel-é›†ç¾¤-keepalived-haproxy" aria-hidden="true">#</a> 8.1 Redis Sentinel é›†ç¾¤ + Keepalived/Haproxy</h3><p>åº•å±‚æ˜¯ Redis Sentinel é›†ç¾¤ï¼Œä»£ç†ç€ Redis ä¸»ä»ï¼ŒWeb ç«¯é€šè¿‡ VIP æä¾›æœåŠ¡ã€‚å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ¯”å¦‚æœºå™¨æ•…éšœã€Redis èŠ‚ç‚¹æ•…éšœæˆ–è€…ç½‘ç»œä¸å¯è¾¾ï¼ŒRedis ä¹‹é—´çš„åˆ‡æ¢é€šè¿‡ Redis Sentinel å†…éƒ¨æœºåˆ¶ä¿éšœï¼ŒVIP åˆ‡æ¢é€šè¿‡ Keepalived ä¿éšœã€‚</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626205712239.png" alt="image-20220626205712239" tabindex="0" loading="lazy"><figcaption>image-20220626205712239</figcaption></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç§’çº§åˆ‡æ¢</li><li>å¯¹åº”ç”¨é€æ˜</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç»´æŠ¤æˆæœ¬é«˜</li><li>å­˜åœ¨è„‘è£‚</li><li>Sentinel æ¨¡å¼å­˜åœ¨çŸ­æ—¶é—´çš„æœåŠ¡ä¸å¯ç”¨</li></ul><h3 id="_8-2-twemproxy" tabindex="-1"><a class="header-anchor" href="#_8-2-twemproxy" aria-hidden="true">#</a> 8.2 Twemproxy</h3><p>å¤šä¸ªåŒæ„ Twemproxyï¼ˆé…ç½®ç›¸åŒï¼‰åŒæ—¶å·¥ä½œï¼Œæ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ ¹æ® hash ç®—æ³•ï¼Œè½¬å‘ç»™å¯¹åº”çš„ Redisã€‚</p><p>Twemproxy æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿäº†ï¼Œä½†æ˜¯æ•ˆæœå¹¶ä¸æ˜¯å¾ˆç†æƒ³ã€‚ä¸€æ–¹é¢æ˜¯å®šä½é—®é¢˜æ¯”è¾ƒå›°éš¾ï¼Œå¦ä¸€æ–¹é¢æ˜¯å®ƒå¯¹è‡ªåŠ¨å‰”é™¤èŠ‚ç‚¹çš„æ”¯æŒä¸æ˜¯å¾ˆå‹å¥½ã€‚</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626205806784.png" alt="image-20220626205806784" tabindex="0" loading="lazy"><figcaption>image-20220626205806784</figcaption></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¼€å‘ç®€å•ï¼Œå¯¹åº”ç”¨å‡ ä¹é€æ˜</li><li>å†å²æ‚ ä¹…ï¼Œæ–¹æ¡ˆæˆç†Ÿ</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä»£ç†å½±å“æ€§èƒ½</li><li>LVS å’Œ Twemproxy ä¼šæœ‰èŠ‚ç‚¹æ€§èƒ½ç“¶é¢ˆ</li><li>Redis æ‰©å®¹éå¸¸éº»çƒ¦</li><li>Twitter å†…éƒ¨å·²æ”¾å¼ƒä½¿ç”¨è¯¥æ–¹æ¡ˆï¼Œæ–°ä½¿ç”¨çš„æ¶æ„æœªå¼€æº</li></ul><h3 id="_8-3-codis" tabindex="-1"><a class="header-anchor" href="#_8-3-codis" aria-hidden="true">#</a> 8.3 Codis</h3><p>Codis æ˜¯ç”±è±Œè±†èšå¼€æºçš„äº§å“ï¼Œæ¶‰åŠç»„ä»¶ä¼—å¤šï¼Œå…¶ä¸­ ZooKeeper å­˜æ”¾è·¯ç”±è¡¨å’Œä»£ç†èŠ‚ç‚¹å…ƒæ•°æ®ã€åˆ†å‘ Codis-Config çš„å‘½ä»¤ï¼›Codis-Config æ˜¯é›†æˆç®¡ç†å·¥å…·ï¼Œæœ‰ Web ç•Œé¢ä¾›ä½¿ç”¨ï¼›Codis-Proxy æ˜¯ä¸€ä¸ªå…¼å®¹ Redis åè®®çš„æ— çŠ¶æ€ä»£ç†ï¼›Codis-Redis åŸºäº Redis 2.8 ç‰ˆæœ¬äºŒæ¬¡å¼€å‘ï¼ŒåŠ å…¥ slot æ”¯æŒï¼Œæ–¹ä¾¿è¿ç§»æ•°æ®ã€‚</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220626205916174.png" alt="image-20220626205916174" tabindex="0" loading="lazy"><figcaption>image-20220626205916174</figcaption></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¼€å‘ç®€å•ï¼Œå¯¹åº”ç”¨å‡ ä¹é€æ˜</li><li>æ€§èƒ½æ¯” Twemproxy å¥½</li><li>æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼Œæ‰©å®¹å®¹æ˜“ï¼Œè¿ç»´æ–¹ä¾¿</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä»£ç†ä¾æ—§å½±å“æ€§èƒ½</li><li>ç»„ä»¶è¿‡å¤šï¼Œéœ€è¦å¾ˆå¤šæœºå™¨èµ„æº</li><li>ä¿®æ”¹äº† Redis ä»£ç ï¼Œå¯¼è‡´å’Œå®˜æ–¹æ— æ³•åŒæ­¥ï¼Œæ–°ç‰¹æ€§è·Ÿè¿›ç¼“æ…¢</li><li>å¼€å‘å›¢é˜Ÿå‡†å¤‡ä¸»æ¨åŸºäº Redis æ”¹é€ çš„ reborndb</li></ul><h2 id="å‚è€ƒæ–‡ç« " tabindex="-1"><a class="header-anchor" href="#å‚è€ƒæ–‡ç« " aria-hidden="true">#</a> å‚è€ƒæ–‡ç« </h2><p><a href="https://pdai.tech/md/db/nosql-redis/db-redis-x-cluster.html" target="_blank" rel="noopener noreferrer"><strong>Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/7005083244886491166" target="_blank" rel="noopener noreferrer">Redis - Redis å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zszdevelop/java-study-gitbook/edit/main/docs/db/redis/db-redis-x-cluster.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zszdevelop@163.com">zszdevelop</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/db/redis/db-redis-y-install-sentinel.html" class="nav-link prev" aria-label="Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£</div></a><a href="/db/redis/db-redis-x-consistency.html" class="nav-link next" aria-label="Redisè¿›é˜¶ - å¦‚ä½•ä¿éšœMySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">Redisè¿›é˜¶ - å¦‚ä½•ä¿éšœMySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href='https://beian.miit.gov.cn' target='_blank' style='color: var(--c-text-lighter);>é—½ICPå¤‡18001806å·-1</a></div><div class="copyright">Copyright Â© 2023 zszdevelop</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-33d8c51f.js" defer></script>
  </body>
</html>
